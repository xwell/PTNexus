import{d as x,r as w,c as y,b as s,w as t,e as n,h as p,P as b,i as c,f as T,z as r,q as f,ak as C,a5 as P,g as N,m as h}from"./index-BjUns_Ha.js";const A={class:"login-page"},B=x({__name:"LoginView",setup(R){const g=P(),u=C(),d=w(!1),o=w({username:"",password:""}),_=async()=>{if(!d.value){d.value=!0;try{const a=await T.post("/api/auth/login",o.value);if(a.data?.success&&a.data?.token)if(localStorage.setItem("token",a.data.token),a.data.is_temp_password||a.data.must_change_password)r.warning({message:"您正在使用临时密码，为了账户安全，请立即修改密码！",duration:5e3,showClose:!0}),await f(),await u.replace("/settings"),setTimeout(()=>{r.warning({message:'请在"账户"标签页中修改您的用户名和密码',duration:8e3,showClose:!0})},500);else{r.success("登录成功");const l=g.query.redirect||"/";console.log("登录成功，准备跳转到:",l),await f(),await u.replace(l),setTimeout(()=>{u.currentRoute.value.path==="/login"&&(console.warn("仍在登录页，强制跳转到首页"),u.replace("/"))},100)}else r.error(a.data?.message||"登录失败")}catch(a){const e=a?.response?.data?.message||"登录失败";r.error(e)}finally{d.value=!1}}};return(a,e)=>{const l=n("el-input"),i=n("el-form-item"),v=n("el-button"),V=n("el-form"),k=n("el-card");return N(),y("div",A,[s(k,{class:"login-card"},{default:t(()=>[e[3]||(e[3]=p("h2",{class:"title"},"登录 PT Nexus",-1)),s(V,{model:o.value,onKeyup:b(_,["enter"]),"label-width":"80px"},{default:t(()=>[s(i,{label:"用户名"},{default:t(()=>[s(l,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=m=>o.value.username=m),autocomplete:"username"},null,8,["modelValue"])]),_:1}),s(i,{label:"密码"},{default:t(()=>[s(l,{modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=m=>o.value.password=m),type:"password",autocomplete:"current-password"},null,8,["modelValue"])]),_:1}),s(i,null,{default:t(()=>[s(v,{type:"primary",loading:d.value,onClick:_},{default:t(()=>[...e[2]||(e[2]=[c("登录",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),e[4]||(e[4]=p("p",{class:"tip"},[c(" Docker 端初始随机密码请查看容器日志；"),p("br"),c("Windows 端初始密码请查看 %APPDATA%\\com.ptnexus.desktop\\logs\\server.stderr.log 对应日志文件。 ")],-1))]),_:1})])}}}),D=h(B,[["__scopeId","data-v-0d338ede"]]);export{D as default};
