import{C as Nt,d as Ms,r as S,p as F,O as qe,o as Us,s as Os,c as g,j as w,h as a,b as r,e as x,w as c,F as A,k as U,x as C,T as Bs,g as p,l as T,U as Fs,V as Vt,W as De,m as js,q as Te,f as V,E as f,X as we,i as z,n as N,Y as us,t as y,J as xt,Z as As,$ as je,a0 as cs,B as Bt,y as Rs,a1 as Ps,a2 as Ls,a3 as At}from"./index-BiuajaRa.js";const Rt=Nt("crossSeed",{state:()=>({taskId:null,sourceInfo:null,workingParams:null}),actions:{setTaskId(le){this.taskId=le},clearTaskId(){this.taskId=null},setSourceInfo(le){this.sourceInfo=le},clearSourceInfo(){this.sourceInfo=null},setParams(le){this.workingParams=le},clearParams(){this.workingParams=null},reset(){this.clearTaskId(),this.clearSourceInfo(),this.clearParams()}}}),Pt={key:0,class:"log-progress-overlay"},Lt={class:"log-progress-container"},Mt={class:"steps-wrapper"},Ut={key:0,class:"spinner-icon"},Ot={key:1,class:"success-icon"},Ft={key:2,class:"error-icon"},jt={key:3,class:"warning-icon"},qt={key:0,class:"completion-message"},Ht=Ms({__name:"LogProgress",props:{visible:{type:Boolean},taskId:{}},emits:["complete","close"],setup(le,{emit:He}){const q=le,ke=He,H=S([{name:"æ•°æ®åº“æŸ¥è¯¢",message:"æ­£åœ¨æ£€æŸ¥ç¼“å­˜...",status:"pending"},{name:"å¼€å§‹æŠ“å–",message:"å‡†å¤‡ä»æºç«™ç‚¹è·å–...",status:"pending"},{name:"è·å–ç§å­ä¿¡æ¯",message:"",status:"pending"},{name:"è§£æå‚æ•°",message:"",status:"pending"},{name:"éªŒè¯å›¾ç‰‡é“¾æ¥",message:"",status:"pending"},{name:"æå–åª’ä½“ä¿¡æ¯",message:"",status:"pending"},{name:"éªŒè¯ç®€ä»‹æ ¼å¼",message:"",status:"pending"},{name:"æ£€æŸ¥å£°æ˜æ„Ÿè°¢",message:"",status:"pending"},{name:"æˆåŠŸè·å–å‚æ•°",message:"",status:"pending"}]),Se=S(!1);let Y=null;const ve=F(()=>{const D=H.value.findIndex(G=>G.status==="processing");return D!==-1?D:H.value.filter(G=>G.status==="success").length}),Ie=D=>D.status==="success"?"success":D.status==="error"?"error":D.status==="warning"?"warning":D.status==="processing"?"process":"wait";qe(()=>q.taskId,D=>{D&&q.visible&&k()}),qe(()=>q.visible,D=>{D&&q.taskId?k():D||R()}),Us(()=>{q.visible&&q.taskId&&k()}),Os(()=>{R()});const k=()=>{Y&&Y.close(),Se.value=!1,H.value.forEach(D=>{D.status="pending",D.message=D.name==="æ•°æ®åº“æŸ¥è¯¢"?"æ­£åœ¨æ£€æŸ¥ç¼“å­˜...":D.name==="å¼€å§‹æŠ“å–"?"å‡†å¤‡ä»æºç«™ç‚¹è·å–...":""}),Y=new EventSource(`/api/migrate/logs/stream/${q.taskId}`),Y.onmessage=D=>{try{const P=JSON.parse(D.data);P.type==="connected"?console.log("SSE è¿æ¥æˆåŠŸ",P):P.type==="log"?Ge(P.step,P.message,P.status):P.type==="complete"?(Se.value=!0,ke("complete"),R(),ke("close")):P.type}catch(P){console.error("è§£æ SSE æ¶ˆæ¯å¤±è´¥:",P)}},Y.onerror=D=>{console.error("SSE è¿æ¥é”™è¯¯:",D),R()}},R=()=>{Y&&(Y.close(),Y=null)},Ge=(D,P,G)=>{const se=H.value.findIndex(E=>E.name===D);if(se!==-1){const E=H.value[se];if(E.message=P,E.status=G,G==="success"&&se<H.value.length-1){const X=H.value[se+1];X.status==="pending"&&(X.status="processing")}}};return(D,P)=>{const G=x("el-icon"),se=x("el-step"),E=x("el-steps");return le.visible?(p(),g("div",Pt,[a("div",Lt,[a("div",Mt,[r(E,{direction:"vertical",active:ve.value,"finish-status":"success"},{default:c(()=>[(p(!0),g(A,null,U(H.value,(X,ne)=>(p(),T(se,{key:ne,title:X.name,description:X.message,status:Ie(X)},{icon:c(()=>[X.status==="processing"?(p(),g("div",Ut,[r(G,{class:"is-loading"},{default:c(()=>[r(C(Fs))]),_:1})])):X.status==="success"?(p(),g("div",Ot,[r(G,null,{default:c(()=>[r(C(Bs))]),_:1})])):X.status==="error"?(p(),g("div",Ft,[r(G,null,{default:c(()=>[r(C(Vt))]),_:1})])):X.status==="warning"?(p(),g("div",jt,[r(G,null,{default:c(()=>[r(C(De))]),_:1})])):w("",!0)]),_:2},1032,["title","description","status"]))),128))]),_:1},8,["active"]),Se.value?(p(),g("div",qt,[r(G,{class:"icon-complete",color:"#67C23A"},{default:c(()=>[r(C(Bs))]),_:1}),P[0]||(P[0]=a("span",null,"æ‰€æœ‰æ­¥éª¤å·²å®Œæˆ",-1))])):w("",!0)])])])):w("",!0)}}}),Gt=js(Ht,[["__scopeId","data-v-b874a855"]]),Wt={class:"cross-seed-panel"},Kt={class:"panel-header"},Jt={class:"custom-steps"},Yt={class:"step-icon"},Xt={key:1},Zt={class:"step-title"},Qt={key:0,class:"step-connector"},ea={class:"panel-content"},sa={key:0,class:"step-container details-container"},ta={class:"main-info-container"},aa={class:"full-width-form-column"},la={class:"title-section"},oa={class:"title-components-grid"},na={class:"bottom-info-section"},ia={class:"subtitle-unrecognized-grid"},ra={class:"subtitle-section",style:{"grid-column":"span 4"}},da={class:"standard-params-section"},ua={class:"standard-params-grid"},ca={class:"standard-params-grid second-row"},ma={class:"poster-statement-container"},pa={class:"poster-statement-split"},va={class:"left-panel"},_a={class:"form-label-with-button"},fa={class:"right-panel"},ga={class:"poster-preview-section"},ha={class:"image-preview-container"},ba=["src","onError"],ya={key:1,class:"preview-placeholder"},wa={class:"screenshot-container"},ka={class:"form-column screenshot-text-column"},Sa={class:"form-label-with-button"},Ia={class:"preview-column screenshot-preview-column"},$a={class:"carousel-container"},Ca={class:"carousel-image-wrapper"},Ea=["src","onError"],za={key:1,class:"preview-placeholder"},Ta={class:"form-label-with-button"},Da={class:"form-label-with-button"},Na={class:"mediainfo-container"},Va={key:0,class:"bdinfo-progress-inline"},xa={class:"progress-header"},Ba={class:"header-buttons"},Aa={class:"progress-details-inline"},Ra={class:"progress-info-row"},Pa={class:"progress-item"},La={class:"progress-item"},Ma={class:"progress-item"},Ua={class:"filtered-declarations-container"},Oa={class:"filtered-declarations-header"},Fa={class:"filtered-declarations-content"},ja={class:"declaration-header"},qa={class:"declaration-number"},Ha={class:"declaration-content code-font"},Ga={key:1,class:"no-filtered-declarations"},Wa={key:1,class:"step-container publish-preview-container"},Ka={class:"publish-preview-content"},Ja={class:"preview-row main-title-row"},Ya={class:"row-content main-title-content"},Xa={class:"preview-row subtitle-row"},Za={class:"row-content subtitle-content"},Qa={class:"preview-row params-row"},el={class:"row-content"},sl={class:"param-row"},tl={class:"param-item imdb-item half-width"},al={style:{display:"flex"}},ll={style:{display:"flex"}},ol={style:{display:"flex"}},nl={class:"param-item tags-item half-width"},il={class:"param-value-container"},rl={key:0,class:"param-standard-key"},dl={class:"params-content"},ul={class:"param-item inline-param"},cl={class:"param-value-container"},ml={key:0,class:"param-standard-key"},pl={class:"param-item inline-param"},vl={class:"param-value-container"},_l={key:0,class:"param-standard-key"},fl={class:"param-item inline-param"},gl={class:"param-value-container"},hl={key:0,class:"param-standard-key"},bl={class:"param-item inline-param"},yl={class:"param-value-container"},wl={key:0,class:"param-standard-key"},kl={class:"param-item inline-param"},Sl={class:"param-value-container"},Il={key:0,class:"param-standard-key"},$l={class:"param-item inline-param"},Cl={class:"param-value-container"},El={key:0,class:"param-standard-key"},zl={class:"param-item inline-param"},Tl={class:"param-value-container"},Dl={key:0,class:"param-standard-key"},Nl={class:"preview-row mediainfo-row"},Vl={class:"row-content mediainfo-content scrollable-content"},xl={class:"mediainfo-pre"},Bl={class:"preview-row description-row"},Al={class:"row-content description-content"},Rl={class:"description-section"},Pl=["innerHTML"],Ll={key:0,class:"description-section"},Ml={class:"image-gallery"},Ul=["src","alt","onError"],Ol={class:"description-section"},Fl=["innerHTML"],jl={key:1,class:"description-section"},ql={class:"image-gallery"},Hl=["src","alt","onError"],Gl={key:2,class:"step-container site-selection-container"},Wl={class:"select-all-container",style:{"margin-top":"16px"}},Kl={style:{display:"flex","align-items":"center","justify-content":"center",position:"relative"}},Jl={style:{position:"absolute",left:"50%",transform:"translateX(-50%)"}},Yl={style:{display:"flex","align-items":"center",gap:"12px","margin-left":"calc(50% + 70px)"}},Xl={class:"site-buttons-group"},Zl={key:3,class:"step-container results-container"},Ql={key:0,class:"progress-section"},eo={key:0,class:"progress-item"},so={class:"progress-text"},to={key:1,class:"progress-item"},ao={class:"progress-text"},lo={key:2,class:"limit-alert-section"},oo={class:"limit-alert"},no={class:"limit-alert-content"},io={class:"limit-alert-title"},ro={class:"limit-alert-message"},uo={class:"results-rows-container"},co={class:"row-sites"},mo={class:"card-icon"},po={class:"card-title"},vo={key:0,class:"existed-tag"},_o={key:1,class:"status-tag"},fo={key:2,class:"status-tag"},go={key:3,class:"status-tag"},ho={key:4,class:"status-tag"},bo={key:5,class:"downloader-status"},yo={class:"status-icon"},wo={class:"card-extra"},ko=["href"],So={class:"row-action"},Io={class:"button-subtitle"},$o={class:"panel-footer"},Co={key:0,class:"button-group"},Eo={key:0,class:"check-hint"},zo={key:0,class:"validation-hint"},To={key:1,class:"button-group"},Do={key:0,class:"validation-hint"},No={key:0,class:"validation-hint"},Vo={key:2,class:"button-group"},xo={key:3,class:"button-group"},Bo={class:"card-header"},Ao={class:"log-content-pre"},Ro={class:"error-log-container"},Po={class:"log-timeline"},Lo={class:"log-entry-header"},Mo={class:"log-time"},Uo={key:0,class:"log-site"},Oo={class:"log-text"},Fo={key:0,class:"log-entry-details"},jo={class:"code-block"},qo={class:"dialog-footer"},Ho=Ms({__name:"CrossSeedPanel",props:{showCompleteButton:{type:Boolean,default:!1}},emits:["complete","cancel","close-with-refresh"],setup(le,{emit:He}){const q=s=>{if(!s)return"";s=s.replace(/[ \t\f\v]+$/gm,""),s=s.replace(/^\s*\n+/,"").replace(/\n\s*$/,""),s=s.replace(/(\n\s*){2,}/g,`

`),s=s.replace(/([^\n]+ã€‚)\s*\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\d+\.[\s\S]*?)\n\s*\n(\s*\d+\.)/g,`$1
$2`),s=s.replace(/(\[(?:b|color)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:b|color)\])/gi,`$1
$2`);for(let e=0;e<3;e++)s=s.replace(/(\[(?:quote|b|color|size)[^\]]*\][\s\S]*?)\n\s*\n([\s\S]*?\[\/(?:quote|b|color|size)\])/gi,`$1
$2`);return s=s.replace(/(\n\s*){2,}/g,`

`),s},ke=s=>s?(s=q(s),s=s.replace(/\[quote\]([\s\S]*?)\[\/quote\]/gi,"<blockquote>$1</blockquote>"),s=s.replace(/\[b\]([\s\S]*?)\[\/b\]/gi,"<strong>$1</strong>"),s=s.replace(/\[color=(\w+|#[0-9a-fA-F]{3,6})\]([\s\S]*?)\[\/color\]/gi,'<span style="color: $1;">$2</span>'),s=s.replace(/\[size=(\d+)\]([\s\S]*?)\[\/size\]/gi,(e,o,l)=>`<span style="font-size: ${{1:"12",2:"14",3:"16",4:"18",5:"24",6:"32",7:"48"}[o]||parseInt(o)*4}px;">${l}</span>`),s=s.replace(/\n/g,"<br>"),s):"",H=s=>{if(!s)return[];const e=s.split(`
`),o=[];let l=null;const n=/^\[(.*?)\]\s+(\d{2}:\d{2}:\d{2})\s+-\s+([A-Z]+)\s+-\s+(.*)$/;return e.forEach((u,d)=>{const m=u.trimEnd();if(!m)return;const v=m.match(n);v?(l={id:d,site:v[1],time:v[2],level:v[3],message:v[4],details:"",isError:v[3]==="ERROR"||v[3]==="CRITICAL"},l.message.includes("Traceback")&&(l.isError=!0),o.push(l)):l?(l.details+=(l.details?`
`:"")+m,m.trim().startsWith('File "')&&(l.isError=!0)):o.push({id:d,site:"System",time:"",level:"INFO",message:m,details:"",isError:!1})}),o},Se=s=>{switch(s){case"SUCCESS":return"success";case"ERROR":return"danger";case"WARNING":return"warning";case"DEBUG":return"info";default:return"primary"}},Y=le,ve=He,Ie=Rt(),k=F(()=>Ie.workingParams),R=F(()=>Ie.sourceInfo?.name||""),Ge=()=>({seed_id:null,title_components:[],original_main_title:"",subtitle:"",imdb_link:"",douban_link:"",tmdb_link:"",intro:{statement:"",poster:"",body:"",screenshots:"",removed_ardtudeclarations:[]},mediainfo:"",source_params:{},standardized_params:{type:"",medium:"",video_codec:"",audio_codec:"",resolution:"",team:"",source:"",tags:[]},final_publish_parameters:{},complete_publish_params:{},raw_params_for_preview:{}}),D=s=>{if(!s||typeof s!="string")return[];const e=/\[img\](https?:\/\/[^\s[\]]+)\[\/img\]/gi;return[...s.matchAll(e)].map(l=>l[1])},P=S(new Map),G=s=>P.value.has(s)?P.value.get(s):(P.value.set(s,s),s),se=(s,e,o)=>{const l=P.value.get(s);if(l&&!l.startsWith("http://pt-nexus-proxy.sqing33.dpdns.org/")){const n=`http://pt-nexus-proxy.sqing33.dpdns.org/${s}`;P.value.set(s,n),document.querySelectorAll(`img[src="${l}"]`).forEach(d=>{d.setAttribute("src",n)}),console.log(`å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ä»£ç†URL: ${n}`);return}tt(s,e,o)},E=S(0),X=S("main"),ne=S(!1),ie=S({current:0,total:0}),re=S({current:0,total:0}),ue=S({visible:!1,title:"",message:""}),Ne=((s,e)=>{let o;return function(...n){const u=()=>{clearTimeout(o),s(...n)};clearTimeout(o),o=setTimeout(u,e)}})(()=>{const s=document.querySelector(".panel-content");if(s){const{scrollTop:e,scrollHeight:o,clientHeight:l}=s;ne.value=e+l>=o-5}},100),ms=()=>{const s=document.querySelector(".panel-content");s&&s.addEventListener("scroll",Ne)},qs=()=>{const s=document.querySelector(".panel-content");s&&s.removeEventListener("scroll",Ne)};Us(()=>{at(),lt(),nt(),Te(()=>{E.value===1&&(ms(),Ne())})}),qe(E,(s,e)=>{e===1&&qs(),s===1&&Te(()=>{ms(),Ne()})});const We=[{title:"æ ¸å¯¹ç§å­è¯¦æƒ…"},{title:"å‘å¸ƒå‚æ•°é¢„è§ˆ"},{title:"é€‰æ‹©å‘å¸ƒç«™ç‚¹"},{title:"å®Œæˆå‘å¸ƒ"}],ce=S([]),O=S([]),_e=S(!1),L=S(!1),t=S(Ge()),Q=S(null),ee=S([]),Ve=S({}),fe=S([]),Ke=S(null),ge=S(null),$e=()=>{ge.value&&(ge.value.close(),ge.value=null),Ke.value=null},Je=S(!1),xe=S(!1),Ye=S(!1),Be=S(!1),Ae=S(!1),Xe=S(!1),oe=S(!0),Z=S(""),Re=S(!1),Ze=S([]),Ce=S(!1),K=S(null),W=S({visible:!1,percent:0,currentFile:"",elapsedTime:"",remainingTime:""}),Hs=S(""),ps=S(0),Gs=s=>{if(!s)return"";const e=["B","KB","MB","GB","TB"];let o=s,l=0;for(;o>=1024&&l<e.length-1;)o/=1024,l++;return`${o.toFixed(2)} ${e[l]}`},te=S(!1),de=S([]),Pe=S(!1),vs=S(""),M=S({type:{},medium:{},video_codec:{},audio_codec:{},resolution:{},source:{},team:{},tags:{}}),Le=F(()=>D(t.value.intro.poster)),Ee=F(()=>D(t.value.intro.screenshots)),_s=F(()=>{const s=t.value.intro.removed_ardtudeclarations;return Array.isArray(s)?s:[]}),fs=F(()=>_s.value.length),Ws=s=>{const e=(s||"").trim().toLowerCase();return e?e==="category.animation"?!0:e.includes("animation")||e.includes("anime")||e.includes("åŠ¨æ¼«")||e.includes("åŠ¨ç”»"):!1},Qe=F(()=>Ws(t.value.standardized_params.type)),es=s=>s?String(s.site||"").trim().toLowerCase()==="ilolicon"||String(s.name||"").trim().toLowerCase()==="ilolicon":!1,ss=s=>{const e=ce.value.find(o=>o.name===s);if(!e||s!=="è‚‰ä¸"&&!e.has_cookie||(s==="æœæ¯”"||s==="HDtime"||s==="è‚‰ä¸")&&!e.has_passkey||k.value?.sites?.[s]||es(e)&&!Qe.value)return!1;if(s.toLowerCase()==="ubits"){const o=t.value.standardized_params.team,l=t.value.title_components;if(o&&["cmct","cmctv","hdsky","hdsweb","hds","hdstv","hdspad"].includes(o.toLowerCase()))return!1;const n=l.find(u=>u.key==="åˆ¶ä½œç»„");if(n&&n.value){const u=n.value.toLowerCase(),d=["cmct","cmctv","telesto","shadow610","hdsky","hdsweb","hds","hdstv","hdspad"];for(const m of d)if(u.includes(m))return!1}}return!0},Ks=s=>O.value.includes(s.name)?"success":!s.has_cookie&&s.name!=="è‚‰ä¸"||(s.name==="æœæ¯”"||s.name==="HDtime"||s.name==="è‚‰ä¸")&&!s.has_passkey?"danger":"default",Js=async()=>{Ye.value=!0,f.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨ä»è±†ç“£/IMDb/TMDbé‡æ–°è·å–ç®€ä»‹...",duration:0});const s={type:"intro",content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,subtitle:t.value.subtitle,source_site:R.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link}};try{const e=await V.post("/api/media/validate",s);f.closeAll(),e.data.success&&e.data.intro?(t.value.intro.body=q(e.data.intro),e.data.extracted_imdb_link&&!t.value.imdb_link&&(t.value.imdb_link=e.data.extracted_imdb_link),e.data.extracted_douban_link&&!t.value.douban_link&&(t.value.douban_link=e.data.extracted_douban_link),e.data.extracted_tmdb_link&&!t.value.tmdb_link&&(t.value.tmdb_link=e.data.extracted_tmdb_link),f.success({title:"é‡æ–°è·å–æˆåŠŸ",message:"å·²æˆåŠŸä»è±†ç“£/IMDb/TMDbè·å–å¹¶æ›´æ–°äº†ç®€ä»‹å†…å®¹ã€‚"})):f.error({title:"é‡æ–°è·å–å¤±è´¥",message:e.data.error||"æ— æ³•ä»è±†ç“£/IMDb/TMDbè·å–ç®€ä»‹ã€‚"})}catch(e){f.closeAll();const o=e.response?.data?.error||"æœªèƒ½é‡æ–°è·å–ç®€ä»‹";f.error({title:"æ“ä½œå¤±è´¥",message:o})}finally{Ye.value=!1}},Ys=async()=>{if(!t.value.original_main_title){f.warning("æ ‡é¢˜ä¸ºç©ºï¼Œæ— æ³•é‡æ–°è·å–æˆªå›¾ã€‚");return}if(xe.value){f.info({title:"æ­£åœ¨å¤„ç†ä¸­",message:"æˆªå›¾é‡æ–°ç”Ÿæˆè¯·æ±‚å·²åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™..."});return}xe.value=!0,f.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨ä»è§†é¢‘é‡æ–°ç”Ÿæˆæˆªå›¾...",duration:0});const s={type:"screenshot",content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,source_site:R.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link},savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId};try{const e=await V.post("/api/media/validate",s);f.closeAll(),e.data.success&&e.data.screenshots?(t.value.intro.screenshots=e.data.screenshots,oe.value=!0,f.success({title:"é‡æ–°è·å–æˆåŠŸ",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æˆªå›¾ã€‚"})):(oe.value=!1,f.error({title:"é‡æ–°è·å–å¤±è´¥",message:e.data.error||"æ— æ³•ä»åç«¯è·å–æ–°çš„æˆªå›¾ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"}))}catch(e){f.closeAll();const o=e.response?.data?.error||"æœªèƒ½é‡æ–°è·å–æˆªå›¾ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";f.error({title:"æ“ä½œå¤±è´¥",message:o}),oe.value=!1}finally{xe.value=!1}},Xs=async()=>{if(Be.value){f.info({title:"æ­£åœ¨å¤„ç†ä¸­",message:"åª’ä½“ä¿¡æ¯é‡æ–°è·å–è¯·æ±‚å·²åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™..."});return}Be.value=!0,f.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨ä»è§†é¢‘é‡æ–°ç”Ÿæˆåª’ä½“ä¿¡æ¯...",duration:0});try{const s=await V.post("/api/migrate/refresh_mediainfo_async",{seed_id:t.value.seed_id,save_path:k.value.save_path,content_name:t.value.original_main_title,downloader_id:k.value.downloaderId,torrent_name:k.value.name,current_mediainfo:t.value.mediainfo,force_refresh:!0,priority:1});f.closeAll(),s.data.success?(s.data.mediainfo&&(t.value.mediainfo=s.data.mediainfo),s.data.bdinfo_async&&s.data.bdinfo_async.bdinfo_status==="processing"?(f.info({title:"BDInfo å¤„ç†ä¸­",message:"BDInfo æ­£åœ¨åå°å¤„ç†ä¸­ï¼Œå®Œæˆåå°†è‡ªåŠ¨æ›´æ–°...",duration:5e3}),Me()):s.data.mediainfo?f.success({title:"é‡æ–°è·å–æˆåŠŸ",message:s.data.message||"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„åª’ä½“ä¿¡æ¯ã€‚"}):f.info({title:"ä»»åŠ¡å·²å¯åŠ¨",message:s.data.message||"BDInfo æ­£åœ¨åå°å¤„ç†ä¸­..."})):f.error({title:"é‡æ–°è·å–å¤±è´¥",message:s.data.message||"æ— æ³•ä»åç«¯è·å–æ–°çš„åª’ä½“ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"})}catch(s){f.closeAll();const e=s.response?.data?.message||s.response?.data?.error||"æœªèƒ½é‡æ–°è·å–åª’ä½“ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";f.error({title:"æ“ä½œå¤±è´¥",message:e})}finally{Be.value=!1}},gs=async(s,e=!1)=>{const o=e?5:3,l=e?2e3:1e3;for(let n=1;n<=o;n++){try{const u=await V.get(`/api/migrate/bdinfo_status/${s}`);console.log(`BDInfo çŠ¶æ€ API å“åº” (å°è¯• ${n}/${o}):`,u.data);const d=u.data;if(d&&!d.error){const m=d.mediainfo_status||d.task_status?.status;if(m==="processing_bdinfo"||m==="queued"){console.log(`æ£€æµ‹åˆ° BDInfo ä»»åŠ¡æ­£åœ¨è¿›è¡Œä¸­: ${m}`),console.log("ä»»åŠ¡ ID:",d.bdinfo_task_id),console.log("è¿›åº¦ä¿¡æ¯:",d.progress_info),Me(),Hs.value=m;return}else if(m==="completed"||m==="failed"){console.log(`BDInfo ä»»åŠ¡å·²ç»“æŸ: ${m}ï¼Œæ— éœ€å¯åŠ¨è¿›åº¦æ˜¾ç¤º`);return}else console.log(`BDInfo ä»»åŠ¡çŠ¶æ€: ${m}ï¼Œå°è¯• ${n}/${o}`)}else console.warn("BDInfo çŠ¶æ€ API è¿”å›é”™è¯¯:",d?.error)}catch(u){if(u.response){const d=u.response.status;console.warn(d===404?`ç§å­è®°å½•ä¸å­˜åœ¨: ${s} (å°è¯• ${n}/${o})`:d===500?"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ£€æŸ¥ BDInfo çŠ¶æ€å¤±è´¥":`HTTP ${d}: æ£€æŸ¥ BDInfo çŠ¶æ€å¤±è´¥`)}else u.request?console.warn("ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ— æ³•æ£€æŸ¥ BDInfo çŠ¶æ€"):console.warn("æ£€æŸ¥ BDInfo çŠ¶æ€å¤±è´¥:",u.message)}n<o&&(console.log(`ç­‰å¾… ${l}ms åé‡è¯•æ£€æŸ¥ BDInfo çŠ¶æ€...`),await new Promise(u=>setTimeout(u,l)))}console.warn(`ç»è¿‡ ${o} æ¬¡å°è¯•ï¼Œæœªèƒ½æ£€æµ‹åˆ° BDInfo ä»»åŠ¡`)},Me=()=>{if(console.log("å¯åŠ¨ BDInfo SSE è¿æ¥..."),!t.value?.seed_id){console.error("seed_id æœªè®¾ç½®ï¼Œæ— æ³•å»ºç«‹ SSE è¿æ¥"),f.error({title:"è¿æ¥é”™è¯¯",message:"ç§å­IDæœªè®¾ç½®ï¼Œæ— æ³•å»ºç«‹è¿›åº¦è¿æ¥"});return}console.log(`ä½¿ç”¨ seed_id å»ºç«‹ SSE è¿æ¥: ${t.value.seed_id}`),ze(!1),W.value={visible:!0,percent:0,currentFile:"æ­£åœ¨è¿æ¥...",elapsedTime:"",remainingTime:""};const s=`/api/migrate/bdinfo_sse/${t.value.seed_id}`;console.log(`SSE è¿æ¥ URL: ${s}`),K.value=new EventSource(s);let e=setTimeout(()=>{K.value?.readyState===EventSource.CONNECTING&&(console.warn("SSE è¿æ¥è¶…æ—¶ï¼Œå°è¯•é‡æ–°è¿æ¥"),K.value?.close(),W.value.visible&&setTimeout(()=>{console.log("å°è¯•é‡æ–°å»ºç«‹ SSE è¿æ¥..."),Me()},2e3))},5e3);K.value.onopen=()=>{console.log("BDInfo SSEè¿æ¥å·²å»ºç«‹"),e&&(clearTimeout(e),e=null),Zs()},K.value.onmessage=o=>{try{const l=JSON.parse(o.data);switch(l.type){case"connected":console.log("SSEè¿æ¥æˆåŠŸ:",l.connection_id);break;case"progress_update":const{progress_percent:n,current_file:u,elapsed_time:d,remaining_time:m,disc_size:v}=l.data;W.value={visible:!0,percent:Math.round(n),currentFile:u,elapsedTime:d,remainingTime:m},v&&(ps.value=v),console.log(`BDInfo è¿›åº¦: ${n}%`);break;case"completion":t.value.mediainfo=l.data.mediainfo,f.success({title:"BDInfo è·å–å®Œæˆ",message:"BDInfo å·²æˆåŠŸè·å–å¹¶æ›´æ–°"}),W.value.visible=!1,ze(!1);break;case"error":f.warning({title:"BDInfo è·å–å¤±è´¥",message:l.data.error||"BDInfo è·å–å¤±è´¥ï¼Œå¯æ‰‹åŠ¨é‡è¯•"}),W.value.visible=!1,ze(!1);break;case"heartbeat":return;default:console.log("æœªçŸ¥SSEæ¶ˆæ¯ç±»å‹:",l.type)}}catch(l){console.error("è§£æSSEæ¶ˆæ¯å¤±è´¥:",l)}},K.value.onerror=o=>{console.error("SSEè¿æ¥é”™è¯¯:",o),e&&(clearTimeout(e),e=null);const l=K.value?.readyState;console.log(`SSE è¿æ¥çŠ¶æ€: ${l} (0=CONNECTING, 1=OPEN, 2=CLOSED)`),l===EventSource.CONNECTING||l===EventSource.CLOSED?W.value.visible&&(console.log("å°è¯•é‡æ–°å»ºç«‹ SSE è¿æ¥..."),W.value.currentFile="è¿æ¥ä¸­æ–­ï¼Œæ­£åœ¨é‡è¿...",setTimeout(()=>{W.value.visible&&Me()},2e3)):(f.error({title:"è¿æ¥é”™è¯¯",message:"BDInfo è¿›åº¦æ›´æ–°è¿æ¥ä¸­æ–­ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"}),W.value.visible=!1,ze(!1))}},ze=(s=!0)=>{K.value&&(K.value.close(),K.value=null),W.value.visible=!1,(s===!0||typeof s=="object"&&s)&&f.info({title:"å·²å–æ¶ˆ",message:"BDInfo è·å–å·²å–æ¶ˆ"})},Zs=async()=>{if(!t.value?.seed_id){console.warn("seed_id æœªè®¾ç½®ï¼Œæ— æ³•è¯·æ±‚å½“å‰è¿›åº¦");return}try{console.log("è¯·æ±‚å½“å‰ BDInfo è¿›åº¦çŠ¶æ€...");const s=await V.get(`/api/migrate/bdinfo_status/${t.value.seed_id}`);if(s.data&&s.data.task_status){const e=s.data.task_status;console.log("è·å–åˆ°å½“å‰è¿›åº¦çŠ¶æ€:",e),e.status==="processing_bdinfo"&&(W.value={visible:!0,percent:Math.round(e.progress_percent||0),currentFile:e.current_file||"å¤„ç†ä¸­...",elapsedTime:e.elapsed_time||"",remainingTime:e.remaining_time||""},console.log(`æ›´æ–°è¿›åº¦æ˜¾ç¤º: ${e.progress_percent||0}%`))}}catch(s){console.error("è¯·æ±‚å½“å‰è¿›åº¦å¤±è´¥:",s)}},Qs=()=>{K.value&&(K.value.close(),K.value=null),as()};Os(()=>{$e(),K.value&&(K.value.close(),K.value=null)});const et=async()=>{if(!t.value.original_main_title){f.warning("æ ‡é¢˜ä¸ºç©ºï¼Œæ— æ³•é‡æ–°è·å–æµ·æŠ¥ã€‚");return}if(Ae.value){f.info({title:"æ­£åœ¨å¤„ç†ä¸­",message:"æµ·æŠ¥é‡æ–°è·å–è¯·æ±‚å·²åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™..."});return}Ae.value=!0,f.info({title:"æ­£åœ¨é‡æ–°è·å–",message:"æ­£åœ¨é‡æ–°ç”Ÿæˆæµ·æŠ¥...",duration:0});const s={type:"poster",content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,source_site:R.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link},savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId};try{const e=await V.post("/api/media/validate",s);f.closeAll(),e.data.success&&e.data.posters?(t.value.intro.poster=e.data.posters,e.data.extracted_imdb_link&&!t.value.imdb_link&&(t.value.imdb_link=e.data.extracted_imdb_link),e.data.extracted_douban_link&&!t.value.douban_link&&(t.value.douban_link=e.data.extracted_douban_link),e.data.extracted_tmdb_link&&!t.value.tmdb_link&&(t.value.tmdb_link=e.data.extracted_tmdb_link),f.success({title:"é‡æ–°è·å–æˆåŠŸ",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æµ·æŠ¥ã€‚"})):f.error({title:"é‡æ–°è·å–å¤±è´¥",message:e.data.error||"æ— æ³•ä»åç«¯è·å–æ–°çš„æµ·æŠ¥ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"})}catch(e){f.closeAll();const o=e.response?.data?.error||"æœªèƒ½é‡æ–°è·å–æµ·æŠ¥ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";f.error({title:"æ“ä½œå¤±è´¥",message:o})}finally{Ae.value=!1}},st=async()=>{if(!t.value.original_main_title){f.warning("æ ‡é¢˜ä¸ºç©ºï¼Œæ— æ³•è§£æã€‚");return}Je.value=!0;try{const s=await V.post("/api/utils/parse_title",{title:t.value.original_main_title,mediainfo:t.value.mediainfo||""});s.data.success?(t.value.title_components=s.data.components,f.success("æ ‡é¢˜å·²é‡æ–°è§£æï¼")):f.error(s.data.message||"è§£æå¤±è´¥")}catch(s){Ue(s,"æœªèƒ½é‡æ–°è§£ææ ‡é¢˜ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚")}finally{Je.value=!1}},tt=async(s,e,o)=>{if(s&&s.includes("pixhost.to")){console.log(`æ£€æµ‹åˆ° pixhost.to å›¾ç‰‡ï¼Œè·³è¿‡æœ‰æ•ˆæ€§æ£€æµ‹: ${s}`);return}if(e==="screenshot"&&Xe.value){console.log(`æˆªå›¾é”™è¯¯å·²æ­£åœ¨å¤„ç†ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚: ${s}`);return}console.error(`å›¾ç‰‡åŠ è½½å¤±è´¥: ç±»å‹=${e}, URL=${s}, ç´¢å¼•=${o}`),e==="screenshot"?(Xe.value=!0,oe.value=!1,f.warning({title:"æˆªå›¾å¤±æ•ˆ",message:"æ£€æµ‹åˆ°æˆªå›¾é“¾æ¥å¤±æ•ˆï¼Œæ­£åœ¨å°è¯•ä»è§†é¢‘é‡æ–°ç”Ÿæˆ..."})):e==="poster"&&f.warning({title:"æµ·æŠ¥å¤±æ•ˆ",message:"æ£€æµ‹åˆ°æµ·æŠ¥é“¾æ¥å¤±æ•ˆï¼Œæ­£åœ¨å°è¯•é‡æ–°è·å–..."});const l={type:e,content_name:t.value.original_main_title,source_info:{main_title:t.value.original_main_title,source_site:R.value,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link},savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId};try{const n=await V.post("/api/media/validate",l);n.data.success?e==="screenshot"&&n.data.screenshots?(t.value.intro.screenshots=n.data.screenshots,oe.value=!0,f.success({title:"æˆªå›¾å·²æ›´æ–°",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æˆªå›¾ã€‚"})):e==="poster"&&n.data.posters&&(t.value.intro.poster=n.data.posters,f.success({title:"æµ·æŠ¥å·²æ›´æ–°",message:"å·²æˆåŠŸç”Ÿæˆå¹¶åŠ è½½äº†æ–°çš„æµ·æŠ¥ã€‚"})):(e==="screenshot"&&(oe.value=!1),f.error({title:"æ›´æ–°å¤±è´¥",message:n.data.error||`æ— æ³•ä»åç«¯è·å–æ–°çš„${e==="poster"?"æµ·æŠ¥":"æˆªå›¾"}ã€‚`}))}catch(n){const u=n.response?.data?.error||`å‘é€å¤±æ•ˆ${e==="poster"?"æµ·æŠ¥":"æˆªå›¾"}ä¿¡æ¯è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚`;console.error("å‘é€å¤±æ•ˆå›¾ç‰‡ä¿¡æ¯è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯:",n),f.error({title:"æ“ä½œå¤±è´¥",message:u})}finally{e==="screenshot"&&(Xe.value=!1)}},ts=async s=>{const e=ce.value.find(o=>o.name===s);if(e?.site)return e.site;try{const o=await V.get("/api/sites/status");ce.value=o.data;const l=ce.value.find(n=>n.name===s);if(l?.site)return l.site}catch(o){console.warn("è·å–ç«™ç‚¹çŠ¶æ€å¤±è´¥:",o)}return s.toLowerCase()},at=async()=>{try{const s=await V.get("/api/sites/status");ce.value=s.data;const e=await V.get("/api/downloaders_list");Ze.value=e.data}catch{f.error({title:"é”™è¯¯",message:"æ— æ³•ä»æœåŠ¡å™¨è·å–ç«™ç‚¹çŠ¶æ€åˆ—è¡¨æˆ–ä¸‹è½½å™¨åˆ—è¡¨"})}},lt=async()=>{try{const s=await V.get("/api/settings/cross_seed");_e.value=!!s.data?.auto_add_existing_to_downloader}catch(s){console.warn("è·å–å‘ç§è®¾ç½®å¤±è´¥:",s)}},ot=async()=>{try{await V.post("/api/settings/cross_seed",{auto_add_existing_to_downloader:_e.value})}catch(s){console.warn("ä¿å­˜å‘ç§è®¾ç½®å¤±è´¥:",s),f.error({title:"é”™è¯¯",message:"ä¿å­˜è®¾ç½®å¤±è´¥"})}},nt=async()=>{if(!R.value||!k.value)return;const s=k.value.sites[R.value];let e=s.torrentId||null;if(!e){const n=s.comment?.match(/id=(\d+)/);if(!n||!n[1]){f.error(`æ— æ³•ä»æºç«™ç‚¹ ${R.value} çš„é“¾æ¥ä¸­æå–ç§å­IDã€‚`),ve("cancel");return}e=n[1]}L.value=!0;const o=`fetch_${e}_${Date.now()}`;vs.value=o,Pe.value=!0;let l=null;try{const n=await ts(R.value);console.log(`å°è¯•ä»æ•°æ®åº“è¯»å–ç§å­ä¿¡æ¯: ${e} from ${R.value} (${n})`);const u=await V.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:n,task_id:o},timeout:6e5});if(u.status===202&&u.data.should_fetch){console.log("æ•°æ®åº“ä¸­æ²¡æœ‰ç¼“å­˜ï¼Œç»§ç»­ä½¿ç”¨åŒä¸€æ—¥å¿—æµä»æºç«™ç‚¹æŠ“å–...");const d=u.data.task_id||o;try{const m=await V.post("/api/migrate/fetch_and_store",{sourceSite:R.value,searchTerm:e,savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId,task_id:d},{timeout:6e5});if(!m.data.success){f.closeAll();const $=m.data.message||"ä»æºç«™ç‚¹æŠ“å–å¤±è´¥";de.value=H($),te.value=!0,L.value=!1;return}const v=await V.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:n},timeout:6e5});if(!v.data.success){f.closeAll();const $="æ•°æ®æŠ“å–æˆåŠŸä½†ä»æ•°æ®åº“è¯»å–å¤±è´¥";de.value=H($),te.value=!0,L.value=!1;return}f.closeAll(),f.success({title:"æŠ“å–æˆåŠŸ",message:"ç§å­ä¿¡æ¯å·²æˆåŠŸæŠ“å–å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè¯·æ ¸å¯¹ã€‚"});const _=v.data.data;v.data.reverse_mappings&&(M.value=v.data.reverse_mappings);const b=`${_.hash||e}_${e}_${n}`;t.value={seed_id:b,original_main_title:_.title||"",title_components:_.title_components||[],subtitle:_.subtitle,imdb_link:_.imdb_link,douban_link:_.douban_link,tmdb_link:_.tmdb_link,intro:{statement:q(_.statement)||"",poster:_.poster||"",body:q(_.body)||"",screenshots:_.screenshots||"",removed_ardtudeclarations:_.removed_ardtudeclarations||[]},mediainfo:_.mediainfo||"",source_params:_.source_params||{},standardized_params:{type:_.type||"",medium:_.medium||"",video_codec:_.video_codec||"",audio_codec:_.audio_codec||"",resolution:_.resolution||"",team:_.team||"",source:_.source||"",tags:(_.tags||[]).sort(($,j)=>{const B=["ç¦è½¬","tag.ç¦è½¬","é™è½¬","tag.é™è½¬","åˆ†é›†","tag.åˆ†é›†"],me=B.includes($),be=B.includes(j);return me===be?0:me?-1:1})},final_publish_parameters:_.final_publish_parameters||{},complete_publish_params:_.complete_publish_params||{},raw_params_for_preview:_.raw_params_for_preview||{}},Q.value=m.data.task_id,Ce.value=!0,E.value=0,gs(b,!0),Te(()=>{ns()}),L.value=!1;return}catch(m){f.closeAll(),Ue(m,"ä»æºç«™ç‚¹æŠ“å–æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚"),L.value=!1;return}}else if(u.data.success){f.closeAll(),f.success({title:"è¯»å–æˆåŠŸ",message:"ç§å­ä¿¡æ¯å·²ä»æ•°æ®åº“æˆåŠŸåŠ è½½ï¼Œè¯·æ ¸å¯¹ã€‚"});const d=u.data.data;if(!d||!d.title)throw new Error("æ•°æ®åº“è¿”å›çš„ç§å­ä¿¡æ¯ä¸å®Œæ•´");u.data.reverse_mappings?(M.value=u.data.reverse_mappings,console.log("æˆåŠŸåŠ è½½åå‘æ˜ å°„è¡¨:",M.value),console.log("typeæ˜ å°„æ•°é‡:",Object.keys(M.value.type||{}).length),console.log("å½“å‰standardized_params:",d.standardized_params)):console.warn("åç«¯æœªè¿”å›åå‘æ˜ å°„è¡¨ï¼Œå°†ä½¿ç”¨ç©ºçš„é»˜è®¤æ˜ å°„");const m=`${d.hash||e}_${e}_${n}`;if(t.value={seed_id:m,original_main_title:d.title||"",title_components:d.title_components||[],subtitle:d.subtitle,imdb_link:d.imdb_link,douban_link:d.douban_link,tmdb_link:d.tmdb_link,intro:{statement:q(d.statement)||"",poster:d.poster||"",body:q(d.body)||"",screenshots:d.screenshots||"",removed_ardtudeclarations:d.removed_ardtudeclarations||[]},mediainfo:d.mediainfo||"",source_params:d.source_params||{},standardized_params:{type:d.type||"",medium:d.medium||"",video_codec:d.video_codec||"",audio_codec:d.audio_codec||"",resolution:d.resolution||"",team:d.team||"",source:d.source||"",tags:(d.tags||[]).sort((v,_)=>{const b=["ç¦è½¬","tag.ç¦è½¬","é™è½¬","tag.é™è½¬","åˆ†é›†","tag.åˆ†é›†"],$=b.includes(v),j=b.includes(_);return $===j?0:$?-1:1})},final_publish_parameters:d.final_publish_parameters||{},complete_publish_params:d.complete_publish_params||{},raw_params_for_preview:d.raw_params_for_preview||{}},(!d.title_components||d.title_components.length===0)&&d.title)try{const v=await V.post("/api/utils/parse_title",{title:d.title});v.data.success&&(t.value.title_components=v.data.components,f.info({title:"æ ‡é¢˜è§£æ",message:"å·²è‡ªåŠ¨è§£æä¸»æ ‡é¢˜ä¸ºç»„ä»¶ä¿¡æ¯ã€‚"}))}catch(v){console.warn("è‡ªåŠ¨è§£ææ ‡é¢˜å¤±è´¥:",v)}if(console.log("è®¾ç½®torrentData.standardized_params:",t.value.standardized_params),console.log("æ£€æŸ¥ç»‘å®š - type:",t.value.standardized_params.type),console.log("æ£€æŸ¥ç»‘å®š - medium:",t.value.standardized_params.medium),u.data.task_id?(Q.value=u.data.task_id,f.success({title:"ç¼“å­˜å‡†å¤‡å®Œæˆ",message:"å‘å¸ƒä»»åŠ¡å·²å‡†å¤‡å°±ç»ª"})):(Q.value=`db_${e}_${n}`,console.warn("åç«¯æœªè¿”å›taskIdï¼Œä½¿ç”¨æ ‡è¯†ç¬¦")),Ce.value=!0,gs(m,!1),(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let v=!1,_=!1;if(!t.value.imdb_link){const b=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,$=t.value.intro.body.match(b);$&&$[1]&&(t.value.imdb_link=$[1],v=!0)}if(!t.value.douban_link){const b=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,$=t.value.intro.body.match(b);$&&$[1]&&(t.value.douban_link=$[1],_=!0)}if(v||_){const b=[];v&&b.push("IMDbé“¾æ¥"),_&&b.push("è±†ç“£é“¾æ¥"),f.info({title:"è‡ªåŠ¨å¡«å……",message:`å·²ä»ç®€ä»‹æ­£æ–‡ä¸­è‡ªåŠ¨æå–å¹¶å¡«å…… ${b.join(" å’Œ ")}ã€‚`})}}E.value=0,Te(()=>{ns()}),Ce.value=!0,L.value=!1;return}else console.log("æ•°æ®åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ç§å­ä¿¡æ¯ï¼Œå¼€å§‹æŠ“å–æ•°æ®...")}catch(n){l=n,console.log("ä»æ•°æ®åº“è¯»å–å¤±è´¥ï¼Œå¼€å§‹æŠ“å–æ•°æ®...",n),n.code==="ECONNABORTED"||n.message.includes("timeout")?console.warn("æ•°æ®åº“è¯»å–è¶…æ—¶ï¼Œå°†å°è¯•ç›´æ¥æŠ“å–æ•°æ®..."):n.response?.status>=500?console.warn("æ•°æ®åº“æœåŠ¡å™¨é”™è¯¯ï¼Œå°†å°è¯•ç›´æ¥æŠ“å–æ•°æ®..."):console.warn("æ•°æ®åº“è¯»å–å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œå°†å°è¯•ç›´æ¥æŠ“å–æ•°æ®...")}try{f.closeAll(),f({title:"æ­£åœ¨æŠ“å–",message:"æ­£åœ¨ä»æºç«™ç‚¹æŠ“å–ç§å­ä¿¡æ¯å¹¶å­˜å‚¨åˆ°æ•°æ®åº“...",type:"info",duration:0}),l&&(console.warn(`ç”±äºæ•°æ®åº“è¯»å–å¤±è´¥ï¼ˆ${l.message}ï¼‰ï¼Œæ­£åœ¨ç›´æ¥æŠ“å–æ•°æ®...`),f.warning({title:"æ•°æ®åº“è¯»å–å¤±è´¥",message:"æ­£åœ¨å°è¯•ç›´æ¥æŠ“å–æ•°æ®ï¼Œè¯·ç¨å€™...",duration:3e3}));const n=await V.post("/api/migrate/fetch_and_store",{sourceSite:R.value,searchTerm:e,savePath:k.value.save_path,torrentName:k.value.name,downloaderId:k.value.downloaderId||(k.value.downloaderIds?.length>0?k.value.downloaderIds[0]:null)},{timeout:6e5});if(n.data.success){console.log("æ•°æ®æŠ“å–æˆåŠŸï¼Œç«‹å³ä»æ•°æ®åº“è¯»å–...");let u=0;const d=3;let m=null;for(;u<d;){u++;try{const v=await ts(R.value);if(console.log(`é‡è¯•ä»æ•°æ®åº“è¯»å–ç§å­ä¿¡æ¯: ${e} from ${R.value} (${v})`),m=await V.get("/api/migrate/get_db_seed_info",{params:{torrent_id:e,site_name:v},timeout:6e5}),m.data.success)break;console.warn(`æ•°æ®åº“è¯»å–ç¬¬${u}æ¬¡å¤±è´¥ï¼š${m.data.message}`),u<d&&await new Promise(_=>setTimeout(_,1e3))}catch(v){if(console.warn(`æ•°æ®åº“è¯»å–ç¬¬${u}æ¬¡å¤±è´¥ï¼š`,v),u<d)await new Promise(_=>setTimeout(_,1e3));else throw v}}if(m&&m.data.success){f.closeAll();const v=m.data.data;if(!v||!v.title)throw new Error("æ•°æ®åº“è¿”å›çš„ç§å­ä¿¡æ¯ä¸å®Œæ•´");m.data.reverse_mappings?(M.value=m.data.reverse_mappings,console.log("æˆåŠŸåŠ è½½åå‘æ˜ å°„è¡¨:",M.value)):console.warn("åç«¯æœªè¿”å›åå‘æ˜ å°„è¡¨ï¼Œå°†ä½¿ç”¨ç©ºçš„é»˜è®¤æ˜ å°„"),f.success({title:"æŠ“å–æˆåŠŸ",message:l?"ç§å­ä¿¡æ¯å·²æˆåŠŸæŠ“å–ï¼Œè¯·æ ¸å¯¹ã€‚ç”±äºæ•°æ®åº“è¯»å–å¤±è´¥ï¼Œæ•°æ®æœªæŒä¹…åŒ–å­˜å‚¨ã€‚":"ç§å­ä¿¡æ¯å·²æˆåŠŸæŠ“å–å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè¯·æ ¸å¯¹ã€‚"});const _=`${v.hash||e}_${e}_${englishSiteName}`;if(t.value={seed_id:_,original_main_title:v.title||"",title_components:v.title_components||[],subtitle:v.subtitle,imdb_link:v.imdb_link,douban_link:v.douban_link,tmdb_link:v.tmdb_link,intro:{statement:q(v.statement)||"",poster:v.poster||"",body:q(v.body)||"",screenshots:v.screenshots||"",removed_ardtudeclarations:v.removed_ardtudeclarations||[]},mediainfo:v.mediainfo||"",source_params:v.source_params||{},standardized_params:{type:v.type||"",medium:v.medium||"",video_codec:v.video_codec||"",audio_codec:v.audio_codec||"",resolution:v.resolution||"",team:v.team||"",source:v.source||"",tags:(v.tags||[]).sort((b,$)=>{const j=["ç¦è½¬","tag.ç¦è½¬","é™è½¬","tag.é™è½¬","åˆ†é›†","tag.åˆ†é›†"],B=j.includes(b),me=j.includes($);return B===me?0:B?-1:1})},final_publish_parameters:v.final_publish_parameters||{},complete_publish_params:v.complete_publish_params||{},raw_params_for_preview:v.raw_params_for_preview||{}},(!v.title_components||v.title_components.length===0)&&v.title)try{const b=await V.post("/api/utils/parse_title",{title:v.title});b.data.success&&(t.value.title_components=b.data.components,f.info({title:"æ ‡é¢˜è§£æ",message:"å·²è‡ªåŠ¨è§£æä¸»æ ‡é¢˜ä¸ºç»„ä»¶ä¿¡æ¯ã€‚"}))}catch(b){console.warn("è‡ªåŠ¨è§£ææ ‡é¢˜å¤±è´¥:",b)}if(Q.value=n.data.task_id,Ce.value=!0,(!t.value.imdb_link||!t.value.douban_link)&&t.value.intro.body){let b=!1,$=!1;if(!t.value.imdb_link){const j=/(https?:\/\/www\.imdb\.com\/title\/tt\d+)/,B=t.value.intro.body.match(j);B&&B[1]&&(t.value.imdb_link=B[1],b=!0)}if(!t.value.douban_link){const j=/(https:\/\/movie\.douban\.com\/subject\/\d+)/,B=t.value.intro.body.match(j);B&&B[1]&&(t.value.douban_link=B[1],$=!0)}if(b||$){const j=[];b&&j.push("IMDbé“¾æ¥"),$&&j.push("è±†ç“£é“¾æ¥"),f.info({title:"è‡ªåŠ¨å¡«å……",message:`å·²ä»ç®€ä»‹æ­£æ–‡ä¸­è‡ªåŠ¨æå–å¹¶å¡«å…… ${j.join(" å’Œ ")}ã€‚`})}}E.value=0,Te(()=>{ns()})}else{f.closeAll();const v=`æ•°æ®æŠ“å–æˆåŠŸä½†æ•°æ®åº“è¯»å–å¤±è´¥ï¼Œå·²é‡è¯•${d}æ¬¡ã€‚è¯·æ£€æŸ¥æ•°æ®åº“è¿æ¥æˆ–ç¨åé‡è¯•ã€‚`;de.value=H(v),te.value=!0,L.value=!1}}else{f.closeAll();const u=n.data.message||"æŠ“å–ç§å­ä¿¡æ¯å¤±è´¥";let d=u;(u.includes("æ•°æ®åº“")||l)&&(d=`${u}ã€‚å¯èƒ½ç”±äºæ•°æ®åº“è¿æ¥é—®é¢˜å¯¼è‡´ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“çŠ¶æ€ã€‚`),de.value=H(d),te.value=!0,L.value=!1}}catch(n){if(f.closeAll(),n.code==="ECONNABORTED"||n.message.includes("timeout")){const u="æŠ“å–ç§å­ä¿¡æ¯è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚";de.value=H(u),te.value=!0}else if(n.response?.status===404){const u="åœ¨æºç«™ç‚¹æœªæ‰¾åˆ°æŒ‡å®šçš„ç§å­ï¼Œè¯·æ£€æŸ¥ç§å­IDæ˜¯å¦æ­£ç¡®ã€‚";de.value=H(u),te.value=!0}else if(n.response?.status>=500){const u="åç«¯æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜ã€‚";de.value=H(u),te.value=!0}else{const u=n.message||"è·å–ç§å­ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚";de.value=H(u),te.value=!0}}finally{L.value=!1}},ae=F(()=>{const s=t.value.standardized_params,e=["type","medium","video_codec","audio_codec","resolution","team","source"],o=[],l=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_+-]+$/u);for(const n of e){const u=s[n];u&&typeof u=="string"&&u.trim()!==""&&!l.test(u)&&o.push(n)}return Oe.value.length>0&&o.push("tags"),o}),hs=s=>!s||typeof s!="string"?s:s.replace(/^-/,""),bs=(s,e)=>{s.key==="åˆ¶ä½œç»„"&&(s.value=hs(e))},it=async()=>{if(console.log("=== ä»storeè·å–çš„å·²å­˜åœ¨ç«™ç‚¹ä¿¡æ¯ ==="),console.log("torrent.value:",k.value),console.log("torrent.value.sites:",k.value?.sites),k.value?.sites){const e=Object.keys(k.value.sites);console.log("å·²å­˜åœ¨çš„ç«™ç‚¹åˆ—è¡¨:",e),console.log("å·²å­˜åœ¨ç«™ç‚¹è¯¦ç»†ä¿¡æ¯:",k.value.sites)}else console.log("æœªæ‰¾åˆ°å·²å­˜åœ¨ç«™ç‚¹ä¿¡æ¯");console.log("=====================================");const s=ae.value;if(s.length>0){const e={type:"ç±»å‹",medium:"åª’ä»‹",video_codec:"è§†é¢‘ç¼–ç ",audio_codec:"éŸ³é¢‘ç¼–ç ",resolution:"åˆ†è¾¨ç‡",team:"åˆ¶ä½œç»„",source:"äº§åœ°",tags:"æ ‡ç­¾"},o=s.map(l=>e[l]||l);f({title:"å‚æ•°æ ¼å¼ä¸æ­£ç¡®",message:`ä»¥ä¸‹å‚æ•°æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä¿®æ”¹ä¸º *.* çš„æ ‡å‡†æ ¼å¼: ${o.join(", ")}`,type:"warning",duration:0,showClose:!0});return}L.value=!0;try{f({title:"æ­£åœ¨å¤„ç†",message:"æ­£åœ¨æ›´æ–°å‚æ•°å¹¶ç”Ÿæˆé¢„è§ˆ...",type:"info",duration:0});let e,o;if(Ce.value&&Q.value&&Q.value.startsWith("db_")){const d=Q.value.split("_");d.length>=3&&(e=d[1],o=d.slice(2).join("_"))}else if(Q.value&&Q.value.startsWith("db_")){const d=Q.value.split("_");d.length>=3&&(e=d[1],o=d.slice(2).join("_"))}else{const d=k.value.sites[R.value];if(e=d.torrentId||null,o=await ts(R.value),!e){const m=d.comment?.match(/id=(\d+)/);m&&m[1]&&(e=m[1])}}if(!e||!o){f.error({title:"å‚æ•°é”™è¯¯",message:"æ— æ³•è·å–ç§å­IDæˆ–ç«™ç‚¹åç§°",duration:0,showClose:!0});return}console.log(`æ›´æ–°ç§å­å‚æ•°: ${e} from ${o}`);const l=t.value.title_components.map(d=>d.key==="åˆ¶ä½œç»„"?{...d,value:hs(d.value)}:d),n={title:t.value.original_main_title,subtitle:t.value.subtitle,imdb_link:t.value.imdb_link,douban_link:t.value.douban_link,tmdb_link:t.value.tmdb_link,poster:t.value.intro.poster,screenshots:t.value.intro.screenshots,statement:q(t.value.intro.statement),body:q(t.value.intro.body),mediainfo:t.value.mediainfo,source_params:t.value.source_params,title_components:l,standardized_params:t.value.standardized_params};console.log("å‘é€åˆ°åç«¯çš„æ ‡å‡†å‚æ•°:",t.value.standardized_params);const u=await V.post("/api/migrate/update_db_seed_info",{torrent_name:k.value.name,torrent_id:e,site_name:o,updated_parameters:n});if(console.log("å·²è°ƒç”¨æ›´æ–°æ¥å£ï¼Œis_reviewed å°†è¢«è®¾ç½®ä¸º true"),f.closeAll(),u.data.success){f.closeAll();const{standardized_params:d,final_publish_parameters:m,complete_publish_params:v,raw_params_for_preview:_,reverse_mappings:b}=u.data;b&&(M.value=b,console.log("æˆåŠŸæ›´æ–°åå‘æ˜ å°„è¡¨:",M.value)),t.value={...t.value,standardized_params:d||{},final_publish_parameters:m||{},complete_publish_params:v||{},raw_params_for_preview:_||{}},f.success({title:"æ›´æ–°æˆåŠŸ",message:"å‚æ•°å·²æ›´æ–°å¹¶é‡æ–°æ ‡å‡†åŒ–ï¼Œè¯·æ ¸å¯¹é¢„è§ˆå†…å®¹ã€‚"}),E.value=1}else f.error({title:"æ›´æ–°å¤±è´¥",message:u.data.message||"æ›´æ–°å‚æ•°å¤±è´¥",duration:0,showClose:!0})}catch(e){f.closeAll(),Ue(e,"æ›´æ–°é¢„è§ˆæ•°æ®æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹åå°æ—¥å¿—ã€‚")}finally{L.value=!1}},rt=F(()=>{const s=Object.keys(M.value.tags||{}),e=t.value.standardized_params.tags||[];return[...new Set([...s,...e])].filter(n=>!Fe(n)).map(n=>({value:n,label:M.value.tags[n]||n}))}),dt=s=>s==="ç¦è½¬"||s==="tag.ç¦è½¬"||s==="é™è½¬"||s==="tag.é™è½¬"||s==="åˆ†é›†"||s==="tag.åˆ†é›†"?"danger":(console.log(`[getTagType] æ£€æŸ¥æ ‡ç­¾: "${s}", æ˜¯å¦æ— æ•ˆ: ${Oe.value.includes(s)}`),Oe.value.includes(s)?"danger":"info"),ut=async()=>{const s=k.value?.sites?Object.keys(k.value.sites).length:0;if(s<2){console.log(`å·²å­˜åœ¨ç«™ç‚¹æ•°é‡ä¸è¶³(${s}ä¸ª)ï¼Œæ­£åœ¨é‡æ–°è·å–ç§å­æ•°æ®...`);try{f.info({title:"æ­£åœ¨æ›´æ–°æ•°æ®",message:"æ­£åœ¨é‡æ–°è·å–ç§å­ç«™ç‚¹ä¿¡æ¯...",duration:0});const e=new URLSearchParams({page:"1",pageSize:"1",nameSearch:k.value.name}),l=(await V.get(`/api/data?${e.toString()}`)).data;if(l.error)throw new Error(l.error);if(l.data&&l.data.length>0){const n=l.data[0];console.log("é‡æ–°è·å–åˆ°çš„ç§å­æ•°æ®:",n),console.log("é‡æ–°è·å–åˆ°çš„ç«™ç‚¹ä¿¡æ¯:",n.sites),console.log(`ç«™ç‚¹æ•°é‡ä» ${s} æ›´æ–°åˆ° ${Object.keys(n.sites).length}`),Ie.setParams(n),f.success({title:"æ•°æ®æ›´æ–°æˆåŠŸ",message:`å·²é‡æ–°è·å–ç§å­ç«™ç‚¹ä¿¡æ¯ï¼Œå‘ç° ${Object.keys(n.sites).length} ä¸ªç«™ç‚¹`})}else f.warning({title:"æœªæ‰¾åˆ°ç§å­",message:"æœªèƒ½æ‰¾åˆ°åŒ¹é…çš„ç§å­æ•°æ®"})}catch(e){console.error("é‡æ–°è·å–ç§å­æ•°æ®æ—¶å‡ºé”™:",e),f.error({title:"æ•°æ®æ›´æ–°å¤±è´¥",message:e.message||"é‡æ–°è·å–ç§å­æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯"})}}else console.log(`å·²å­˜åœ¨ç«™ç‚¹æ•°é‡å……è¶³(${s}ä¸ª)ï¼Œè·³è¿‡é‡æ–°è·å–`);E.value=2},ct=s=>{const e=O.value.indexOf(s);e>-1?O.value.splice(e,1):O.value.push(s)},mt=()=>{const s=ce.value.filter(e=>e.is_target&&ss(e.name)).map(e=>e.name);O.value=s},pt=()=>{O.value=[]};qe(Qe,s=>{s||(O.value=O.value.filter(e=>{const o=ce.value.find(l=>l.name===e);return!es(o)}))});const vt=(s,e)=>{const o={siteName:s,...e,message:Ss(e?.logs||"å‘å¸ƒæˆåŠŸ")};if(e?.logs&&e.logs.includes("ç§å­å·²å­˜åœ¨")&&(o.isExisted=!0),e?.pre_check&&e?.limit_reached)return o.downloaderStatus={success:!1,message:e.logs||"å‘å¸ƒå‰é¢„æ£€æŸ¥è§¦å‘é™åˆ¶",downloaderName:"å‘å¸ƒå‰é™åˆ¶",limit_reached:!0,pre_check:!0},o;if(e?.auto_add_result){const l=e.auto_add_result;let n="è‡ªåŠ¨æ£€æµ‹";if(l.limit_reached)n="é™åˆ¶è§¦å‘";else if(l.downloader_id){const u=Ze.value.find(d=>d.id===l.downloader_id);u&&(n=u.name)}o.downloaderStatus={success:l.success,message:l.message,downloaderName:n,limit_reached:!!l.limit_reached}}return o},ys=()=>{ee.value=O.value.map(s=>Ve.value[s]).filter(Boolean)},ws=()=>{const s=Object.values(Ve.value);ie.value.current=s.length,re.value.current=s.filter(e=>e?.auto_add_result?.success).length},_t=async()=>{$e(),E.value=3,L.value=!0,ee.value=[],Ve.value={},fe.value=[],ue.value={visible:!1,title:"",message:""},Z.value="";const s=O.value.length;ie.value={current:0,total:s},re.value={current:0,total:s},f({title:"æ­£åœ¨å‘å¸ƒ",message:`å‡†å¤‡å‘ ${s} ä¸ªç«™ç‚¹å‘å¸ƒç§å­...`,type:"info",duration:0});try{const e=await V.post("/api/migrate/publish_batch/start",{task_id:Q.value,upload_data:{...t.value,save_path:k.value.save_path},targetSites:O.value,sourceSite:R.value,downloaderId:k.value.downloaderId,auto_add_to_downloader:!0,auto_add_existing_to_downloader:_e.value});if(!e.data?.success||!e.data?.batch_id)throw new Error(e.data?.message||"æ‰¹é‡å‘å¸ƒä»»åŠ¡å¯åŠ¨å¤±è´¥");return Ke.value=e.data.batch_id,ge.value=new EventSource(`/api/migrate/publish_batch/stream/${Ke.value}`),ge.value.onmessage=async o=>{try{const l=JSON.parse(o.data);switch(l.type){case"heartbeat":case"connected":case"complete":return;case"batch_stopped":{const n=l.reason,u=l.message,d=n==="limit_reached"?"å‘ç§é™åˆ¶è§¦å‘":n==="pre_check_limit"?"å‘å¸ƒå‰é™åˆ¶è§¦å‘":n==="cancelled"?"å·²å–æ¶ˆ":"æ‰¹é‡å‘å¸ƒå·²åœæ­¢";ue.value={visible:!0,title:d,message:u||""};return}case"site_started":{const n=l.siteName;n&&!fe.value.includes(n)&&fe.value.push(n);return}case"site_finished":{const n=l.siteName;if(n){const u=fe.value.indexOf(n);u!==-1&&fe.value.splice(u,1)}Ve.value[n]=vt(n,l.result),ys(),ws();return}case"batch_finished":{$e(),f.closeAll(),ys(),ws();const n=ee.value,u=O.value.length,d=n.filter(_=>_?.success).length,m=n.filter(_=>_?.downloaderStatus?.success).length;f.success({title:"å‘å¸ƒå®Œæˆ",message:`å‘å¸ƒæˆåŠŸ ${d} / ${u}ï¼Œä¸‹è½½å™¨æ·»åŠ æˆåŠŸ ${m} / ${u}ã€‚`});const v=n.map(_=>{const b=_?.logs||"No logs available.";let $=`--- Log for ${_.siteName} ---
${b}`;return _?.downloaderStatus&&($+=`

--- Downloader Status for ${_.siteName} ---`,$+=_.downloaderStatus.success?`
âœ… æˆåŠŸ: ${_.downloaderStatus.message}`:`
âŒ å¤±è´¥: ${_.downloaderStatus.message}`),$});Z.value=v.join(`

`);try{await V.post("/api/refresh_data"),f.success({title:"æ•°æ®åˆ·æ–°",message:"ç§å­æ•°æ®å·²åˆ·æ–°"})}catch(_){console.warn("åˆ·æ–°ç§å­æ•°æ®å¤±è´¥:",_)}L.value=!1;return}case"error":throw new Error(l.message||"æ‰¹é‡å‘å¸ƒ SSE é”™è¯¯");default:return}}catch(l){console.error("æ‰¹é‡å‘å¸ƒ SSE æ¶ˆæ¯å¤„ç†å¤±è´¥:",l)}},ge.value.onerror=o=>{console.error("æ‰¹é‡å‘å¸ƒ SSE è¿æ¥é”™è¯¯:",o),$e(),f.closeAll(),f.error({title:"è¿æ¥é”™è¯¯",message:"æ‰¹é‡å‘å¸ƒè¿›åº¦è¿æ¥ä¸­æ–­ï¼Œè¯·ç¨åé‡è¯•",duration:0,showClose:!0}),L.value=!1},!0}catch(e){return console.error("æ‰¹é‡å‘å¸ƒå¯åŠ¨å¤±è´¥:",e),$e(),f.closeAll(),Ue(e,"æ‰¹é‡å‘å¸ƒå¯åŠ¨å¤±è´¥"),L.value=!1,!1}},ft=async()=>{E.value=3,L.value=!0,ee.value=[];const s=O.value.length;ie.value={current:0,total:s},re.value={current:0,total:s},f({title:"æ­£åœ¨å‘å¸ƒ",message:`å‡†å¤‡å‘ ${O.value.length} ä¸ªç«™ç‚¹å‘å¸ƒç§å­...`,type:"info",duration:0});const e=[];for(const m of O.value){try{const v=await V.post("/api/migrate/publish",{task_id:Q.value,upload_data:{...t.value,save_path:k.value.save_path},targetSite:m,sourceSite:R.value,downloaderId:k.value.downloaderId,auto_add_to_downloader:!0,auto_add_existing_to_downloader:_e.value}),_={siteName:m,message:Ss(v.data.logs||"å‘å¸ƒæˆåŠŸ"),...v.data};if(v.data.logs&&v.data.logs.includes("ç§å­å·²å­˜åœ¨")&&(_.isExisted=!0),_.auto_add_result&&_.auto_add_result.limit_reached){const b=_.auto_add_result.message;_.downloaderStatus={success:!1,message:_.auto_add_result.message,downloaderName:"é™åˆ¶è§¦å‘",limit_reached:!0},e.push(_),ee.value=[...e],ue.value={visible:!0,title:"å‘ç§é™åˆ¶è§¦å‘",message:b},Z.value=`

=== ğŸš« å‘ç§é™åˆ¶è§¦å‘ ===
${b}

=== ğŸ›‘ æ‰¹é‡å‘å¸ƒå·²åœæ­¢ ===
ç”±äºå‘ç§é™åˆ¶è§¦å‘ï¼Œåç»­ ${O.value.length-e.length} ä¸ªç«™ç‚¹å‘å¸ƒå·²æš‚åœã€‚

`+Z.value,f({title:"å‘ç§é™åˆ¶è§¦å‘",message:`${m} å‘å¸ƒæˆåŠŸä½†å› é™åˆ¶æ— æ³•æ·»åŠ åˆ°ä¸‹è½½å™¨
${b}
åç»­ç«™ç‚¹å‘å¸ƒå·²è‡ªåŠ¨åœæ­¢ã€‚`,type:"warning",duration:0,showClose:!0});break}if(_.pre_check&&_.limit_reached){const b=_.message.replace("ğŸš« å‘å¸ƒå‰é¢„æ£€æŸ¥è§¦å‘é™åˆ¶: ","");_.downloaderStatus={success:!1,message:_.message,downloaderName:"å‘å¸ƒå‰é™åˆ¶",limit_reached:!0,pre_check:!0},e.push(_),ee.value=[...e],ue.value={visible:!0,title:"å‘å¸ƒå‰é™åˆ¶è§¦å‘",message:b},Z.value=`

=== ğŸš« å‘ç§é™åˆ¶è§¦å‘ ===
${b}

=== ğŸ›‘ æ‰¹é‡å‘å¸ƒå·²åœæ­¢ ===
ç”±äºå‘ç§é™åˆ¶è§¦å‘ï¼Œåç»­ ${O.value.length-e.length} ä¸ªç«™ç‚¹å‘å¸ƒå·²æš‚åœã€‚

`+Z.value,f({title:"å‘å¸ƒå‰é™åˆ¶è§¦å‘",message:`${m} å› å‘ç§é™åˆ¶æ— æ³•å‘å¸ƒ
${b}
åç»­ç«™ç‚¹å‘å¸ƒå·²è‡ªåŠ¨åœæ­¢ã€‚`,type:"warning",duration:0,showClose:!0});break}if(_.auto_add_result){let b="è‡ªåŠ¨æ£€æµ‹";if(_.auto_add_result.downloader_id){const $=Ze.value.find(j=>j.id===_.auto_add_result.downloader_id);$&&(b=$.name)}_.downloaderStatus={success:_.auto_add_result.success,message:_.auto_add_result.message,downloaderName:b},_.auto_add_result.success&&re.value.current++}e.push(_),ee.value=[...e],_.success&&(_.downloaderStatus?.success===!1?f.warning({title:`å‘å¸ƒæˆåŠŸä½†æ·»åŠ å¤±è´¥ - ${m}`,message:_.downloaderStatus.message||"è‡ªåŠ¨æ·»åŠ åˆ°ä¸‹è½½å™¨å¤±è´¥"}):f.success({title:`å‘å¸ƒæˆåŠŸ - ${m}`,message:"ç§å­å·²æˆåŠŸå‘å¸ƒåˆ°è¯¥ç«™ç‚¹"}))}catch(v){const _={siteName:m,success:!1,logs:v.response?.data?.logs||v.message,url:null,message:`å‘å¸ƒåˆ° ${m} æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—ã€‚`,downloaderStatus:{success:!1,message:"å‘å¸ƒå¤±è´¥ï¼Œæ— æ³•æ·»åŠ åˆ°ä¸‹è½½å™¨",downloaderName:"é”™è¯¯"}};e.push(_),ee.value=[...e],f.error({title:`å‘å¸ƒå¤±è´¥ - ${m}`,message:_.message})}ie.value.current++,await new Promise(v=>setTimeout(v,1e3))}f.closeAll();const o=O.value.length,l=e.filter(m=>m.success).length,n=e.filter(m=>m?.downloaderStatus?.success).length;f.success({title:"å‘å¸ƒå®Œæˆ",message:`å‘å¸ƒæˆåŠŸ ${l} / ${o}ï¼Œä¸‹è½½å™¨æ·»åŠ æˆåŠŸ ${n} / ${o}ã€‚`}),Z.value+=`

--- [è‡ªåŠ¨æ·»åŠ ä»»åŠ¡ç»“æœ] ---`;const u={};e.forEach(m=>{if(m.auto_add_result){const v=m.downloaderStatus?.downloaderName||"è‡ªåŠ¨æ£€æµ‹";u[m.siteName]={success:m.auto_add_result.success,message:m.auto_add_result.message,downloaderName:v};const _=m.auto_add_result.success?"âœ…":"âŒ",b=m.auto_add_result.success?"æˆåŠŸ":"å¤±è´¥";Z.value+=`
[${m.siteName}] ${_} ${b}: ${m.auto_add_result.message}`}else m.success&&m.url&&(Z.value+=`
[${m.siteName}] âš ï¸  æœªæ‰§è¡Œè‡ªåŠ¨æ·»åŠ `)}),Z.value+=`
--- [è‡ªåŠ¨æ·»åŠ ä»»åŠ¡ç»“æŸ] ---`;const d=e.map(m=>{let v=`--- Log for ${m.siteName} ---
${m.logs||"No logs available."}`;if(u[m.siteName]){const _=u[m.siteName];v+=`

--- Downloader Status for ${m.siteName} ---`,_.success?v+=`
âœ… æˆåŠŸ: ${_.message}`:v+=`
âŒ å¤±è´¥: ${_.message}`}return v});Z.value=d.join(`

`),ee.value=e.map(m=>({...m,downloaderStatus:u[m.siteName]}));try{await V.post("/api/refresh_data"),f.success({title:"æ•°æ®åˆ·æ–°",message:"ç§å­æ•°æ®å·²åˆ·æ–°"})}catch(m){console.warn("åˆ·æ–°ç§å­æ•°æ®å¤±è´¥:",m)}L.value=!1},gt=async()=>{await _t()||await ft()},ht=()=>{E.value>0&&E.value--},as=()=>{E.value===3?ve("close-with-refresh"):ve("cancel")},ks=()=>{ve("complete")},Ss=s=>!s||s==="å‘å¸ƒæˆåŠŸ"?"å‘å¸ƒæˆåŠŸ":s.includes("ç§å­å·²å­˜åœ¨")?"ç§å­å·²å­˜åœ¨ï¼Œå‘å¸ƒæˆåŠŸ":s.split(`
`).filter(l=>l&&!l.includes("--- [æ­¥éª¤")&&!l.includes("INFO - ---")).map(l=>l.replace(/^\d{2}:\d{2}:\d{2} - \w+ - /,"")).filter(Boolean).pop()||"å‘å¸ƒæˆåŠŸ",Ue=(s,e)=>{const o=s.response?.data?.logs||s.message||e;f.error({title:"æ“ä½œå¤±è´¥",message:o,duration:0,showClose:!0})},J=s=>{const e=t.value.standardized_params;if(!e||!M.value)return"N/A";const o=e[s];if(!o)return"N/A";const l=M.value[s];return l&&l[o]||o},ls=()=>!he.value||!M.value.tags?[]:he.value.map(s=>M.value.tags[s]||s),Is=F(()=>t.value.title_components.filter(s=>s.key!=="æ— æ³•è¯†åˆ«")),he=F(()=>t.value.standardized_params.tags?.filter(e=>e&&typeof e=="string"&&e.trim()!=="")||[]),Oe=F(()=>{const s=new RegExp(/^[\p{L}\p{N}_-]+\.[\p{L}\p{N}_+-]+$/u);return he.value.filter(e=>!s.test(e))}),bt=F(()=>["ä¸»æ ‡é¢˜","å­£é›†","å¹´ä»½","å‰§é›†çŠ¶æ€","å‘å¸ƒç‰ˆæœ¬","åˆ†è¾¨ç‡","ç‰‡æºå¹³å°","åª’ä»‹","è§†é¢‘ç¼–ç ","è§†é¢‘æ ¼å¼","HDRæ ¼å¼","è‰²æ·±","å¸§ç‡","éŸ³é¢‘ç¼–ç ","åˆ¶ä½œç»„"].map(e=>({key:e,value:""}))),Fe=s=>s==="ç¦è½¬"||s==="tag.ç¦è½¬"||s==="é™è½¬"||s==="tag.é™è½¬"||s==="åˆ†é›†"||s==="tag.åˆ†é›†",$s=F(()=>(t.value.standardized_params.tags||[]).some(e=>Fe(e))),yt=s=>{if(Fe(s)){f.warning({title:"æ— æ³•åˆ é™¤",message:"ç¦è½¬/é™è½¬/åˆ†é›†æ ‡ç­¾ä¸å…è®¸åˆ é™¤",duration:2e3});return}const e=t.value.standardized_params.tags.indexOf(s);e>-1&&t.value.standardized_params.tags.splice(e,1)},os=F({get(){const s=t.value.title_components.find(e=>e.key==="æ— æ³•è¯†åˆ«");return s?s.value:""},set(s){const e=t.value.title_components.findIndex(o=>o.key==="æ— æ³•è¯†åˆ«");s===""||s===null?e!==-1&&t.value.title_components.splice(e,1):e!==-1?t.value.title_components[e].value=s:t.value.title_components.push({key:"æ— æ³•è¯†åˆ«",value:s})}}),wt=F(()=>{const s=t.value.standardized_params.team,e=t.value.title_components;if(s&&["cmct","cmctv","hdsky","hdsweb","hds","hdstv","hdspad"].includes(s.toLowerCase()))return!0;const o=e.find(l=>l.key==="åˆ¶ä½œç»„");if(o&&o.value){const l=o.value.toLowerCase(),n=["cmct","cmctv","telesto","shadow610","hdsky","hdsweb","hds","hdstv","hdspad"];for(const u of n)if(l.includes(u))return!0}return!1}),Cs=F(()=>{const s=t.value.title_components.find(pe=>pe.key==="æ— æ³•è¯†åˆ«"),e=s&&s.value!=="";if($s.value)return!0;const o=t.value.intro,l=!o.poster||o.poster.trim()==="",n=!o.screenshots||o.screenshots.trim()==="",u=!o.body||o.body.trim()==="";if(l||n||u||!Ds(o.body).isComplete)return!0;const m=t.value.standardized_params,v=!m.type||m.type.trim()==="",_=!m.medium||m.medium.trim()==="",b=!m.video_codec||m.video_codec.trim()==="",$=!m.audio_codec||m.audio_codec.trim()==="",j=!m.resolution||m.resolution.trim()==="";if(v||_||b||$||j)return!0;const B=t.value.title_components.find(pe=>pe.key==="åˆ¶ä½œç»„"),me=!B||!B.value||B.value.trim()==="",be=B&&B.value.trim().toUpperCase()==="NOGROUP";if(me||be)return!0;const ye=t.value.mediainfo||"";if(!ye||ye.trim()==="")return!0;{const pe=zs(ye),ds=Ts(ye);if(!pe&&!ds)return!0}if(ae.value.length>0)return!0;const rs=!oe.value;return!!(e||rs)}),kt=F(()=>{if($s.value)return"æ£€æµ‹åˆ°ç¦è½¬/é™è½¬/åˆ†é›†æ ‡ç­¾ï¼Œä¸å…è®¸ç»§ç»­å‘å¸ƒ";const s=t.value.title_components.find(_=>_.key==="æ— æ³•è¯†åˆ«");if(s&&s.value!=="")return"å­˜åœ¨æ— æ³•è¯†åˆ«çš„æ ‡é¢˜å†…å®¹ï¼Œè¯·æ‰‹åŠ¨ä¿®æ­£æˆ–åˆ é™¤";const e=t.value.title_components.find(_=>_.key==="åˆ¶ä½œç»„"),o=!e||!e.value||e.value.trim()==="",l=e&&e.value.trim().toUpperCase()==="NOGROUP";if(o)return"æ— åˆ¶ä½œç»„ï¼Œç¦æ­¢å‘å¸ƒ";if(l)return"åˆ¶ä½œç»„ä¸ºNOGROUPï¼Œç¦æ­¢å‘å¸ƒ";const n=t.value.standardized_params,u=t.value.intro,d=[];if((!u.poster||u.poster.trim()==="")&&d.push("æµ·æŠ¥"),(!u.screenshots||u.screenshots.trim()==="")&&d.push("æˆªå›¾"),(!u.body||u.body.trim()==="")&&d.push("ç®€ä»‹æ­£æ–‡"),(!t.value.mediainfo||t.value.mediainfo.trim()==="")&&d.push("Mediainfo"),(!n.type||n.type.trim()==="")&&d.push("ç±»å‹"),(!n.medium||n.medium.trim()==="")&&d.push("åª’ä»‹"),(!n.video_codec||n.video_codec.trim()==="")&&d.push("è§†é¢‘ç¼–ç "),(!n.audio_codec||n.audio_codec.trim()==="")&&d.push("éŸ³é¢‘ç¼–ç "),(!n.resolution||n.resolution.trim()==="")&&d.push("åˆ†è¾¨ç‡"),d.length>0)return`è¯·è¡¥å……å¿…å¡«é¡¹ï¼š${d.join("ã€")}`;const m=Ds(u.body);if(!m.isComplete)return`ç®€ä»‹æ­£æ–‡ç¼ºå°‘å¿…å¡«å­—æ®µï¼š${["ç‰‡å","äº§åœ°","ç®€ä»‹"].filter($=>m.missingFields.includes($)).join("ã€")}`;if(ae.value.length>0){const _={type:"ç±»å‹",medium:"åª’ä»‹",video_codec:"è§†é¢‘ç¼–ç ",audio_codec:"éŸ³é¢‘ç¼–ç ",resolution:"åˆ†è¾¨ç‡",team:"åˆ¶ä½œç»„",source:"äº§åœ°",tags:"æ ‡ç­¾"};return`å‚æ•°æ ¼å¼ä¸æ­£ç¡® (${ae.value.map($=>_[$]||$).join("ã€")})`}const v=t.value.mediainfo||"";return!zs(v)&&!Ts(v)?"MediaInfo æˆ– BDInfo æ ¼å¼æ— æ•ˆ":oe.value?"å‡†å¤‡å°±ç»ª":"æˆªå›¾é“¾æ¥å¤±æ•ˆï¼Œè¯·ç­‰å¾…é‡æ–°è·å–æˆ–æ‰‹åŠ¨ä¿®å¤"}),Es=s=>{const e=[{pattern:/\[b\]/,description:"BBCodeç²—ä½“æ ‡ç­¾"},{pattern:/\[color=[^\]]+\]/,description:"BBCodeé¢œè‰²æ ‡ç­¾"},{pattern:/\[size=[^\]]+\]/,description:"BBCodeå¤§å°æ ‡ç­¾"},{pattern:/\[\/[^\]]+\]/,description:"BBCodeç»“æŸæ ‡ç­¾"},{pattern:/â˜…{2,}/,description:"è¿ç»­çš„æ˜Ÿæ˜Ÿç¬¦å·"},{pattern:/ã€‚{3,}/,description:"è¿ç»­çš„ä¸­æ–‡å¥å·"},{pattern:/â€¦{2,}/,description:"è¿ç»­çš„çœç•¥å·"},{pattern:/â€¦â€¦{2,}/,description:"è¿ç»­çš„ä¸­æ–‡çœç•¥å·"}];for(const{pattern:o,description:l}of e)if(o.test(s))return console.log(`æ£€æµ‹åˆ°ç¦æ­¢æ¨¡å¼: ${l}`),!0;return!1},zs=s=>!(["General","Video","Audio","Complete name","File size","Duration","Width","Height"].filter(l=>s.includes(l)).length<3||Es(s)),Ts=s=>{const e=["DISC INFO","PLAYLIST REPORT"],o=["VIDEO:","AUDIO:","SUBTITLES:","FILES:","Disc Label","Disc Size","BDInfo:","Protection:","Codec","Bitrate","Language","Description"],l=e.filter(d=>s.includes(d)).length,n=o.filter(d=>s.includes(d)).length;return!(!(l===e.length||l>=1&&n>=2)||Es(s))},Ds=s=>{if(!s||s.trim()==="")return{isComplete:!1,missingFields:["æ‰€æœ‰å­—æ®µ"],foundFields:[]};const e={ç‰‡å:[/[â—â]\s*ç‰‡\s*å/i,/[â—â]\s*è¯‘\s*å/i,/[â—â]\s*æ ‡\s*é¢˜/i,/ç‰‡å\s*[:ï¼š]/i,/è¯‘å\s*[:ï¼š]/i,/Title\s*[:ï¼š]/i],äº§åœ°:[/[â—â]\s*äº§\s*åœ°/i,/[â—â]\s*å›½\s*å®¶/i,/[â—â]\s*åœ°\s*åŒº/i,/åˆ¶ç‰‡å›½å®¶\/åœ°åŒº\s*[:ï¼š]/i,/åˆ¶ç‰‡å›½å®¶\s*[:ï¼š]/i,/å›½å®¶\s*[:ï¼š]/i,/äº§åœ°\s*[:ï¼š]/i,/Country\s*[:ï¼š]/i],ç®€ä»‹:[/[â—â]\s*ç®€\s*ä»‹/i,/[â—â]\s*å‰§\s*æƒ…/i,/[â—â]\s*å†…\s*å®¹/i,/ç®€ä»‹\s*[:ï¼š]/i,/å‰§æƒ…\s*[:ï¼š]/i,/å†…å®¹ç®€ä»‹\s*[:ï¼š]/i,/Plot\s*[:ï¼š]/i,/Synopsis\s*[:ï¼š]/i]},o=[],l=[];for(const[d,m]of Object.entries(e)){let v=!1;for(const _ of m)if(_.test(s)){v=!0;break}v?o.push(d):l.push(d)}return{isComplete:["ç‰‡å","äº§åœ°","ç®€ä»‹"].every(d=>o.includes(d)),missingFields:l,foundFields:o}},ns=async()=>{const s=Ee.value;if(s.length===0){oe.value=!0;return}let e=!0;for(const o of s)try{await new Promise((l,n)=>{const u=new Image;u.onload=()=>{l(!0)},u.onerror=()=>{n(new Error("Image load failed"))},u.src=o})}catch{e=!1;break}oe.value=e},Ns=()=>{Re.value=!1},St=(s,e)=>{let o=`--- Log for ${s} ---
${e||"No logs available."}`;const l=ee.value.find(n=>n.siteName===s);if(l&&l.downloaderStatus){const n=l.downloaderStatus;o+=`

--- Downloader Status for ${s} ---`,n.success?o+=`
âœ… æˆåŠŸ: ${n.message}`:o+=`
âŒ å¤±è´¥: ${n.message}`}Z.value=o,Re.value=!0},It=F(()=>{const s=new Map;for(const n of ee.value)n?.siteName&&s.set(n.siteName,n);const e=ee.value.length<O.value.length,o=ue.value.visible&&e,l=new Set(fe.value);return O.value.map(n=>{const u=s.get(n);if(u){let m=u.success?"success":"error";return u.success&&u.downloaderStatus?.success===!1&&(m="warning"),{...u,displayStatus:m}}let d="waiting";return l.has(n)?d="publishing":o&&(d="paused"),{siteName:n,displayStatus:d,success:!1,url:null,logs:"",message:d==="publishing"?"å‘å¸ƒä¸­...":d==="paused"?"å·²æš‚åœ":"ç­‰å¾…ä¸­"}})}),$t=F(()=>{const s=It.value,e=[];for(let o=0;o<s.length;o+=5)e.push(s.slice(o,o+5));return e}),Ct=s=>s.some(e=>e.success&&e.url),Et=s=>s.filter(e=>e.success&&e.url).length,zt=s=>{const e=s.filter(o=>o.success&&o.url);if(e.length===0){f.warning({title:"æ— æ³•æ‰“å¼€",message:"è¯¥è¡Œæ²¡æœ‰å¯ç”¨çš„ç§å­é“¾æ¥"});return}e.forEach(o=>{const l=Vs(o.url);window.open(l,"_blank","noopener,noreferrer")}),f.success({title:"æ‰¹é‡æ‰“å¼€æˆåŠŸ",message:`å·²æ‰“å¼€ ${e.length} ä¸ªç§å­é¡µé¢`})},Tt=()=>{console.log("æ—¥å¿—è¿›åº¦å¤„ç†å®Œæˆ"),setTimeout(()=>{Pe.value=!1},1e3)},Vs=s=>{if(!s)return s;try{const e=l=>{l.hostname==="rousi.pro"&&l.pathname.startsWith("/api/v1/torrents/")&&(l.pathname=l.pathname.replace("/api/v1/torrents/","/torrent/"))};if(s.includes("|DIRECT_DOWNLOAD:")){const l=s.split("|DIRECT_DOWNLOAD:")[0],n=new URL(l);return e(n),n.searchParams.delete("uploaded"),n.toString()}const o=new URL(s);return e(o),o.searchParams.delete("uploaded"),o.toString()}catch(e){return console.warn("Invalid URL format:",s,e),s}};return(s,e)=>{const o=x("el-icon"),l=x("el-button"),n=x("el-input"),u=x("el-form-item"),d=x("el-option"),m=x("el-select"),v=x("el-tag"),_=x("el-form"),b=x("el-tab-pane"),$=x("el-carousel-item"),j=x("el-carousel"),B=x("el-col"),me=x("el-row"),be=x("el-card"),ye=x("el-empty"),xs=x("el-tabs"),is=x("el-alert"),rs=x("el-button-group"),pe=x("el-switch"),ds=x("el-scrollbar"),Dt=x("el-dialog");return p(),g(A,null,[a("div",Wt,[a("header",Kt,[a("div",Jt,[(p(),g(A,null,U(We,(i,h)=>a("div",{key:h,class:N(["custom-step",{active:h===E.value,completed:h<E.value,last:h===We.length-1}])},[a("div",Yt,[h<E.value?(p(),T(o,{key:0},{default:c(()=>[r(C(cs))]),_:1})):(p(),g("span",Xt,y(h+1),1))]),a("div",Zt,y(i.title),1),h<We.length-1?(p(),g("div",Qt)):w("",!0)],2)),64))])]),a("main",ea,[E.value===0?(p(),g("div",sa,[r(xs,{modelValue:X.value,"onUpdate:modelValue":e[19]||(e[19]=i=>X.value=i),type:"border-card",class:"details-tabs"},{default:c(()=>[r(b,{label:"ä¸»è¦ä¿¡æ¯",name:"main"},{default:c(()=>[a("div",ta,[a("div",aa,[r(_,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[a("div",la,[r(u,{label:"åŸå§‹/å¾…è§£ææ ‡é¢˜"},{default:c(()=>[r(n,{modelValue:t.value.original_main_title,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value.original_main_title=i)},{append:c(()=>[r(l,{icon:C(we),onClick:st,loading:Je.value},{default:c(()=>[...e[24]||(e[24]=[z(" é‡æ–°è§£æ ",-1)])]),_:1},8,["icon","loading"])]),_:1},8,["modelValue"])]),_:1}),a("div",oa,[Is.value.length>0?(p(!0),g(A,{key:0},U(Is.value,i=>(p(),T(u,{key:i.key,label:i.key,class:N({"unrecognized-section":i.key==="åˆ¶ä½œç»„"&&(!i.value||i.value.toUpperCase()==="NOGROUP")})},{default:c(()=>[r(n,{modelValue:i.value,"onUpdate:modelValue":h=>i.value=h,onInput:h=>bs(i,h)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["label","class"]))),128)):(p(!0),g(A,{key:1},U(bt.value,(i,h)=>(p(),T(u,{key:"init-"+h,label:i.key,class:N({"unrecognized-section":i.key==="åˆ¶ä½œç»„"&&(!i.value||i.value.toUpperCase()==="NOGROUP")})},{default:c(()=>[r(n,{modelValue:i.value,"onUpdate:modelValue":I=>i.value=I,onInput:I=>bs(i,I)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["label","class"]))),128))])]),a("div",na,[a("div",ia,[a("div",ra,[r(u,{label:"å‰¯æ ‡é¢˜"},{default:c(()=>[r(n,{modelValue:t.value.subtitle,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.subtitle=i)},null,8,["modelValue"])]),_:1})]),a("div",{class:N({"unrecognized-section":os.value}),style:{"grid-column":"span 1"}},[r(u,{label:"æ— æ³•è¯†åˆ«"},{default:c(()=>[r(n,{modelValue:os.value,"onUpdate:modelValue":e[2]||(e[2]=i=>os.value=i)},null,8,["modelValue"])]),_:1})],2)]),a("div",da,[a("div",ua,[r(u,{label:"ç±»å‹ (type)"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.type,"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.standardized_params.type=i),placeholder:"è¯·é€‰æ‹©ç±»å‹",clearable:"",class:N({"is-invalid":ae.value.includes("type"),"is-empty":!t.value.standardized_params.type}),"data-tag-style":""},{default:c(()=>[(p(!0),g(A,null,U(M.value.type,(i,h)=>(p(),T(d,{key:h,label:i,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),r(u,{label:"åª’ä»‹ (medium)"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.medium,"onUpdate:modelValue":e[4]||(e[4]=i=>t.value.standardized_params.medium=i),placeholder:"è¯·é€‰æ‹©åª’ä»‹",clearable:"",class:N({"is-invalid":ae.value.includes("medium"),"is-empty":!t.value.standardized_params.medium}),"data-tag-style":""},{default:c(()=>[(p(!0),g(A,null,U(M.value.medium,(i,h)=>(p(),T(d,{key:h,label:i,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),r(u,{label:"è§†é¢‘ç¼–ç  (video_codec)"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.video_codec,"onUpdate:modelValue":e[5]||(e[5]=i=>t.value.standardized_params.video_codec=i),placeholder:"è¯·é€‰æ‹©è§†é¢‘ç¼–ç ",clearable:"",class:N({"is-invalid":ae.value.includes("video_codec"),"is-empty":!t.value.standardized_params.video_codec}),"data-tag-style":""},{default:c(()=>[(p(!0),g(A,null,U(M.value.video_codec,(i,h)=>(p(),T(d,{key:h,label:i,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),r(u,{label:"éŸ³é¢‘ç¼–ç  (audio_codec)"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.audio_codec,"onUpdate:modelValue":e[6]||(e[6]=i=>t.value.standardized_params.audio_codec=i),placeholder:"è¯·é€‰æ‹©éŸ³é¢‘ç¼–ç ",clearable:"",class:N({"is-invalid":ae.value.includes("audio_codec"),"is-empty":!t.value.standardized_params.audio_codec}),"data-tag-style":""},{default:c(()=>[(p(!0),g(A,null,U(M.value.audio_codec,(i,h)=>(p(),T(d,{key:h,label:i,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),r(u,{label:"åˆ†è¾¨ç‡ (resolution)"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.resolution,"onUpdate:modelValue":e[7]||(e[7]=i=>t.value.standardized_params.resolution=i),placeholder:"è¯·é€‰æ‹©åˆ†è¾¨ç‡",clearable:"",class:N({"is-invalid":ae.value.includes("resolution"),"is-empty":!t.value.standardized_params.resolution}),"data-tag-style":""},{default:c(()=>[(p(!0),g(A,null,U(M.value.resolution,(i,h)=>(p(),T(d,{key:h,label:i,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1})]),a("div",ca,[r(u,{label:"åˆ¶ä½œç»„ (team)"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.team,"onUpdate:modelValue":e[8]||(e[8]=i=>t.value.standardized_params.team=i),placeholder:"è¯·é€‰æ‹©åˆ¶ä½œç»„",clearable:"",filterable:"","allow-create":"","default-first-option":"",class:N(["team-select",{"is-invalid":ae.value.includes("team")}])},{default:c(()=>[(p(!0),g(A,null,U(M.value.team,(i,h)=>(p(),T(d,{key:h,label:i,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),r(u,{label:"äº§åœ° (source)"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.source,"onUpdate:modelValue":e[9]||(e[9]=i=>t.value.standardized_params.source=i),placeholder:"è¯·é€‰æ‹©äº§åœ°",clearable:"",class:N({"is-invalid":ae.value.includes("source")}),"data-tag-style":""},{default:c(()=>[(p(!0),g(A,null,U(M.value.source,(i,h)=>(p(),T(d,{key:h,label:i,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1}),r(u,{label:"æ ‡ç­¾ (tags)",class:"tags-wide-item"},{default:c(()=>[r(m,{modelValue:t.value.standardized_params.tags,"onUpdate:modelValue":e[10]||(e[10]=i=>t.value.standardized_params.tags=i),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"è¯·é€‰æ‹©æˆ–è¾“å…¥æ ‡ç­¾",style:{width:"100%"}},{tag:c(({data:i})=>[(p(!0),g(A,null,U(i,h=>(p(),T(v,{key:h.value,type:dt(h.value),closable:!Fe(h.value),"disable-transitions":"",onClose:I=>yt(h.value),style:{margin:"2px"}},{default:c(()=>[a("span",null,y(M.value.tags[h.value]||h.currentLabel),1)]),_:2},1032,["type","closable","onClose"]))),128))]),default:c(()=>[(p(!0),g(A,null,U(rt.value,i=>(p(),T(d,{key:i.value,label:i.label,value:i.value},{default:c(()=>[a("span",{style:Bt({color:Oe.value.includes(i.value)?"#F56C6C":""})},y(i.label),5)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e[25]||(e[25]=a("div",{class:"placeholder-item"},null,-1)),e[26]||(e[26]=a("div",{class:"placeholder-item"},null,-1))])])])]),_:1})])])]),_:1}),r(b,{label:"æµ·æŠ¥ä¸å£°æ˜",name:"poster-statement"},{default:c(()=>[a("div",ma,[r(_,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[a("div",pa,[a("div",va,[r(u,{label:"å£°æ˜",class:"statement-item"},{default:c(()=>[r(n,{type:"textarea",modelValue:t.value.intro.statement,"onUpdate:modelValue":e[11]||(e[11]=i=>t.value.intro.statement=i),rows:18},null,8,["modelValue"])]),_:1}),r(u,null,{label:c(()=>[a("div",_a,[e[28]||(e[28]=a("span",null,"æµ·æŠ¥é“¾æ¥",-1)),r(l,{icon:C(we),onClick:et,loading:Ae.value,size:"small",type:"text"},{default:c(()=>[...e[27]||(e[27]=[z(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[r(n,{type:"textarea",modelValue:t.value.intro.poster,"onUpdate:modelValue":e[12]||(e[12]=i=>t.value.intro.poster=i),rows:2},null,8,["modelValue"])]),_:1})]),a("div",fa,[a("div",ga,[e[29]||(e[29]=a("div",{class:"preview-header"},"æµ·æŠ¥é¢„è§ˆ",-1)),a("div",ha,[Le.value.length?(p(!0),g(A,{key:0},U(Le.value,(i,h)=>(p(),g("img",{key:"poster-"+h,src:G(i),alt:"æµ·æŠ¥é¢„è§ˆ",class:"preview-image",onError:I=>se(i,"poster",h)},null,40,ba))),128)):(p(),g("div",ya,"æš‚æ— æµ·æŠ¥é¢„è§ˆ"))])])])])]),_:1})])]),_:1}),r(b,{label:"è§†é¢‘æˆªå›¾",name:"images"},{default:c(()=>[a("div",wa,[a("div",ka,[r(_,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[r(u,{class:"is-flexible"},{label:c(()=>[a("div",Sa,[e[31]||(e[31]=a("span",null,"æˆªå›¾",-1)),r(l,{icon:C(we),onClick:Ys,loading:xe.value,size:"small",type:"text"},{default:c(()=>[...e[30]||(e[30]=[z(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[r(n,{type:"textarea",modelValue:t.value.intro.screenshots,"onUpdate:modelValue":e[13]||(e[13]=i=>t.value.intro.screenshots=i),rows:20},null,8,["modelValue"])]),_:1})]),_:1})]),a("div",Ia,[a("div",$a,[Ee.value.length?(p(),T(j,{key:0,interval:5e3,height:"500px","indicator-position":"outside"},{default:c(()=>[(p(!0),g(A,null,U(Ee.value,(i,h)=>(p(),T($,{key:"ss-"+h},{default:c(()=>[a("div",Ca,[a("img",{src:G(i),alt:"æˆªå›¾é¢„è§ˆ",class:"carousel-image",onError:I=>se(i,"screenshot",h)},null,40,Ea)])]),_:2},1024))),128))]),_:1})):(p(),g("div",za,"æˆªå›¾é¢„è§ˆ"))])])])]),_:1}),r(b,{label:"ç®€ä»‹è¯¦æƒ…",name:"intro"},{default:c(()=>[r(_,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[r(u,{class:"is-flexible"},{label:c(()=>[a("div",Ta,[e[33]||(e[33]=a("span",null,"æ­£æ–‡",-1)),r(l,{icon:C(we),onClick:Js,loading:Ye.value,size:"small",type:"text"},{default:c(()=>[...e[32]||(e[32]=[z(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[r(n,{type:"textarea",modelValue:t.value.intro.body,"onUpdate:modelValue":e[14]||(e[14]=i=>t.value.intro.body=i),rows:21},null,8,["modelValue"])]),_:1}),r(me,{gutter:20},{default:c(()=>[r(B,{span:8},{default:c(()=>[r(u,{label:"è±†ç“£é“¾æ¥"},{default:c(()=>[r(n,{modelValue:t.value.douban_link,"onUpdate:modelValue":e[15]||(e[15]=i=>t.value.douban_link=i),placeholder:"è¯·è¾“å…¥è±†ç“£ç”µå½±é“¾æ¥"},null,8,["modelValue"])]),_:1})]),_:1}),r(B,{span:8},{default:c(()=>[r(u,{label:"IMDbé“¾æ¥"},{default:c(()=>[r(n,{modelValue:t.value.imdb_link,"onUpdate:modelValue":e[16]||(e[16]=i=>t.value.imdb_link=i),placeholder:"è¯·è¾“å…¥IMDbç”µå½±é“¾æ¥"},null,8,["modelValue"])]),_:1})]),_:1}),r(B,{span:8},{default:c(()=>[r(u,{label:"TMDbé“¾æ¥"},{default:c(()=>[r(n,{modelValue:t.value.tmdb_link,"onUpdate:modelValue":e[17]||(e[17]=i=>t.value.tmdb_link=i),placeholder:"è¯·è¾“å…¥TMDbç”µå½±é“¾æ¥"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(b,{label:"åª’ä½“ä¿¡æ¯",name:"mediainfo"},{default:c(()=>[r(_,{"label-position":"top",class:"fill-height-form"},{default:c(()=>[r(u,{class:"is-flexible"},{label:c(()=>[a("div",Da,[e[35]||(e[35]=a("span",null,"Mediainfo",-1)),r(l,{icon:C(we),onClick:Xs,loading:Be.value,size:"small",type:"text"},{default:c(()=>[...e[34]||(e[34]=[z(" é‡æ–°è·å– ",-1)])]),_:1},8,["icon","loading"])])]),default:c(()=>[a("div",Na,[W.value.visible?(p(),g("div",Va,[r(be,{class:"bdinfo-progress-card-inline",shadow:"never"},{header:c(()=>[a("div",xa,[e[39]||(e[39]=a("span",null,"BDInfo è·å–ä¸­...",-1)),a("div",Ba,[e[38]||(e[38]=a("span",{class:"background-hint"},"å¯åœ¨åå°ç»§ç»­è·å–",-1)),r(l,{icon:C(xt),onClick:Qs,size:"small",text:"",type:"primary"},{default:c(()=>[...e[36]||(e[36]=[z(" æ”¾ç½®åå° ",-1)])]),_:1},8,["icon"]),r(l,{icon:C(As),onClick:ze,size:"small",text:"",type:"info"},{default:c(()=>[...e[37]||(e[37]=[z(" å–æ¶ˆè·å– ",-1)])]),_:1},8,["icon"])])])]),default:c(()=>[r(C(us),{percentage:W.value.percent,status:W.value.percent===100?"success":""},null,8,["percentage","status"]),a("div",Aa,[a("div",Ra,[a("div",Pa,"åŸç›˜ä½“ç§¯: "+y(Gs(ps.value)),1),a("div",La,"å·²ç”¨æ—¶: "+y(W.value.elapsedTime),1),a("div",Ma," å‰©ä½™æ—¶é—´: "+y(W.value.remainingTime),1)])])]),_:1})])):w("",!0),r(n,{type:"textarea",class:"code-font",modelValue:t.value.mediainfo,"onUpdate:modelValue":e[18]||(e[18]=i=>t.value.mediainfo=i),rows:W.value.visible?18:26},null,8,["modelValue","rows"])])]),_:1})]),_:1})]),_:1}),r(b,{label:"å·²è¿‡æ»¤å£°æ˜",name:"filtered-declarations",class:"filtered-declarations-pane"},{default:c(()=>[a("div",Ua,[a("div",Oa,[e[40]||(e[40]=a("h3",null,"å·²è‡ªåŠ¨è¿‡æ»¤çš„å£°æ˜å†…å®¹",-1)),r(v,{type:"warning",size:"small"},{default:c(()=>[z("å…± "+y(fs.value)+" æ¡",1)]),_:1})]),a("div",Fa,[fs.value>0?(p(!0),g(A,{key:0},U(_s.value,(i,h)=>(p(),g("div",{key:h,class:"declaration-item"},[a("div",ja,[a("span",qa,"#"+y(h+1),1),r(v,{type:"danger",size:"small"},{default:c(()=>[...e[41]||(e[41]=[z("å·²è¿‡æ»¤",-1)])]),_:1})]),a("pre",Ha,y(i),1)]))),128)):(p(),g("div",Ga,[r(ye,{description:"æœªæ£€æµ‹åˆ°éœ€è¦è¿‡æ»¤çš„ ARDTU å£°æ˜å†…å®¹"})]))])])]),_:1})]),_:1},8,["modelValue"])])):w("",!0),E.value===1?(p(),g("div",Wa,[a("div",Ka,[a("div",Ja,[e[42]||(e[42]=a("div",{class:"row-label"},"ä¸»æ ‡é¢˜ï¼š",-1)),a("div",Ya,y(t.value.final_publish_parameters?.["ä¸»æ ‡é¢˜ (é¢„è§ˆ)"]||t.value.original_main_title||"æš‚æ— æ•°æ®"),1)]),a("div",Xa,[e[43]||(e[43]=a("div",{class:"row-label"},"å‰¯æ ‡é¢˜ï¼š",-1)),a("div",Za,y(t.value.subtitle||"æš‚æ— æ•°æ®"),1)]),a("div",Qa,[e[57]||(e[57]=a("div",{class:"row-label"},"å‚æ•°ä¿¡æ¯ï¼š",-1)),a("div",el,[a("div",sl,[a("div",tl,[a("div",al,[e[44]||(e[44]=a("span",{style:{"letter-spacing":"2.6px"},class:"param-label"},"è±†ç“£é“¾æ¥",-1)),e[45]||(e[45]=a("span",{style:{"font-size":"13px"}},"ï¼š",-1)),a("span",{class:N(["param-value",{empty:!t.value.douban_link||t.value.douban_link==="N/A"}])},y(t.value.douban_link||"N/A"),3)]),a("div",ll,[e[46]||(e[46]=a("span",{class:"param-label"},"IMDbé“¾æ¥ï¼š",-1)),a("span",{class:N(["param-value",{empty:!t.value.imdb_link||t.value.imdb_link==="N/A"}])},y(t.value.imdb_link||"N/A"),3)]),a("div",ol,[e[47]||(e[47]=a("span",{style:{"letter-spacing":"0"},class:"param-label"},"TMDbé“¾æ¥",-1)),e[48]||(e[48]=a("span",{style:{"font-size":"13px"}},"ï¼š",-1)),a("span",{class:N(["param-value",{empty:!t.value.tmdb_link||t.value.tmdb_link==="N/A"}])},y(t.value.tmdb_link||"N/A"),3)])]),a("div",nl,[e[49]||(e[49]=a("span",{class:"param-label"},"æ ‡ç­¾ï¼š",-1)),a("div",il,[a("span",{class:N(["param-value",{empty:!ls()||ls().length===0}])},y(ls().join(", ")||"N/A"),3),he.value&&he.value.length>0?(p(),g("span",rl,y(he.value.join(", ")),1)):w("",!0)])])]),a("div",dl,[a("div",ul,[e[50]||(e[50]=a("span",{class:"param-label"},"ç±»å‹ï¼š",-1)),a("div",cl,[a("span",{class:N(["param-value",{empty:!J("type")}])},y(J("type")||"N/A"),3),t.value.standardized_params.type?(p(),g("span",ml,y(t.value.standardized_params.type),1)):w("",!0)])]),a("div",pl,[e[51]||(e[51]=a("span",{class:"param-label"},"åª’ä»‹ï¼š",-1)),a("div",vl,[a("span",{class:N(["param-value",{empty:!J("medium")}])},y(J("medium")||"N/A"),3),t.value.standardized_params.medium?(p(),g("span",_l,y(t.value.standardized_params.medium),1)):w("",!0)])]),a("div",fl,[e[52]||(e[52]=a("span",{class:"param-label"},"è§†é¢‘ç¼–ç ï¼š",-1)),a("div",gl,[a("span",{class:N(["param-value",{empty:!J("video_codec")}])},y(J("video_codec")||"N/A"),3),t.value.standardized_params.video_codec?(p(),g("span",hl,y(t.value.standardized_params.video_codec),1)):w("",!0)])]),a("div",bl,[e[53]||(e[53]=a("span",{class:"param-label"},"éŸ³é¢‘ç¼–ç ï¼š",-1)),a("div",yl,[a("span",{class:N(["param-value",{empty:!J("audio_codec")}])},y(J("audio_codec")||"N/A"),3),t.value.standardized_params.audio_codec?(p(),g("span",wl,y(t.value.standardized_params.audio_codec),1)):w("",!0)])]),a("div",kl,[e[54]||(e[54]=a("span",{class:"param-label"},"åˆ†è¾¨ç‡ï¼š",-1)),a("div",Sl,[a("span",{class:N(["param-value",{empty:!J("resolution")}])},y(J("resolution")||"N/A"),3),t.value.standardized_params.resolution?(p(),g("span",Il,y(t.value.standardized_params.resolution),1)):w("",!0)])]),a("div",$l,[e[55]||(e[55]=a("span",{class:"param-label"},"åˆ¶ä½œç»„ï¼š",-1)),a("div",Cl,[a("span",{class:N(["param-value",{empty:!J("team")}])},y(J("team")||"N/A"),3),t.value.standardized_params.team?(p(),g("span",El,y(t.value.standardized_params.team),1)):w("",!0)])]),a("div",zl,[e[56]||(e[56]=a("span",{class:"param-label"},"äº§åœ°/æ¥æºï¼š",-1)),a("div",Tl,[a("span",{class:N(["param-value",{empty:!J("source")}])},y(J("source")||"N/A"),3),t.value.standardized_params.source?(p(),g("span",Dl,y(t.value.standardized_params.source),1)):w("",!0)])])])])]),a("div",Nl,[e[58]||(e[58]=a("div",{class:"row-label"},"Mediainfoï¼š",-1)),a("div",Vl,[a("pre",xl,y(t.value.mediainfo||"æš‚æ— æ•°æ®"),1)])]),a("div",Bl,[e[60]||(e[60]=a("div",{class:"row-label"},"ç®€ä»‹å†…å®¹ï¼š",-1)),a("div",Al,[a("div",Rl,[a("div",{class:"section-content",innerHTML:ke(t.value.intro?.statement)||"æš‚æ— å£°æ˜"},null,8,Pl)]),Le.value.length>0?(p(),g("div",Ll,[a("div",Ml,[(p(!0),g(A,null,U(Le.value,(i,h)=>(p(),g("img",{key:"poster-preview-"+h,src:G(i),alt:"æµ·æŠ¥ "+(h+1),class:"preview-image-inline",style:{width:"300px"},onError:I=>se(i,"poster",h)},null,40,Ul))),128))])])):w("",!0),a("div",Ol,[e[59]||(e[59]=a("br",null,null,-1)),a("div",{class:"section-content",innerHTML:ke(t.value.intro?.body)||"æš‚æ— æ­£æ–‡"},null,8,Fl)]),Ee.value.length>0?(p(),g("div",jl,[a("div",ql,[(p(!0),g(A,null,U(Ee.value,(i,h)=>(p(),g("img",{key:"screenshot-preview-"+h,src:G(i),alt:"æˆªå›¾ "+(h+1),class:"preview-image-inline",onError:I=>se(i,"screenshot",h)},null,40,Hl))),128))])])):w("",!0)])])])])):w("",!0),E.value===2?(p(),g("div",Gl,[e[66]||(e[66]=a("h3",{class:"selection-title"},"è¯·é€‰æ‹©è¦å‘å¸ƒçš„ç›®æ ‡ç«™ç‚¹",-1)),e[67]||(e[67]=a("p",{class:"selection-subtitle"},"å·²å­˜åœ¨çš„ç«™ç‚¹å·²è¢«è‡ªåŠ¨ç¦ç”¨ã€‚çº¢è‰²ç«™ç‚¹è¡¨ç¤ºé…ç½®ä¸å®Œæ•´ã€‚",-1)),wt.value?(p(),T(is,{key:0,type:"error",closable:!1,style:{width:"410px",margin:"0 auto"}},{title:c(()=>[...e[61]||(e[61]=[a("span",{style:{"font-weight":"600"}},"ç¦æ­¢è½¬è½½",-1)])]),default:c(()=>[e[62]||(e[62]=a("div",null,[z(" æ£€æµ‹åˆ°åˆ¶ä½œç»„åŒ…å«ç¦æ­¢è½¬è½½çš„å†…å®¹ï¼Œå·²è‡ªåŠ¨ç¦ç”¨ UBits ç«™ç‚¹ã€‚"),a("br"),z(" ç¦æ­¢è½¬è½½çš„åˆ¶ä½œç»„ï¼šCMCTã€CMCTVã€HDSkyã€HDSWEBã€HDSã€HDSTVã€HDSPad ")],-1))]),_:1})):w("",!0),a("div",Wl,[a("div",Kl,[a("div",Jl,[r(rs,null,{default:c(()=>[r(l,{type:"primary",onClick:mt},{default:c(()=>[...e[63]||(e[63]=[z("å…¨é€‰",-1)])]),_:1}),r(l,{type:"info",onClick:pt},{default:c(()=>[...e[64]||(e[64]=[z("æ¸…ç©º",-1)])]),_:1})]),_:1})]),a("div",Yl,[e[65]||(e[65]=a("span",{style:{"font-weight":"500",color:"var(--el-text-color-regular)","font-size":"13px"}}," ç›®æ ‡ç«™ç‚¹å·²å­˜åœ¨æ—¶æ˜¯å¦æ·»åŠ åˆ°ä¸‹è½½å™¨ ",-1)),r(pe,{modelValue:_e.value,"onUpdate:modelValue":e[20]||(e[20]=i=>_e.value=i),onChange:ot},null,8,["modelValue"])])])]),a("div",Xl,[(p(!0),g(A,null,U(ce.value.filter(i=>i.is_target),i=>(p(),T(l,{key:i.name,class:"site-button",type:Ks(i),plain:!i.has_cookie&&i.name!=="è‚‰ä¸",disabled:!ss(i.name),onClick:h=>ct(i.name)},{default:c(()=>[z(y(i.name)+" ",1),i.name==="ubits"&&!ss(i.name)?(p(),T(C(Rs),{key:0,content:"è¯¥åˆ¶ä½œç»„ç¦æ­¢è½¬è½½åˆ° uBits ç«™ç‚¹",placement:"top"},{default:c(()=>[r(o,{style:{"margin-left":"4px",color:"#f56c6c"}},{default:c(()=>[r(C(Ps))]),_:1})]),_:1})):es(i)&&!Qe.value?(p(),T(C(Rs),{key:1,content:"ilolicon ä»…æ”¯æŒåŠ¨æ¼«/åŠ¨ç”»å†…å®¹ï¼Œå½“å‰ç§å­å·²è‡ªåŠ¨ç¦ç”¨",placement:"top"},{default:c(()=>[r(o,{style:{"margin-left":"4px",color:"#f56c6c"}},{default:c(()=>[r(C(Ps))]),_:1})]),_:1})):w("",!0)]),_:2},1032,["type","plain","disabled","onClick"]))),128))])])):w("",!0),E.value===3?(p(),g("div",Zl,[E.value===3?(p(),g("div",Ql,[ie.value.total>0?(p(),g("div",eo,[e[68]||(e[68]=a("div",{class:"progress-label"},"å‘å¸ƒè¿›åº¦:",-1)),r(C(us),{percentage:Math.round(ie.value.current/ie.value.total*100),"show-text":!0,"stroke-width":8},null,8,["percentage"]),a("div",so,y(ie.value.current)+" / "+y(ie.value.total),1)])):w("",!0),re.value.total>0?(p(),g("div",to,[e[69]||(e[69]=a("div",{class:"progress-label"},"ä¸‹è½½å™¨æ·»åŠ è¿›åº¦:",-1)),r(C(us),{percentage:Math.round(re.value.current/re.value.total*100),"show-text":!0,"stroke-width":8},null,8,["percentage"]),a("div",ao,y(re.value.current)+" / "+y(re.value.total),1)])):w("",!0),ue.value.visible?(p(),g("div",lo,[a("div",oo,[a("div",no,[a("div",io,y(ue.value.title),1),a("div",ro,y(ue.value.message),1)])])])):w("",!0)])):w("",!0),a("div",uo,[(p(!0),g(A,null,U($t.value,(i,h)=>(p(),g("div",{key:h,class:"results-row"},[a("div",co,[(p(!0),g(A,null,U(i,I=>(p(),g("div",{key:I.siteName,class:N(["result-card",{"is-success":I.displayStatus==="success","is-warning":I.displayStatus==="warning","is-error":I.displayStatus==="error","is-waiting":I.displayStatus==="waiting","is-publishing":I.displayStatus==="publishing","is-paused":I.displayStatus==="paused"}])},[a("div",mo,[I.displayStatus==="success"?(p(),T(o,{key:0,color:"#67C23A",size:32},{default:c(()=>[r(C(cs))]),_:1})):I.displayStatus==="warning"?(p(),T(o,{key:1,color:"#E6A23C",size:32},{default:c(()=>[r(C(De))]),_:1})):I.displayStatus==="error"?(p(),T(o,{key:2,color:"#F56C6C",size:32},{default:c(()=>[r(C(Ls))]),_:1})):I.displayStatus==="publishing"?(p(),T(o,{key:3,color:"#409EFF",size:32,class:"loading-icon"},{default:c(()=>[r(C(Fs))]),_:1})):(p(),T(o,{key:4,color:I.displayStatus==="paused"?"#E6A23C":"#FFB6C1",size:32},{default:c(()=>[r(C(At))]),_:1},8,["color"]))]),a("h4",po,y(I.siteName),1),I.isExisted?(p(),g("div",vo,[r(v,{type:"warning",size:"small"},{default:c(()=>[...e[70]||(e[70]=[z("å·²å­˜åœ¨",-1)])]),_:1})])):w("",!0),I.displayStatus==="waiting"?(p(),g("div",_o,[r(v,{size:"small",class:"waiting-tag"},{default:c(()=>[...e[71]||(e[71]=[z("ç­‰å¾…ä¸­",-1)])]),_:1})])):I.displayStatus==="publishing"?(p(),g("div",fo,[r(v,{type:"primary",size:"small"},{default:c(()=>[...e[72]||(e[72]=[z("å‘å¸ƒä¸­",-1)])]),_:1})])):I.displayStatus==="paused"?(p(),g("div",go,[r(v,{type:"warning",size:"small"},{default:c(()=>[...e[73]||(e[73]=[z("å·²æš‚åœ",-1)])]),_:1})])):I.displayStatus==="warning"?(p(),g("div",ho,[r(v,{type:"warning",size:"small"},{default:c(()=>[...e[74]||(e[74]=[z("æ·»åŠ å¤±è´¥",-1)])]),_:1})])):w("",!0),I.downloaderStatus?(p(),g("div",bo,[a("div",yo,[I.downloaderStatus.success?(p(),T(o,{key:0,color:"#67C23A",size:16},{default:c(()=>[r(C(cs))]),_:1})):(p(),T(o,{key:1,color:"#F56C6C",size:16},{default:c(()=>[r(C(Ls))]),_:1}))]),a("span",{class:N(["status-text",{success:I.downloaderStatus.success,error:!I.downloaderStatus.success}])},y(I.downloaderStatus.success?`ç§å­å·²æ·»åŠ åˆ°'${I.downloaderStatus.downloaderName}'`:"æ·»åŠ å¤±è´¥"),3)])):w("",!0),a("div",wo,[r(l,{type:"primary",size:"small",onClick:Wo=>St(I.siteName,I.logs)},{default:c(()=>[...e[75]||(e[75]=[z(" æŸ¥çœ‹æ—¥å¿— ",-1)])]),_:1},8,["onClick"]),I.success&&I.url?(p(),g("a",{key:0,href:Vs(I.url),target:"_blank",rel:"noopener noreferrer",style:{transform:"translateY(-1px)"}},[r(l,{type:"success",size:"small"},{default:c(()=>[...e[76]||(e[76]=[z(" æŸ¥çœ‹ç§å­ ",-1)])]),_:1})],8,ko)):w("",!0)])],2))),128))]),a("div",So,[r(l,{type:"warning",icon:C(we),size:"large",onClick:I=>zt(i),disabled:!Ct(i),class:"open-all-button"},{default:c(()=>[a("div",Io,"æ‰“å¼€"+y(Et(i))+"ä¸ªç«™ç‚¹",1)]),_:2},1032,["icon","onClick","disabled"])])]))),128))])])):w("",!0)]),a("footer",$o,[E.value===0?(p(),g("div",Co,[r(je,{name:"el-fade-in-linear"},{default:c(()=>[Y.showCompleteButton?(p(),g("div",Eo," ä¿®æ”¹å®Œæˆåè¯·é¢„è§ˆä¸€éç§å­ä¿¡æ¯ç¡®ä¿æ— è¯¯åå®Œæˆä¿®æ”¹ï¼ ")):w("",!0)]),_:1}),r(l,{onClick:as},{default:c(()=>[...e[77]||(e[77]=[z("å–æ¶ˆ",-1)])]),_:1}),r(l,{type:"primary",onClick:it,disabled:Cs.value},{default:c(()=>[...e[78]||(e[78]=[z(" ä¸‹ä¸€æ­¥ï¼šå‘å¸ƒå‚æ•°é¢„è§ˆ ",-1)])]),_:1},8,["disabled"]),r(je,{name:"el-fade-in-linear"},{default:c(()=>[Cs.value?(p(),g("div",zo,[r(o,{class:"hint-icon"},{default:c(()=>[r(C(De))]),_:1}),a("span",null,y(kt.value),1)])):w("",!0)]),_:1})])):w("",!0),E.value===1?(p(),g("div",To,[r(l,{onClick:ht,disabled:L.value},{default:c(()=>[...e[79]||(e[79]=[z("ä¸Šä¸€æ­¥",-1)])]),_:1},8,["disabled"]),Y.showCompleteButton?(p(),T(l,{key:0,type:"primary",onClick:ks,disabled:L.value||!ne.value,class:N({"scrolled-to-bottom":ne.value})},{default:c(()=>[...e[80]||(e[80]=[z(" ä¿®æ”¹å®Œæˆ ",-1)])]),_:1},8,["disabled","class"])):w("",!0),r(l,{type:"primary",onClick:ut,disabled:L.value||!ne.value,class:N({"scrolled-to-bottom":ne.value})},{default:c(()=>[...e[81]||(e[81]=[z(" ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©å‘å¸ƒç«™ç‚¹ ",-1)])]),_:1},8,["disabled","class"]),r(je,{name:"el-fade-in-linear"},{default:c(()=>[Y.showCompleteButton&&!ne.value?(p(),g("div",Do,[r(o,{class:"hint-icon"},{default:c(()=>[r(C(De))]),_:1}),e[82]||(e[82]=a("span",null,"è¯·æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ£€æŸ¥å®Œç§å­ä¿¡æ¯æ— è¯¯å†å‘å¸ƒï¼",-1))])):w("",!0)]),_:1}),r(je,{name:"el-fade-in-linear"},{default:c(()=>[!Y.showCompleteButton&&!ne.value?(p(),g("div",No,[r(o,{class:"hint-icon"},{default:c(()=>[r(C(De))]),_:1}),e[83]||(e[83]=a("span",null,"è¯·å…ˆæ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ£€æŸ¥å®Œç§å­ä¿¡æ¯å†å‘å¸ƒï¼",-1))])):w("",!0)]),_:1})])):w("",!0),E.value===2?(p(),g("div",Vo,[r(l,{onClick:as,disabled:L.value},{default:c(()=>[...e[84]||(e[84]=[z("å–æ¶ˆ",-1)])]),_:1},8,["disabled"]),r(l,{type:"primary",onClick:gt,loading:L.value,disabled:O.value.length===0},{default:c(()=>[...e[85]||(e[85]=[z(" ç«‹å³å‘å¸ƒ ",-1)])]),_:1},8,["loading","disabled"])])):w("",!0),E.value===3?(p(),g("div",xo,[r(l,{type:"primary",onClick:ks},{default:c(()=>[...e[86]||(e[86]=[z("å®Œæˆ",-1)])]),_:1})])):w("",!0)])]),Re.value?(p(),g("div",{key:0,class:"log-card-overlay",onClick:Ns})):w("",!0),Re.value?(p(),T(be,{key:1,class:"log-card",shadow:"xl"},{header:c(()=>[a("div",Bo,[e[87]||(e[87]=a("span",null,"æ“ä½œæ—¥å¿—",-1)),r(l,{type:"danger",icon:C(As),circle:"",onClick:Ns},null,8,["icon"])])]),default:c(()=>[a("pre",Ao,y(Z.value),1)]),_:1})):w("",!0),r(Gt,{visible:Pe.value,taskId:vs.value,onComplete:Tt,onClose:e[21]||(e[21]=i=>Pe.value=!1)},null,8,["visible","taskId"]),r(Dt,{modelValue:te.value,"onUpdate:modelValue":e[23]||(e[23]=i=>te.value=i),title:"æŠ“å–å¤±è´¥ - è¯¦ç»†æ—¥å¿—",width:"800px","destroy-on-close":"","append-to-body":"",class:"error-log-dialog"},{footer:c(()=>[a("span",qo,[r(l,{onClick:e[22]||(e[22]=i=>te.value=!1)},{default:c(()=>[...e[89]||(e[89]=[z("å…³é—­",-1)])]),_:1})])]),default:c(()=>[a("div",Ro,[r(is,{title:"è·å–ç§å­ä¿¡æ¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯",type:"error",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}},{default:c(()=>[...e[88]||(e[88]=[a("div",null,"è¯·æŸ¥çœ‹ä¸‹æ–¹è¯¦ç»†æ—¥å¿—ä»¥æ’æŸ¥é—®é¢˜ï¼ˆå¦‚ Python å †æ ˆä¿¡æ¯ï¼‰ã€‚",-1)])]),_:1}),r(ds,{height:"500px"},{default:c(()=>[a("div",Po,[(p(!0),g(A,null,U(de.value,i=>(p(),g("div",{key:i.id,class:N(["log-entry",{"is-error":i.isError}])},[a("div",Lo,[a("span",Mo,y(i.time),1),r(v,{type:Se(i.level),size:"small",effect:"dark",class:"log-level-tag"},{default:c(()=>[z(y(i.level),1)]),_:2},1032,["type"]),i.site?(p(),g("span",Uo,"["+y(i.site)+"]",1)):w("",!0),a("span",Oo,y(i.message),1)]),i.details?(p(),g("div",Fo,[a("pre",jo,y(i.details),1)])):w("",!0)],2))),128))])]),_:1})])]),_:1},8,["modelValue"])],64)}}}),Jo=js(Ho,[["__scopeId","data-v-3e29b4fe"]]);export{Jo as C,Rt as u};
