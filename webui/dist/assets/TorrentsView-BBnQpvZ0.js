import{C as vt,d as pt,p as R,r as p,c as g,j as b,b as n,e as I,w as l,h as s,x as me,D as as,t as u,G as ls,H as ns,I as os,J as is,K as rs,F as ee,k as ce,i as r,n as fe,g as f,l as P,L as ue,M as ds,m as gt,f as J,N as ct,s as us,o as cs,O as fs,u as Ke,v as vs,P as ps,z as k,Q as gs,q as ms,B as _s}from"./index-BiuajaRa.js";import{u as hs,C as ys}from"./CrossSeedPanel-BNH9luVd.js";const mt=vt("siteData",{state:()=>({dialogVisible:!1,currentTorrent:null,downloadersMap:new Map,allDownloaders:[]}),actions:{openDialog(te,O){this.currentTorrent=te,this.dialogVisible=!0,this.allDownloaders=O||[],this.downloadersMap.clear(),O&&O.forEach(A=>{this.downloadersMap.set(A.id,A.name)})},closeDialog(){this.dialogVisible=!1,this.currentTorrent=null,this.downloadersMap.clear(),this.allDownloaders=[]},setCurrentTorrent(te){this.currentTorrent=te},getDownloaderName(te){return this.downloadersMap.get(te)||"未知下载器"},getAllDownloaders(){return this.allDownloaders}}}),ws={key:0,class:"modal-overlay"},Ss={class:"modal-header"},xs={key:0,class:"site-data-content"},ks={class:"torrent-info"},bs={class:"torrent-name"},$s={class:"name-text"},Cs={class:"torrent-stats"},Is={class:"stat-item stat-item--fixed"},Ds={class:"stat-value"},zs={class:"stat-item stat-item--fixed"},Ns={class:"stat-value"},Us={class:"stat-item stat-item--path"},Ts=["title"],Vs={class:"stat-item stat-item--fixed"},Es={class:"stat-value"},Ls={class:"stat-item stat-item--fixed"},Rs={class:"stat-value"},Bs={class:"content-area"},Ms={class:"sites-container"},Ps={key:0,class:"sites-grid"},Os=["onClick"],As={class:"site-tile"},Fs={class:"site-content"},js={class:"site-name-wrapper"},Ys={class:"site-name-with-link"},Ws={class:"site-name-text"},Js={class:"seeders-info"},qs={class:"right-panel"},Ks={class:"downloaders-section"},Hs={class:"downloaders-list"},Xs=["onClick"],Gs={class:"flow-section"},Qs={class:"flow-cards"},Zs={class:"flow-card"},ea={class:"card-content"},ta={key:0,class:"empty-state"},sa={key:1,class:"site-info"},aa={class:"site-name"},la={class:"flow-card"},na={class:"card-content"},oa={class:"downloader-info current"},ia={class:"flow-card"},ra={class:"card-content"},da={class:"progress-section"},ua={class:"progress-bar-container"},ca={class:"progress-percentage"},fa={class:"progress-steps-info"},va={key:0,class:"current-status"},pa={class:"modal-footer"},ga=pt({__name:"SiteDataViewer",props:{torrent:{}},emits:["refresh"],setup(te,{emit:O}){const A=O,D=mt(),se=R(()=>D.dialogVisible),v=R(()=>D.currentTorrent),U=p(null),z=p(null),q=R(()=>!v.value||!v.value.sites?[]:Object.entries(v.value.sites).map(([c,d])=>({siteName:c,...d})).sort((c,d)=>(d.seeders||0)-(c.seeders||0))),K=()=>{Q(),D.closeDialog()},H=c=>{if(c==null||c<=0)return"0 B";const d=["B","KB","MB","GB","TB","PB"],$=Math.floor(Math.log(c)/Math.log(1024));return`${(c/Math.pow(1024,$)).toFixed(2)} ${d[$]}`},X=c=>!!(c&&(c.startsWith("http")||/^\d+$/.test(c))),be=c=>(c.startsWith("http"),c),ae=c=>c.downloaderIds&&c.downloaderIds.length>0?c.downloaderIds.length===1?D.getDownloaderName(c.downloaderIds[0]):`${D.getDownloaderName(c.downloaderIds[0])} +${c.downloaderIds.length-1}`:c.downloaderId?D.getDownloaderName(c.downloaderId):"未知",B=c=>{U.value=c},M=c=>U.value===c,E=R(()=>{if(!U.value||!v.value||!v.value.sites)return null;const c=v.value.sites[U.value];return{siteName:U.value,seeders:c?.seeders||0,state:c?.state||"未知"}}),y=c=>{z.value=c},_=R(()=>D.getAllDownloaders()),Y=R(()=>{if(!v.value)return null;const c=v.value.downloaderIds||[],d=v.value.downloaderId;return c.length>0?{id:c[0],name:D.getDownloaderName(c[0])}:d?{id:d,name:D.getDownloaderName(d)}:null}),T=p(0),ve=R(()=>{switch(T.value){case 0:return 0;case 1:return 33;case 2:return 66;case 3:return 100;default:return 0}}),G=R(()=>{if(T.value!==0&&T.value===3)return"success"}),W=c=>({"step-info--pending":T.value<c,"step-info--active":T.value===c,"step-info--completed":T.value>c}),we=()=>{switch(T.value){case 1:return"正在暂停种子...";case 2:return"正在导出种子文件并添加...";case 3:return"转种完成！";default:return""}},Q=()=>{T.value=0},ze=async()=>{if(!U.value||!z.value||!v.value)return;const c=v.value.downloaderId||(v.value.downloaderIds&&v.value.downloaderIds.length>0?v.value.downloaderIds[0]:null);if(!c){alert("无法获取当前下载器信息");return}Q();try{T.value=1;const $=await(await fetch("/api/torrent/transfer/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:c,target_downloader_id:z.value,site_name:U.value,torrent_name:v.value.name,torrent_size:v.value.size,save_path:v.value.save_path})})).json();if(!$.success){if($.suggestions&&$.suggestions.length>0){const oe=$.suggestions.map((x,he)=>`${he+1}. ${x.name}
   站点: ${x.sites}
   大小: ${(x.size/1073741824).toFixed(2)} GB
   路径: ${x.save_path}`).join(`

`);if(confirm(`准备转移失败: ${$.message}

找到 ${$.suggestion_count} 个相似的种子:

${oe}

是否要使用第一个相似种子继续转移？`)&&$.suggestions.length>0){const x=$.suggestions[0];v.value&&(v.value.sites={[x.sites]:v.value.sites[U.value]||{}}),await Ne(x)}else Q()}else alert(`准备转移失败: ${$.message}`),Q();return}console.log(`找到 ${$.found_count} 个匹配的种子`),T.value=2;const C=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:c,target_downloader_id:z.value,site_name:U.value,torrent_name:v.value.name,torrent_size:v.value.size,save_path:v.value.save_path})})).json();if(!C.success){alert(`转移失败: ${C.message}`),Q();return}T.value=3,console.log("转移完成:",C);const _e=C.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${_e}`),A("refresh")}catch(d){console.error("转移过程中发生错误:",d),alert(`转移过程中发生错误: ${d?.message||"未知错误"}`),Q()}},Ne=async c=>{if(!z.value||!v.value)return;const d=v.value.downloaderId||(v.value.downloaderIds&&v.value.downloaderIds.length>0?v.value.downloaderIds[0]:null);if(!d){alert("无法获取当前下载器信息"),Q();return}try{console.log("使用相似种子重试转移:",c),T.value=2;const L=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:d,target_downloader_id:z.value,site_name:c.sites,torrent_name:c.name,torrent_size:c.size,save_path:c.save_path})})).json();if(!L.success){alert(`转移失败: ${L.message}`),Q();return}T.value=3,console.log("转移完成:",L);const C=L.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${C}`),A("refresh")}catch($){console.error("重试转移过程中发生错误:",$),alert(`重试转移过程中发生错误: ${$?.message||"未知错误"}`),Q()}};return(c,d)=>{const $=I("el-button"),L=I("el-icon"),C=I("el-link"),_e=I("el-tag"),oe=I("el-progress"),ie=I("el-card");return se.value?(f(),g("div",ws,[n(ie,{class:"site-data-card",shadow:"always"},{header:l(()=>[s("div",Ss,[s("span",null,"站点数据查看 - "+u(v.value?.name),1),n($,{type:"danger",circle:"",onClick:K,plain:""},{default:l(()=>[...d[1]||(d[1]=[r("X",-1)])]),_:1})])]),default:l(()=>[v.value?(f(),g("div",xs,[s("div",ks,[s("div",bs,[n(L,{class:"torrent-icon"},{default:l(()=>[n(me(as))]),_:1}),s("span",$s,u(v.value.name),1)]),s("div",Cs,[s("div",Is,[n(L,{class:"stat-icon"},{default:l(()=>[n(me(ls))]),_:1}),d[2]||(d[2]=s("span",{class:"stat-label"},"大小",-1)),s("span",Ds,u(H(v.value.size)),1)]),s("div",zs,[n(L,{class:"stat-icon"},{default:l(()=>[n(me(ns))]),_:1}),d[3]||(d[3]=s("span",{class:"stat-label"},"上传",-1)),s("span",Ns,u(v.value.total_uploaded_formatted||H(v.value.total_uploaded)),1)]),s("div",Us,[n(L,{class:"stat-icon"},{default:l(()=>[n(me(os))]),_:1}),d[4]||(d[4]=s("span",{class:"stat-label"},"路径",-1)),s("span",{class:"stat-value",title:v.value.save_path},u(v.value.save_path),9,Ts)]),s("div",Vs,[n(L,{class:"stat-icon"},{default:l(()=>[n(me(is))]),_:1}),d[5]||(d[5]=s("span",{class:"stat-label"},"下载器",-1)),s("span",Es,u(ae(v.value)),1)]),s("div",Ls,[n(L,{class:"stat-icon"},{default:l(()=>[n(me(rs))]),_:1}),d[6]||(d[6]=s("span",{class:"stat-label"},"可转种",-1)),s("span",Rs,u(v.value.target_sites_count||0)+"个",1)])])]),s("div",Bs,[s("div",Ms,[q.value.length>0?(f(),g("div",Ps,[(f(!0),g(ee,null,ce(q.value,x=>(f(),g("div",{key:x.siteName,class:fe(["site-card",{"site-card--selected":M(x.siteName)}]),onClick:he=>B(x.siteName)},[s("div",As,[s("div",Fs,[s("div",js,[s("div",Ys,[s("span",Ws,u(x.siteName),1),X(x.comment)?(f(),P(C,{key:0,href:be(x.comment),target:"_blank",underline:!1,class:"site-link-icon",onClick:d[0]||(d[0]=ue(()=>{},["stop"]))},{default:l(()=>[n(L,{size:"10"},{default:l(()=>[n(me(ds))]),_:1})]),_:1},8,["href"])):b("",!0)])]),s("div",Js,[n(_e,{type:x.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(u(x.seeders||0)+"人做种 ",1)]),_:2},1032,["type"])])])])],10,Os))),128))])):b("",!0)]),s("div",qs,[s("div",Ks,[d[7]||(d[7]=s("div",{class:"section-title"},"下载器",-1)),s("div",Hs,[(f(!0),g(ee,null,ce(_.value,x=>(f(),g("div",{key:x.id,class:fe(["downloader-item",{"downloader-item--selected":z.value===x.id}]),onClick:he=>y(x.id)},u(x.name),11,Xs))),128))])]),s("div",Gs,[s("div",Qs,[s("div",Zs,[d[8]||(d[8]=s("div",{class:"card-title"},"选中站点",-1)),s("div",ea,[E.value?(f(),g("div",sa,[s("div",aa,u(E.value.siteName),1),n(_e,{type:E.value.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(u(E.value.seeders)+"人做种 ",1)]),_:1},8,["type"])])):(f(),g("div",ta,"未选择"))])]),d[11]||(d[11]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",la,[d[9]||(d[9]=s("div",{class:"card-title"},"当前下载器",-1)),s("div",na,[s("div",oa,u(Y.value?.name||"未知"),1)])]),d[12]||(d[12]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",ia,[d[10]||(d[10]=s("div",{class:"card-title"},"目标下载器",-1)),s("div",ra,[s("div",{class:fe(["downloader-info target",{selected:z.value}])},u(z.value?me(D).getDownloaderName(z.value):"未选择"),3)])])])]),s("div",da,[d[16]||(d[16]=s("div",{class:"progress-title"},"转种流程",-1)),s("div",ua,[n(oe,{percentage:ve.value,status:G.value,"stroke-width":8,"show-text":!0},{default:l(({percentage:x})=>[s("span",ca,u(x)+"%",1)]),_:1},8,["percentage","status"]),s("div",fa,[s("div",{class:fe(["step-info",W(1)])},[...d[13]||(d[13]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"暂停种子"),s("div",{class:"step-desc"},"暂停下载器中选择的站点种子")],-1)])],2),s("div",{class:fe(["step-info",W(2)])},[...d[14]||(d[14]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"导出种子"),s("div",{class:"step-desc"},"导出种子文件并添加到目标下载器")],-1)])],2),s("div",{class:fe(["step-info",W(3)])},[...d[15]||(d[15]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"转移完成"),s("div",{class:"step-desc"},"种子已成功转移到目标下载器")],-1)])],2)]),T.value>0&&T.value<=3?(f(),g("div",va,u(we()),1)):b("",!0)])])])])])):b("",!0),s("div",pa,[n($,{type:"success",onClick:ze,disabled:!U.value||!z.value||T.value>0},{default:l(()=>[...d[17]||(d[17]=[r(" 执行转种 ",-1)])]),_:1},8,["disabled"]),n($,{type:"primary",onClick:K},{default:l(()=>[...d[18]||(d[18]=[r("关闭",-1)])]),_:1})])]),_:1})])):b("",!0)}}}),ma=gt(ga,[["__scopeId","data-v-6ee24ce4"]]),_a=vt("torrentsViewState",()=>{const te=p(!1),O=p(null),A=p([]),D=p([]),se=p([]),v=p(!1),U=p(!1),z=p(!1),q=()=>{te.value=!0},K=async(ae=!1)=>{if(!ae&&v.value&&O.value)return O.value;try{const B=await J.get("/api/ui_settings");return O.value=B.data,v.value=!0,O.value}catch(B){return console.error("加载UI设置时出错:",B),v.value=!0,O.value||{}}},H=async(ae=!1)=>{if(!ae&&U.value)return{downloadersList:A.value,allDownloadersList:D.value};try{const M=(await J.get("/api/all_downloaders")).data;return A.value=M.filter(E=>E.enabled),D.value=M,U.value=!0,{downloadersList:A.value,allDownloadersList:D.value}}catch(B){return console.error("获取下载器列表时出错:",B),U.value=!0,{downloadersList:A.value,allDownloadersList:D.value}}},X=async(ae=!1)=>{if(!ae&&z.value)return se.value;try{const M=(await J.get("/api/sites/status")).data;return se.value=M.filter(E=>E.is_source),z.value=!0,se.value}catch(B){return console.error("获取站点状态时出错:",B),z.value=!0,se.value}};return{hasInitializedOnce:te,cachedUiSettings:O,cachedDownloadersList:A,cachedAllDownloadersList:D,cachedAllSourceSitesStatus:se,isUiSettingsLoaded:v,isDownloadersLoaded:U,isSitesStatusLoaded:z,setInitialized:q,fetchUiSettings:K,fetchDownloadersList:H,fetchSitesStatus:X,refreshAllCachedData:async()=>{await Promise.all([K(!0),H(!0),X(!0)])}}}),ha={class:"torrents-view"},ya={class:"expand-content"},wa=["onClick"],Sa=["href"],xa=["onClick"],ka={class:"name-header-container"},ba={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},$a={style:{"white-space":"normal"}},Ca={style:{display:"inline-block",width:"100%","text-align":"center"}},Ia=["title"],Da={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},za={key:0},Na={style:{padding:"1px 0",width:"100%"}},Ua={style:{"text-align":"center","font-size":"12px","margin-top":"5px","line-height":"1"}},Ta={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Va={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ea={key:0},La={key:1},Ra={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ba={key:3,class:"modal-overlay"},Ma={class:"modal-header"},Pa={key:0,class:"cross-seed-content"},Oa={class:"filter-card-header"},Aa={class:"filter-card-body"},Fa={class:"site-filter-container"},ja={style:{display:"flex","align-items":"center",gap:"15px","margin-bottom":"5px"}},Ya={style:{display:"flex","align-items":"center",gap:"10px"}},Wa={key:0,style:{display:"flex","align-items":"center"}},Ja={key:1,style:{display:"flex","align-items":"center"}},qa={class:"site-checkbox-container"},Ka={style:{"margin-bottom":"10px"}},Ha={key:0,style:{display:"flex","align-items":"center"}},Xa={style:{"margin-bottom":"10px"}},Ga={key:0,style:{display:"flex","align-items":"center"}},Qa={class:"path-tree-container"},Za={style:{"margin-bottom":"10px"}},el={key:0,style:{display:"flex","align-items":"center"}},tl={class:"filter-card-footer"},sl={class:"filter-card-header"},al={class:"site-operation-body"},ll={class:"torrent-name-container"},nl={class:"torrent-name"},ol={key:0,class:"site-operation-link"},il={key:1,class:"site-operation-input"},rl={class:"site-operation-buttons"},dl={key:6,class:"filter-overlay"},ul={class:"filter-card-header"},cl={class:"source-site-selection-body"},fl={class:"source-site-tip"},vl={key:0,class:"cached-sites-section"},pl={class:"cached-sites-label"},gl={class:"site-list-box glass-site-box cached-sites-box"},ml={key:1,class:"uncached-sites-section"},_l={class:"site-list-box glass-site-box"},hl={class:"filter-card-footer"},yl={class:"filter-card-header"},wl={class:"filter-card-body"},Sl={style:{color:"#606266","margin-bottom":"10px"}},xl={class:"filter-card-footer"},kl=220,bl=90,ft=30,De=200,$l=2e3,Cl=pt({__name:"TorrentsView",emits:["ready"],setup(te,{emit:O}){const A=O,D=_a(),se=p(null),v=p(!0),U=p(!1),z=p([]),q=p(null),K=t=>{window.dispatchEvent(new CustomEvent("app-global-refresh-loading",{detail:{refreshing:t}}))},H=async()=>{if(!U.value){U.value=!0,v.value=!0,K(!0);try{await J.post("/api/refresh_data")}catch(t){console.warn("种子数据刷新失败:",t)}try{await Promise.all([Ze(!0),et(!0)]),await Me()}finally{v.value=!1,K(!1),U.value=!1}}},X=async()=>{v.value=!0,await Ve()},be=p(!1),ae=p(!1),B=p(!0),M=p(""),E=p({prop:"name",order:"ascending"}),y=ct({paths:[],states:[],existSiteNames:[],notExistSiteNames:[],downloaderIds:[]}),_=ct({...y}),Y=p("exist"),T=R({get:()=>Y.value==="exist"?_.existSiteNames:_.notExistSiteNames,set:t=>{Y.value==="exist"?_.existSiteNames=t:_.notExistSiteNames=t}}),ve=p(!1),G=p(1),W=p(50),we=p(0),Q=p([]),ze=p([]),Ne=p([]),c=p({}),d=p([]),$=p([]),L=p([]),C=p(null),_e=p([]),oe=p(!1),ie=p([]),x=p(!1),he=p(!1),Le=p(null),N=p(null),Ue=p(null),Re=p(!1),pe=p([]),He=p(!1),Z=hs(),_t=mt(),ht=R(()=>!!Z.taskId),F=R(()=>Z.workingParams);R(()=>Z.sourceInfo?.name||"");const ye=p(!1),Se=p(""),V=p(null),re=p(""),Te=p({}),Be=R(()=>{const t=new Intl.Collator("zh-CN",{numeric:!0});return[...Ne.value].sort(t.compare)}),xe=p(""),Xe=R(()=>{if(!xe.value)return Be.value;const t=xe.value.toLowerCase();return Be.value.filter(e=>e.toLowerCase().includes(t))}),yt=t=>{let e=0;for(const o of t)e+=o.charCodeAt(0)>255?14:8;return e},wt=R(()=>{const t=z.value||[];let e=0;for(const i of t){const h=String(i?.save_path||""),w=it(h,ft)||"";e=Math.max(e,yt(w))}const o=e+40;return Math.min(kl,Math.max(bl,Math.round(o)))}),St=R(()=>{const t=y,e=[];return t.paths&&t.paths.length>0&&e.push(`路径: ${t.paths.length}`),t.states&&t.states.length>0&&e.push(`状态: ${t.states.length}`),t.existSiteNames&&t.existSiteNames.length>0&&e.push(`存在于: ${t.existSiteNames.length}`),t.notExistSiteNames&&t.notExistSiteNames.length>0&&e.push(`不存在于: ${t.notExistSiteNames.length}`),t.downloaderIds&&t.downloaderIds.length>0&&e.push(`下载器: ${t.downloaderIds.length}`),e.join(", ")}),xt=R(()=>{const t=y;return t.paths&&t.paths.length>0||t.states&&t.states.length>0||t.existSiteNames&&t.existSiteNames.length>0||t.notExistSiteNames&&t.notExistSiteNames.length>0||t.downloaderIds&&t.downloaderIds.length>0});R(()=>{const t=Xe.value;return Y.value==="exist"?t.filter(e=>!_.notExistSiteNames.includes(e)):t.filter(e=>!_.existSiteNames.includes(e))});const Ge=t=>Y.value==="exist"?!_.notExistSiteNames.includes(t):!_.existSiteNames.includes(t),kt=[{color:"#f56c6c",percentage:80},{color:"#e6a23c",percentage:99},{color:"#67c23a",percentage:100}],$e=async()=>{try{const t={page_size:W.value,sort_prop:E.value.prop,sort_order:E.value.order,name_search:M.value,active_filters:y};await J.post("/api/ui_settings",t)}catch(t){console.error("无法保存UI设置:",t.message)}},Qe=async(t=!1)=>{try{const e=await D.fetchUiSettings(t);if(W.value=e.page_size??50,E.value={prop:e.sort_prop||"name",order:"sort_order"in e?e.sort_order:"ascending"},M.value=e.name_search??"",e.active_filters){Object.assign(y,e.active_filters),y.existSiteNames||(y.existSiteNames=[]),y.notExistSiteNames||(y.notExistSiteNames=[]);const o=y;o.siteExistence&&delete o.siteExistence,o.siteNames&&delete o.siteNames}}catch(e){console.error("加载UI设置时出错:",e)}finally{be.value=!0}},bt=t=>{const e=[],o=new Map;return t.sort().forEach(i=>{const h=i.replace(/^\/|\/$/g,"").split("/");let w="",m=e;h.forEach((ge,le)=>{if(w=le===0?`/${ge}`:`${w}/${ge}`,!o.has(w)){const j={path:le===h.length-1?i:w,label:ge,children:[]};o.set(w,j),m.push(j)}m=o.get(w).children})}),o.forEach(i=>{i.children&&i.children.length===0&&delete i.children}),e},Ze=async(t=!1)=>{try{const e=await D.fetchDownloadersList(t);$.value=e.downloadersList,L.value=e.allDownloadersList}catch(e){q.value=e.message}},et=async(t=!1)=>{try{ie.value=await D.fetchSitesStatus(t)}catch(e){q.value=e.message}},Me=async()=>{q.value=null;try{const t=new URLSearchParams({page:G.value.toString(),pageSize:W.value.toString(),nameSearch:M.value,sortProp:E.value.prop||"name",sortOrder:E.value.order||"ascending",existSiteNames:JSON.stringify(y.existSiteNames),notExistSiteNames:JSON.stringify(y.notExistSiteNames),path_filters:JSON.stringify(y.paths||[]),state_filters:JSON.stringify(y.states),downloader_filters:JSON.stringify(y.downloaderIds)}),o=(await J.get(`/api/data?${t.toString()}`)).data;if(o.error)throw new Error(o.error);z.value=o.data,we.value=o.total,W.value!==o.pageSize&&(W.value=o.pageSize),Q.value=o.unique_paths,ze.value=o.unique_states,Ne.value=o.all_discovered_sites,c.value=o.site_link_rules,y.paths=o.active_path_filters,_e.value=bt(o.unique_paths)}catch(t){q.value=t.message}},Ve=async()=>{v.value=!0;try{await Me()}finally{v.value=!1}},$t=async t=>{Z.reset();const e=Object.entries(t.sites).map(([o,i])=>({siteName:o,...i})).filter(o=>{if(!(o.migration===1||o.migration===3))return!1;const h=o.comment&&o.comment.includes("details.php?id="),w=o.comment&&/^\d+$/.test(o.comment.trim());return h||w});Z.setParams(t),await Dt(t),e.length===0&&k.warning("该种子暂无可用的源站点，您可以使用 IYUU 查询来发现更多站点。"),oe.value=!0},Ct=t=>{_t.openDialog(t,L.value)},It=async()=>{console.log("触发种子数据刷新"),await H()},Dt=async t=>{He.value=!0,pe.value=[];try{const o=(await J.get(`/api/cached_sites?name=${encodeURIComponent(t.name)}&size=${t.size}`)).data;o.success?(pe.value=o.cached_sites||[],console.log("缓存站点查询结果:",pe.value)):console.warn("查询缓存站点失败:",o.error)}catch(e){console.error("查询缓存站点时出错:",e)}finally{He.value=!1}},tt=async t=>{const e=F.value;if(!e||!t){k.error("发生内部错误：未找到选中的种子或站点信息。");return}const o=e.sites[t.siteName],i=t.siteName;if(!o){k.error(`未找到站点 [${i}] 的数据。`);return}if(!Ce(o,i)){k.info(`站点 [${i}] 缺少详情链接，正在触发 IYUU 查询...`),Te.value[i]=!0,await ot(),Te.value[i]=!1;return}let h=null;const w=o?.comment?.match(/id=(\d+)/);if(w&&w[1])h=w[1];else if(o?.comment&&/^\d+$/.test(o.comment.trim()))h=o.comment.trim();else{k.error(`无法从源站点 ${i} 的详情页链接中提取种子ID。请尝试使用IYUU查询更新链接。`);return}o&&(o.torrentId=h);const m=ie.value.find(le=>le.name===i)?.site||i.toLowerCase();k.success(`准备从站点 [${i}] 开始迁移种子...`);const ge={name:i,site:m,torrentId:h};Z.setSourceInfo(ge),Z.setTaskId(e.name+"_"+Date.now()),oe.value=!1},ke=t=>{if(!!!(F.value&&F.value.sites[t]))return!1;const o=ie.value.find(i=>i.name===t);return!o||!o.has_cookie&&t!=="肉丝"?!1:t==="杜比"||t==="HDtime"||t==="肉丝"?!!o.has_passkey:!0},st=()=>{Z.reset()},at=(t,e)=>{Se.value=t,V.value=e,re.value="",ye.value=!0},lt=async()=>{if(!Se.value||!V.value){k.error("缺少必要的参数");return}if(!re.value||re.value.trim()===""){k.error("请输入详情页链接或ID");return}try{const e=(await J.post("/api/sites/update_comment",{torrent_name:Se.value,site_name:V.value.name,comment:re.value.trim()})).data;e.success?(k.success("详情页链接已成功添加"),ye.value=!1,re.value="",await Ve()):k.error(e.error||"添加详情页链接失败")}catch(t){console.error("添加详情页链接时出错:",t),k.error("添加详情页链接时发生网络错误")}},zt=async()=>{if(!Se.value||!V.value){k.error("缺少必要的参数");return}try{const t=await J.post("/api/sites/set_not_exist",{torrent_name:Se.value,site_name:V.value.name});k.success("站点状态已成功设置为不存在"),ye.value=!1,Ve()}catch(t){console.error("设置站点状态时出错:",t),k.error(t.response?.data?.error||"设置站点状态时发生错误")}},Nt=async()=>{k.success("转种操作已完成！"),Z.reset(),await H()},Ut=async()=>{k.success("转种操作已完成！"),Z.reset(),await H()},nt=t=>{if(!F.value)return null;const e=F.value.sites[t];return e?{siteName:t,...e}:null},Ee=()=>{Ue.value&&(clearInterval(Ue.value),Ue.value=null)},Pe=async()=>{if(Le.value)try{const t=await J.get(`/api/iyuu_query_batch_progress?task_id=${encodeURIComponent(Le.value)}`);if(t.data?.success){if(N.value=t.data.task,N.value&&!N.value.isRunning&&(Ee(),!Re.value))if(Re.value=!0,N.value.success){k.success(N.value.message||"IYUU批量查询已完成"),await Ve();const e=F.value;if(e){const o=z.value.find(i=>i.name===e.name&&i.size===e.size);o&&Z.setParams(o)}}else k.error(N.value.message||"IYUU批量查询失败")}else k.error(t.data?.message||"获取IYUU批量查询进度失败")}catch(t){k.error(t.response?.data?.message||"获取IYUU批量查询进度时发生网络错误")}},Tt=()=>{Ee(),Pe(),Ue.value=setInterval(async()=>{await Pe()},$l)},Oe=()=>{he.value=!1,Ee()},ot=async()=>{const t=F.value,e=we.value||0;if(e<=0){k.warning("当前筛选条件下无可查询的种子");return}const o=Math.min(e,De);try{await gs.confirm(`将对当前筛选结果的前 ${o} 个种子组执行 IYUU 查询（当前筛选共 ${e} 个）。继续？`,"IYUU 批量查询",{confirmButtonText:"开始查询",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1})}catch{return}x.value=!0;try{const i=new URLSearchParams({page:"1",pageSize:o.toString(),nameSearch:M.value,sortProp:E.value.prop||"name",sortOrder:E.value.order||"ascending",existSiteNames:JSON.stringify(y.existSiteNames),notExistSiteNames:JSON.stringify(y.notExistSiteNames),path_filters:JSON.stringify(y.paths||[]),state_filters:JSON.stringify(y.states),downloader_filters:JSON.stringify(y.downloaderIds)}),w=(await J.get(`/api/data?${i.toString()}`)).data;if(w.error)throw new Error(w.error);const m=(w.data||[]).slice(0,De).map(ne=>({name:ne.name,size:ne.size,save_path:ne.save_path})).filter(ne=>ne.name&&ne.size);if(t&&t.name&&t.size&&!m.some(j=>j.name===t.name&&j.size===t.size)){const j={name:t.name,size:t.size,save_path:t.save_path};m.length>=De&&m.pop(),m.unshift(j)}if(m.length===0){k.warning("当前筛选结果中未找到可查询的种子组");return}(w.total||0)>De&&k.info(`筛选结果共 ${w.total} 个，本次仅查询前 ${m.length} 个`);const le=(await J.post("/api/iyuu_query_batch",{torrents:m,max_groups:De,force_query:!0})).data;if(!le?.success){k.error(le?.message||"启动批量IYUU查询失败");return}Le.value=le.task_id,N.value=null,Re.value=!1,he.value=!0,Tt()}catch(i){console.error("触发筛选结果 IYUU 批量查询时出错:",i),k.error(i.response?.data?.message||i.message||"触发IYUU批量查询失败")}finally{x.value=!1}};us(()=>{Ee(),K(!1)});const Vt=t=>{W.value=t,G.value=1,X(),$e()},Et=t=>{G.value=t,X()},Lt=t=>{E.value=t,G.value=1,X(),$e()},Rt=()=>{Object.assign(_,y),ve.value=!0,ms(()=>{C.value&&C.value.setCheckedKeys(y.paths,!1)})},Bt=async()=>{if(C.value){const t=C.value.getCheckedKeys(!1);_.paths=t}Object.assign(y,_),ve.value=!1,G.value=1,await X(),$e()},Mt=()=>{_.paths=[],_.states=[],_.existSiteNames=[],_.notExistSiteNames=[],_.downloaderIds=[],Y.value="exist",xe.value="",C.value&&C.value.setCheckedKeys([],!1)},Pt=()=>{if(_.existSiteNames=[],Y.value==="exist"&&C.value){const t=C.value.getCheckedKeys(!0);_.paths=t}},Ot=()=>{if(_.notExistSiteNames=[],Y.value==="not-exist"&&C.value){const t=C.value.getCheckedKeys(!0);_.paths=t}},At=()=>{_.paths=[],C.value&&C.value.setCheckedKeys([],!1)},Ft=()=>{_.states=[]},jt=()=>{_.downloaderIds=[]},Yt=async()=>{y.paths=[],y.states=[],y.existSiteNames=[],y.notExistSiteNames=[],y.downloaderIds=[],M.value="",Y.value="exist",xe.value="",C.value&&C.value.setCheckedKeys([],!1),G.value=1,await X(),$e()},Ae=t=>{if(t==null||t<=0)return"0 B";const e=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(t)/Math.log(1024));return`${(t/Math.pow(1024,o)).toFixed(2)} ${e[o]}`},Ce=(t,e)=>{const{comment:o}=t;return!!(o&&(o.startsWith("http")||/^\d+$/.test(o)&&c.value[e]))},Fe=(t,e)=>{const{comment:o}=t;if(o.startsWith("http"))return o;const i=c.value[e];return i&&/^\d+$/.test(o)?`${(i.base_url.startsWith("http")?i.base_url:`https://${i.base_url}`).replace(/\/$/,"")}/details.php?id=${o}`:null},je=t=>t.state==="未做种"?"danger":t.state==="不存在"?"info":t.comment?"success":t.state==="做种中"?"primary":"info",Ye=t=>{if(!t)return"未知下载器";const e=L.value.find(o=>o.id===t);return e?e.name:"未知下载器"},Wt=t=>{if(!t||!L.value.find(h=>h.id===t))return"info";let o=0;for(let h=0;h<t.length;h++)o=t.charCodeAt(h)+((o<<5)-o);const i=["primary","success","warning","danger","info"];return i[Math.abs(o)%i.length]},Jt=t=>[...t].sort((o,i)=>{const h=Ye(o),w=Ye(i);return h.localeCompare(w,"zh-CN")}),it=(t,e=50)=>{if(!t||t.length<=e)return t;const o=Math.floor((e-3)/2);let i=t.substring(0,o),h=t.substring(t.length-o);const w=i.lastIndexOf("/"),m=h.indexOf("/");return w>0&&m>=0&&(i=i.substring(0,w),h=h.substring(m+1)),`${i}...${h}`},rt=(t,e)=>{if(!!!(F.value&&F.value.sites[t.name]))return"info";const i=F.value.sites[t.name];return!t.has_cookie||(t.name==="杜比"||t.name==="肉丝")&&!t.has_passkey?"error":t.has_cookie&&i.comment?"success":"primary"},qt=t=>t.state==="做种中"&&t.progress<100?"部分做种":t.state,Kt=(t,e)=>e&&e.state==="做种中"&&e.progress<100?"warning":t.includes("下载")?"primary":t.includes("做种")?"success":t.includes("暂停")?"warning":t.includes("错误")||t.includes("丢失")?"danger":"info",Ht=t=>se.value?.toggleRowExpansion(t),Xt=(t,e)=>{d.value=e.map(o=>o.unique_id)},Gt=({row:t})=>d.value.includes(t.unique_id)?"expanded-row":"";cs(async()=>{B.value=!0,v.value=!0,K(!0),D.hasInitializedOnce?(await Qe(!1),await Promise.all([Ze(!1),et(!1)]),await Me(),v.value=!1,K(!1)):(await Qe(!0),await H(),D.setInitialized()),A("ready",H),Qt(),B.value=!1});const Qt=()=>{ae.value=!1};return fs(M,()=>{B.value||(G.value=1,X(),$e())}),(t,e)=>{const o=I("el-alert"),i=I("el-tag"),h=I("el-table-column"),w=I("el-input"),m=I("el-button"),ge=I("el-progress"),le=I("el-table"),ne=I("el-pagination"),j=I("el-card"),Ie=I("el-divider"),dt=I("el-radio-button"),Zt=I("el-radio-group"),We=I("el-checkbox"),Je=I("el-checkbox-group"),es=I("el-tree"),ts=I("el-link"),de=I("el-descriptions-item"),ut=I("el-descriptions"),qe=vs("loading");return f(),g("div",ha,[q.value?(f(),P(o,{key:0,title:q.value,type:"error","show-icon":"",closable:!1,center:"",style:{"margin-bottom":"15px"}},null,8,["title"])):b("",!0),be.value?Ke((f(),P(le,{key:1,data:z.value,"element-loading-text":"正在刷新种子数据...",border:"",height:"100%",ref_key:"tableRef",ref:se,"row-key":"unique_id","row-class-name":Gt,onRowClick:Ht,onExpandChange:Xt,onSortChange:Lt,"default-sort":E.value,"empty-text":"无数据或当前筛选条件下无结果",class:"glass-table"},{default:l(()=>[n(h,{type:"expand",width:"1"},{default:l(a=>[s("div",ya,[(f(!0),g(ee,null,ce(Be.value,S=>(f(),g(ee,{key:S},[a.row.sites[S]?(f(),g(ee,{key:0},[a.row.sites[S].state==="未做种"?(f(),g("div",{key:0,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:ue(ss=>at(a.row.name,{name:S,data:a.row.sites[S]}),["stop"])},[n(i,{effect:"dark",type:je(a.row.sites[S]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(u(S)+" ",1),s("div",null,"("+u(Ae(a.row.sites[S].uploaded))+")",1)]),_:2},1032,["type"])],8,wa)):a.row.sites[S]&&Ce(a.row.sites[S],S)?(f(),g("a",{key:1,href:Fe(a.row.sites[S],S),target:"_blank",style:{"text-decoration":"none"}},[n(i,{effect:"dark",type:je(a.row.sites[S]),style:{"text-align":"center"}},{default:l(()=>[r(u(S)+" ",1),s("div",null,"("+u(Ae(a.row.sites[S].uploaded))+")",1)]),_:2},1032,["type"])],8,Sa)):(f(),g("div",{key:2,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:ue(ss=>at(a.row.name,{name:S,data:a.row.sites[S]}),["stop"])},[n(i,{effect:"dark",type:je(a.row.sites[S]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(u(S)+" ",1),s("div",null,"("+u(Ae(a.row.sites[S].uploaded))+")",1)]),_:2},1032,["type"])],8,xa))],64)):(f(),P(i,{key:1,type:"info",effect:"plain"},{default:l(()=>[r(u(S),1)]),_:2},1024))],64))),128))])]),_:1}),n(h,{prop:"name","min-width":"450",sortable:"custom"},{header:l(()=>[s("div",ka,[e[22]||(e[22]=s("div",null,"种子",-1)),n(w,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=a=>M.value=a),placeholder:"搜索名称...",clearable:"",class:"search-input",onClick:e[1]||(e[1]=ue(()=>{},["stop"]))},null,8,["modelValue"]),s("span",{onClick:e[2]||(e[2]=ue(()=>{},["stop"])),style:{display:"flex","align-items":"center"}},[xt.value?(f(),g("div",ba,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r(u(St.value),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:Yt},{default:l(()=>[...e[20]||(e[20]=[r("清除",-1)])]),_:1})])):b("",!0),n(m,{type:"primary",onClick:Rt,plain:""},{default:l(()=>[...e[21]||(e[21]=[r("筛选",-1)])]),_:1})])])]),default:l(a=>[s("span",$a,u(a.row.name),1)]),_:1}),n(h,{prop:"site_count",label:"做种数",sortable:"custom",width:"95",align:"center","header-align":"center"},{default:l(a=>[s("span",Ca,u(a.row.site_count)+" / "+u(a.row.total_site_count),1)]),_:1}),n(h,{prop:"save_path",label:"保存路径",width:wt.value,"header-align":"center"},{default:l(a=>[s("div",{title:a.row.save_path,style:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},u(it(a.row.save_path,ft)),9,Ia)]),_:1},8,["width"]),n(h,{label:"下载器",width:"130",align:"center","header-align":"center"},{default:l(a=>[s("div",Da,[a.row.downloaderIds&&a.row.downloaderIds.length>0?(f(),g("div",za,[(f(!0),g(ee,null,ce(Jt(a.row.downloaderIds),S=>(f(),P(i,{key:S,size:"small",type:Wt(S),style:{margin:"2px"}},{default:l(()=>[r(u(Ye(S)),1)]),_:2},1032,["type"]))),128))])):(f(),P(i,{key:1,type:"info",size:"small"},{default:l(()=>[...e[23]||(e[23]=[r(" 未知下载器 ",-1)])]),_:1}))])]),_:1}),n(h,{label:"大小",prop:"size_formatted",width:"100",align:"center",sortable:"custom"}),n(h,{label:"总上传量",prop:"total_uploaded_formatted",width:"110",align:"center",sortable:"custom"}),n(h,{label:"进度",prop:"progress",width:"90",align:"center",sortable:"custom"},{default:l(a=>[s("div",Na,[n(ge,{percentage:a.row.progress,"stroke-width":10,color:kt,"show-text":!1,style:{width:"100%"}},null,8,["percentage"]),s("div",Ua,u(a.row.progress)+"% ",1)])]),_:1}),n(h,{label:"状态",prop:"state",width:"120",align:"center","header-align":"center"},{default:l(a=>[s("div",Ta,[n(i,{type:Kt(a.row.state,a.row),size:"large"},{default:l(()=>[r(u(qt(a.row)),1)]),_:2},1032,["type"])])]),_:1}),n(h,{label:"可转种",width:"100",align:"center","header-align":"center",prop:"target_sites_count",sortable:"custom"},{default:l(a=>[s("div",Va,[a.row.target_sites_count!==void 0?(f(),g("span",Ea,u(a.row.target_sites_count),1)):(f(),g("span",La,"-"))])]),_:1}),n(h,{label:"操作",width:"100",align:"center","header-align":"center"},{default:l(a=>[s("div",Ra,[n(m,{type:"primary",size:"small",onClick:ue(S=>$t(a.row),["stop"]),disabled:!ae.value&&a.row.progress<100},{default:l(()=>[...e[24]||(e[24]=[r(" 转种 ",-1)])]),_:1},8,["onClick","disabled"])])]),_:1})]),_:1},8,["data","default-sort"])),[[qe,v.value]]):b("",!0),we.value>0?(f(),P(ne,{key:2,class:"glass-pagination",style:{"justify-content":"flex-end"},"current-page":G.value,"onUpdate:currentPage":e[3]||(e[3]=a=>G.value=a),"page-size":W.value,"onUpdate:pageSize":e[4]||(e[4]=a=>W.value=a),"page-sizes":[20,50,100],total:we.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Vt,onCurrentChange:Et,background:""},null,8,["current-page","page-size","total"])):b("",!0),ht.value?(f(),g("div",Ba,[n(j,{class:"cross-seed-card",shadow:"always"},{header:l(()=>[s("div",Ma,[s("span",null,"转种 - "+u(F.value?.name),1),n(m,{type:"danger",circle:"",onClick:st,plain:""},{default:l(()=>[...e[25]||(e[25]=[r("X",-1)])]),_:1})])]),default:l(()=>[F.value?(f(),g("div",Pa,[n(ys,{onComplete:Nt,onCancel:st,onCloseWithRefresh:Ut})])):b("",!0)]),_:1})])):b("",!0),ve.value?(f(),g("div",{key:4,class:"filter-overlay",onClick:e[12]||(e[12]=ue(a=>ve.value=!1,["self"]))},[n(j,{class:"filter-card"},{header:l(()=>[s("div",Oa,[e[27]||(e[27]=s("span",null,"筛选选项",-1)),n(m,{type:"danger",circle:"",onClick:e[5]||(e[5]=a=>ve.value=!1),plain:""},{default:l(()=>[...e[26]||(e[26]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",Aa,[n(Ie,{"content-position":"left"},{default:l(()=>[...e[28]||(e[28]=[r("站点筛选",-1)])]),_:1}),s("div",Fa,[s("div",ja,[n(Zt,{modelValue:Y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>Y.value=a),size:"default"},{default:l(()=>[n(dt,{label:"exist",class:"compact-radio-button"},{default:l(()=>[...e[29]||(e[29]=[r("存在于",-1)])]),_:1}),n(dt,{label:"not-exist",class:"compact-radio-button"},{default:l(()=>[...e[30]||(e[30]=[r("不存在于",-1)])]),_:1})]),_:1},8,["modelValue"]),n(w,{modelValue:xe.value,"onUpdate:modelValue":e[7]||(e[7]=a=>xe.value=a),placeholder:"搜索站点",clearable:"",style:{width:"280px","font-size":"14px"},size:"default"},null,8,["modelValue"]),s("div",Ya,[_.existSiteNames.length>0?(f(),g("div",Wa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("存在于: "+u(_.existSiteNames.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Pt},{default:l(()=>[...e[31]||(e[31]=[r("清除",-1)])]),_:1})])):b("",!0),_.notExistSiteNames.length>0?(f(),g("div",Ja,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("不存在于: "+u(_.notExistSiteNames.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Ot},{default:l(()=>[...e[32]||(e[32]=[r("清除",-1)])]),_:1})])):b("",!0)])]),s("div",qa,[n(Je,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=a=>T.value=a)},{default:l(()=>[(f(!0),g(ee,null,ce(Xe.value,a=>(f(),P(We,{key:a,label:a,disabled:!Ge(a),class:fe({"disabled-site":!Ge(a)})},{default:l(()=>[r(u(a),1)]),_:2},1032,["label","disabled","class"]))),128))]),_:1},8,["modelValue"])])]),n(Ie,{"content-position":"left"},{default:l(()=>[...e[33]||(e[33]=[r("下载器",-1)])]),_:1}),s("div",Ka,[_.downloaderIds.length>0?(f(),g("div",Ha,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("下载器: "+u(_.downloaderIds.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:jt},{default:l(()=>[...e[34]||(e[34]=[r("清除",-1)])]),_:1})])):b("",!0)]),n(Je,{modelValue:_.downloaderIds,"onUpdate:modelValue":e[9]||(e[9]=a=>_.downloaderIds=a)},{default:l(()=>[(f(!0),g(ee,null,ce($.value,a=>(f(),P(We,{key:a.id,label:a.id},{default:l(()=>[r(u(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),n(Ie,{"content-position":"left"},{default:l(()=>[...e[35]||(e[35]=[r("保存路径",-1)])]),_:1}),s("div",Xa,[_.paths.length>0?(f(),g("div",Ga,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("路径: "+u(_.paths.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:At},{default:l(()=>[...e[36]||(e[36]=[r("清除",-1)])]),_:1})])):b("",!0)]),s("div",Qa,[n(es,{ref_key:"pathTreeRef",ref:C,data:_e.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),n(Ie,{"content-position":"left"},{default:l(()=>[...e[37]||(e[37]=[r("状态",-1)])]),_:1}),s("div",Za,[_.states.length>0?(f(),g("div",el,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("状态: "+u(_.states.length),1)]),_:1}),n(m,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Ft},{default:l(()=>[...e[38]||(e[38]=[r("清除",-1)])]),_:1})])):b("",!0)]),n(Je,{modelValue:_.states,"onUpdate:modelValue":e[10]||(e[10]=a=>_.states=a)},{default:l(()=>[(f(!0),g(ee,null,ce(ze.value,a=>(f(),P(We,{key:a,label:a},{default:l(()=>[r(u(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),s("div",tl,[n(m,{onClick:Mt},{default:l(()=>[...e[39]||(e[39]=[r("清除筛选",-1)])]),_:1}),n(m,{onClick:e[11]||(e[11]=a=>ve.value=!1)},{default:l(()=>[...e[40]||(e[40]=[r("取消",-1)])]),_:1}),n(m,{type:"primary",onClick:Bt},{default:l(()=>[...e[41]||(e[41]=[r("确认",-1)])]),_:1})])]),_:1})])):b("",!0),ye.value?(f(),g("div",{key:5,class:"filter-overlay",onClick:e[16]||(e[16]=ue(a=>ye.value=!1,["self"]))},[n(j,{class:"filter-card",style:{"max-width":"500px"}},{header:l(()=>[s("div",sl,[e[43]||(e[43]=s("span",null,"站点操作",-1)),n(m,{type:"danger",circle:"",onClick:e[13]||(e[13]=a=>ye.value=!1),plain:""},{default:l(()=>[...e[42]||(e[42]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",al,[s("div",ll,[e[44]||(e[44]=s("p",{class:"label"},"种子名称:",-1)),s("p",nl,u(Se.value),1)]),s("p",null,"站点名称: "+u(V.value?.name),1),s("p",null,"当前状态: "+u(V.value?.data.state),1),V.value&&V.value.data&&Ce(V.value.data,V.value.name)?(f(),g("div",ol,[e[45]||(e[45]=s("p",{class:"label"},"详情页链接:",-1)),n(ts,{href:Fe(V.value.data,V.value.name),target:"_blank",type:"primary",underline:!1},{default:l(()=>[r(u(Fe(V.value.data,V.value.name)),1)]),_:1},8,["href"])])):(f(),g("div",il,[e[46]||(e[46]=s("p",{class:"label"},"添加详情页链接或种子ID:",-1)),n(w,{modelValue:re.value,"onUpdate:modelValue":e[14]||(e[14]=a=>re.value=a),placeholder:"请输入完整的详情页链接或种子ID",clearable:"",onKeyup:ps(lt,["enter"])},null,8,["modelValue"]),e[47]||(e[47]=s("p",{class:"input-hint"}," 支持输入完整链接（如：https://example.com/details.php?id=123）或仅输入数字ID（如：9999999996） ",-1))])),s("div",rl,[n(m,{onClick:e[15]||(e[15]=a=>ye.value=!1)},{default:l(()=>[...e[48]||(e[48]=[r("取消",-1)])]),_:1}),Ce(V.value?.data,V.value?.name)?b("",!0):(f(),P(m,{key:0,type:"success",onClick:lt,disabled:!re.value||re.value.trim()===""},{default:l(()=>[...e[49]||(e[49]=[r(" 添加链接 ",-1)])]),_:1},8,["disabled"])),Ce(V.value?.data,V.value?.name)?(f(),P(m,{key:1,type:"primary",onClick:zt},{default:l(()=>[...e[50]||(e[50]=[r(" 设为不存在 ",-1)])]),_:1})):b("",!0)])])]),_:1})])):b("",!0),oe.value?(f(),g("div",dl,[n(j,{class:"filter-card",style:{"max-width":"600px"}},{header:l(()=>[s("div",ul,[e[52]||(e[52]=s("span",null,"请选择转种的源站点",-1)),n(m,{type:"danger",circle:"",onClick:e[17]||(e[17]=a=>oe.value=!1),plain:""},{default:l(()=>[...e[51]||(e[51]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",cl,[s("p",fl,[n(i,{type:"success",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[53]||(e[53]=[r("可获取数据",-1)])]),_:1}),n(i,{type:"primary",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[54]||(e[54]=[r("点击尝试使用iyuu获取链接",-1)])]),_:1}),n(i,{type:"error",size:"large",style:{"margin-right":"5px",opacity:"0.5"}},{default:l(()=>[...e[55]||(e[55]=[r("缺少配置参数",-1)])]),_:1})]),pe.value.length>0?(f(),g("div",vl,[s("p",pl,"已缓存的站点 ("+u(pe.value.length)+")",1),s("div",gl,[(f(!0),g(ee,null,ce(ie.value.filter(a=>pe.value.includes(a.name)),a=>Ke((f(),P(i,{key:a.name,type:rt(a,ke(a.name)),class:fe([{"is-selectable":ke(a.name),"cached-site-tag":!0},"site-tag"]),onClick:S=>ke(a.name)&&tt(nt(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(u(a.name)+" ✓ ",1)]),_:2},1032,["type","class","onClick"])),[[qe,Te.value[a.name]]])),128))])])):b("",!0),ie.value.some(a=>!pe.value.includes(a.name))?(f(),g("div",ml,[e[56]||(e[56]=s("p",{class:"uncached-sites-label"},"未缓存的站点",-1)),s("div",_l,[(f(!0),g(ee,null,ce(ie.value.filter(a=>!pe.value.includes(a.name)),a=>Ke((f(),P(i,{key:a.name,type:rt(a,ke(a.name)),class:fe([{"is-selectable":ke(a.name)},"site-tag"]),style:_s(!a.has_cookie&&a.name!=="肉丝"||(a.name==="杜比"||a.name==="HDtime"||a.name==="肉丝")&&!a.has_passkey?"opacity: 0.5":""),size:"large",onClick:S=>ke(a.name)&&tt(nt(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(u(a.name),1)]),_:2},1032,["type","class","style","onClick"])),[[qe,Te.value[a.name]]])),128))])])):b("",!0)]),s("div",hl,[n(m,{type:"warning",onClick:ot,loading:x.value,plain:""},{default:l(()=>[...e[57]||(e[57]=[r(" IYUU查询 ",-1)])]),_:1},8,["loading"]),n(m,{type:"success",onClick:e[18]||(e[18]=a=>Ct(F.value)),plain:""},{default:l(()=>[...e[58]||(e[58]=[r("上盒",-1)])]),_:1}),n(m,{onClick:e[19]||(e[19]=a=>oe.value=!1)},{default:l(()=>[...e[59]||(e[59]=[r("取消",-1)])]),_:1})])]),_:1})])):b("",!0),n(ma,{onRefresh:It}),he.value?(f(),g("div",{key:7,class:"filter-overlay",onClick:ue(Oe,["self"])},[n(j,{class:"filter-card",style:{"max-width":"720px"}},{header:l(()=>[s("div",yl,[e[61]||(e[61]=s("span",null,"IYUU 批量查询进度",-1)),n(m,{type:"danger",circle:"",onClick:Oe,plain:""},{default:l(()=>[...e[60]||(e[60]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",wl,[n(ut,{column:2,border:"",size:"small"},{default:l(()=>[n(de,{label:"任务ID"},{default:l(()=>[r(u(N.value?.task_id||"-"),1)]),_:1}),n(de,{label:"状态"},{default:l(()=>[n(i,{type:N.value?.isRunning?"warning":N.value?.success?"success":"danger",size:"small"},{default:l(()=>[r(u(N.value?.isRunning?"进行中":N.value?.success?"已完成":"失败"),1)]),_:1},8,["type"])]),_:1}),n(de,{label:"总数"},{default:l(()=>[r(u(N.value?.total??0),1)]),_:1}),n(de,{label:"已处理"},{default:l(()=>[r(u(N.value?.processed??0),1)]),_:1}),n(de,{label:"开始时间"},{default:l(()=>[r(u(N.value?.created_at||"-"),1)]),_:1}),n(de,{label:"完成时间"},{default:l(()=>[r(u(N.value?.finished_at||"-"),1)]),_:1})]),_:1}),n(Ie,{"content-position":"left"},{default:l(()=>[...e[62]||(e[62]=[r("结果",-1)])]),_:1}),s("div",Sl,u(N.value?.message||"等待任务更新..."),1),N.value?.stats?(f(),P(ut,{key:0,column:3,border:"",size:"small"},{default:l(()=>[n(de,{label:"找到"},{default:l(()=>[r(u(N.value.stats.total_found??0),1)]),_:1}),n(de,{label:"新增"},{default:l(()=>[r(u(N.value.stats.new_records??0),1)]),_:1}),n(de,{label:"更新"},{default:l(()=>[r(u(N.value.stats.updated_records??0),1)]),_:1})]),_:1})):b("",!0)]),s("div",xl,[n(m,{type:"primary",onClick:Pe,plain:""},{default:l(()=>[...e[63]||(e[63]=[r("刷新",-1)])]),_:1}),n(m,{onClick:Oe},{default:l(()=>[...e[64]||(e[64]=[r("关闭",-1)])]),_:1})])]),_:1})])):b("",!0)])}}}),zl=gt(Cl,[["__scopeId","data-v-1fef61e2"]]);export{zl as default};
