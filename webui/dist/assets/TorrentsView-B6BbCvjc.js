import{C as mt,d as _t,p as M,r as p,c as m,j as b,b as n,e as I,w as l,h as s,x as _e,D as ns,t as u,G as os,H as is,I as rs,J as ds,K as us,F as ee,k as ue,i as r,n as ce,g as v,l as O,L as de,M as cs,m as gt,f as q,N as ft,s as vs,o as fs,O as ps,u as He,v as ms,P as _s,z as k,Q as gs,q as hs,B as ys}from"./index-BjUns_Ha.js";import{u as ws,C as Ss}from"./CrossSeedPanel-kOKAqKT1.js";const ht=mt("siteData",{state:()=>({dialogVisible:!1,currentTorrent:null,downloadersMap:new Map,allDownloaders:[]}),actions:{openDialog(U,P){this.currentTorrent=U,this.dialogVisible=!0,this.allDownloaders=P||[],this.downloadersMap.clear(),P&&P.forEach(A=>{this.downloadersMap.set(A.id,A.name)})},closeDialog(){this.dialogVisible=!1,this.currentTorrent=null,this.downloadersMap.clear(),this.allDownloaders=[]},setCurrentTorrent(U){this.currentTorrent=U},getDownloaderName(U){return this.downloadersMap.get(U)||"未知下载器"},getAllDownloaders(){return this.allDownloaders}}}),xs={key:0,class:"modal-overlay"},ks={class:"modal-header"},bs={key:0,class:"site-data-content"},Cs={class:"torrent-info"},$s={class:"torrent-name"},Is={class:"name-text"},Ds={class:"torrent-stats"},Ns={class:"stat-item stat-item--fixed"},zs={class:"stat-value"},Us={class:"stat-item stat-item--fixed"},Ts={class:"stat-value"},Es={class:"stat-item stat-item--path"},Vs=["title"],Ls={class:"stat-item stat-item--fixed"},Rs={class:"stat-value"},Bs={class:"stat-item stat-item--fixed"},Ms={class:"stat-value"},Ps={class:"content-area"},Os={class:"sites-container"},As={key:0,class:"sites-grid"},Fs=["onClick"],js={class:"site-tile"},Ys={class:"site-content"},Ws={class:"site-name-wrapper"},Js={class:"site-name-with-link"},qs={class:"site-name-text"},Ks={class:"seeders-info"},Hs={class:"right-panel"},Xs={class:"downloaders-section"},Gs={class:"downloaders-list"},Qs=["onClick"],Zs={class:"flow-section"},ea={class:"flow-cards"},ta={class:"flow-card"},sa={class:"card-content"},aa={key:0,class:"empty-state"},la={key:1,class:"site-info"},na={class:"site-name"},oa={class:"flow-card"},ia={class:"card-content"},ra={class:"downloader-info current"},da={class:"flow-card"},ua={class:"card-content"},ca={class:"progress-section"},va={class:"progress-bar-container"},fa={class:"progress-percentage"},pa={class:"progress-steps-info"},ma={key:0,class:"current-status"},_a={class:"modal-footer"},ga=_t({__name:"SiteDataViewer",props:{torrent:{}},emits:["refresh"],setup(U,{emit:P}){const A=P,D=ht(),te=M(()=>D.dialogVisible),f=M(()=>D.currentTorrent),E=p(null),N=p(null),K=M(()=>!f.value||!f.value.sites?[]:Object.entries(f.value.sites).map(([c,d])=>({siteName:c,...d})).sort((c,d)=>(d.seeders||0)-(c.seeders||0))),se=()=>{Q(),D.closeDialog()},H=c=>{if(c==null||c<=0)return"0 B";const d=["B","KB","MB","GB","TB","PB"],C=Math.floor(Math.log(c)/Math.log(1024));return`${(c/Math.pow(1024,C)).toFixed(2)} ${d[C]}`},X=c=>!!(c&&(c.startsWith("http")||/^\d+$/.test(c))),ge=c=>(c.startsWith("http"),c),Ce=c=>c.downloaderIds&&c.downloaderIds.length>0?c.downloaderIds.length===1?D.getDownloaderName(c.downloaderIds[0]):`${D.getDownloaderName(c.downloaderIds[0])} +${c.downloaderIds.length-1}`:c.downloaderId?D.getDownloaderName(c.downloaderId):"未知",F=c=>{E.value=c},T=c=>E.value===c,V=M(()=>{if(!E.value||!f.value||!f.value.sites)return null;const c=f.value.sites[E.value];return{siteName:E.value,seeders:c?.seeders||0,state:c?.state||"未知"}}),g=c=>{N.value=c},h=M(()=>D.getAllDownloaders()),W=M(()=>{if(!f.value)return null;const c=f.value.downloaderIds||[],d=f.value.downloaderId;return c.length>0?{id:c[0],name:D.getDownloaderName(c[0])}:d?{id:d,name:D.getDownloaderName(d)}:null}),L=p(0),ve=M(()=>{switch(L.value){case 0:return 0;case 1:return 33;case 2:return 66;case 3:return 100;default:return 0}}),G=M(()=>{if(L.value!==0&&L.value===3)return"success"}),J=c=>({"step-info--pending":L.value<c,"step-info--active":L.value===c,"step-info--completed":L.value>c}),Se=()=>{switch(L.value){case 1:return"正在暂停种子...";case 2:return"正在导出种子文件并添加...";case 3:return"转种完成！";default:return""}},Q=()=>{L.value=0},ze=async()=>{if(!E.value||!N.value||!f.value)return;const c=f.value.downloaderId||(f.value.downloaderIds&&f.value.downloaderIds.length>0?f.value.downloaderIds[0]:null);if(!c){alert("无法获取当前下载器信息");return}Q();try{L.value=1;const C=await(await fetch("/api/torrent/transfer/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:c,target_downloader_id:N.value,site_name:E.value,torrent_name:f.value.name,torrent_size:f.value.size,save_path:f.value.save_path})})).json();if(!C.success){if(C.suggestions&&C.suggestions.length>0){const ne=C.suggestions.map((x,ye)=>`${ye+1}. ${x.name}
   站点: ${x.sites}
   大小: ${(x.size/1073741824).toFixed(2)} GB
   路径: ${x.save_path}`).join(`

`);if(confirm(`准备转移失败: ${C.message}

找到 ${C.suggestion_count} 个相似的种子:

${ne}

是否要使用第一个相似种子继续转移？`)&&C.suggestions.length>0){const x=C.suggestions[0];f.value&&(f.value.sites={[x.sites]:f.value.sites[E.value]||{}}),await Ue(x)}else Q()}else alert(`准备转移失败: ${C.message}`),Q();return}console.log(`找到 ${C.found_count} 个匹配的种子`),L.value=2;const $=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:c,target_downloader_id:N.value,site_name:E.value,torrent_name:f.value.name,torrent_size:f.value.size,save_path:f.value.save_path})})).json();if(!$.success){alert(`转移失败: ${$.message}`),Q();return}L.value=3,console.log("转移完成:",$);const he=$.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${he}`),A("refresh")}catch(d){console.error("转移过程中发生错误:",d),alert(`转移过程中发生错误: ${d?.message||"未知错误"}`),Q()}},Ue=async c=>{if(!N.value||!f.value)return;const d=f.value.downloaderId||(f.value.downloaderIds&&f.value.downloaderIds.length>0?f.value.downloaderIds[0]:null);if(!d){alert("无法获取当前下载器信息"),Q();return}try{console.log("使用相似种子重试转移:",c),L.value=2;const B=await(await fetch("/api/torrent/transfer/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_downloader_id:d,target_downloader_id:N.value,site_name:c.sites,torrent_name:c.name,torrent_size:c.size,save_path:c.save_path})})).json();if(!B.success){alert(`转移失败: ${B.message}`),Q();return}L.value=3,console.log("转移完成:",B);const $=B.method==="torrent_file"?"种子文件":"未知方式";console.log(`转移方式: ${$}`),A("refresh")}catch(C){console.error("重试转移过程中发生错误:",C),alert(`重试转移过程中发生错误: ${C?.message||"未知错误"}`),Q()}};return(c,d)=>{const C=I("el-button"),B=I("el-icon"),$=I("el-link"),he=I("el-tag"),ne=I("el-progress"),oe=I("el-card");return te.value?(v(),m("div",xs,[n(oe,{class:"site-data-card",shadow:"always"},{header:l(()=>[s("div",ks,[s("span",null,"站点数据查看 - "+u(f.value?.name),1),n(C,{type:"danger",circle:"",onClick:se,plain:""},{default:l(()=>[...d[1]||(d[1]=[r("X",-1)])]),_:1})])]),default:l(()=>[f.value?(v(),m("div",bs,[s("div",Cs,[s("div",$s,[n(B,{class:"torrent-icon"},{default:l(()=>[n(_e(ns))]),_:1}),s("span",Is,u(f.value.name),1)]),s("div",Ds,[s("div",Ns,[n(B,{class:"stat-icon"},{default:l(()=>[n(_e(os))]),_:1}),d[2]||(d[2]=s("span",{class:"stat-label"},"大小",-1)),s("span",zs,u(H(f.value.size)),1)]),s("div",Us,[n(B,{class:"stat-icon"},{default:l(()=>[n(_e(is))]),_:1}),d[3]||(d[3]=s("span",{class:"stat-label"},"上传",-1)),s("span",Ts,u(f.value.total_uploaded_formatted||H(f.value.total_uploaded)),1)]),s("div",Es,[n(B,{class:"stat-icon"},{default:l(()=>[n(_e(rs))]),_:1}),d[4]||(d[4]=s("span",{class:"stat-label"},"路径",-1)),s("span",{class:"stat-value",title:f.value.save_path},u(f.value.save_path),9,Vs)]),s("div",Ls,[n(B,{class:"stat-icon"},{default:l(()=>[n(_e(ds))]),_:1}),d[5]||(d[5]=s("span",{class:"stat-label"},"下载器",-1)),s("span",Rs,u(Ce(f.value)),1)]),s("div",Bs,[n(B,{class:"stat-icon"},{default:l(()=>[n(_e(us))]),_:1}),d[6]||(d[6]=s("span",{class:"stat-label"},"可转种",-1)),s("span",Ms,u(f.value.target_sites_count||0)+"个",1)])])]),s("div",Ps,[s("div",Os,[K.value.length>0?(v(),m("div",As,[(v(!0),m(ee,null,ue(K.value,x=>(v(),m("div",{key:x.siteName,class:ce(["site-card",{"site-card--selected":T(x.siteName)}]),onClick:ye=>F(x.siteName)},[s("div",js,[s("div",Ys,[s("div",Ws,[s("div",Js,[s("span",qs,u(x.siteName),1),X(x.comment)?(v(),O($,{key:0,href:ge(x.comment),target:"_blank",underline:!1,class:"site-link-icon",onClick:d[0]||(d[0]=de(()=>{},["stop"]))},{default:l(()=>[n(B,{size:"10"},{default:l(()=>[n(_e(cs))]),_:1})]),_:1},8,["href"])):b("",!0)])]),s("div",Ks,[n(he,{type:x.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(u(x.seeders||0)+"人做种 ",1)]),_:2},1032,["type"])])])])],10,Fs))),128))])):b("",!0)]),s("div",Hs,[s("div",Xs,[d[7]||(d[7]=s("div",{class:"section-title"},"下载器",-1)),s("div",Gs,[(v(!0),m(ee,null,ue(h.value,x=>(v(),m("div",{key:x.id,class:ce(["downloader-item",{"downloader-item--selected":N.value===x.id}]),onClick:ye=>g(x.id)},u(x.name),11,Qs))),128))])]),s("div",Zs,[s("div",ea,[s("div",ta,[d[8]||(d[8]=s("div",{class:"card-title"},"选中站点",-1)),s("div",sa,[V.value?(v(),m("div",la,[s("div",na,u(V.value.siteName),1),n(he,{type:V.value.seeders>0?"warning":"info",size:"small"},{default:l(()=>[r(u(V.value.seeders)+"人做种 ",1)]),_:1},8,["type"])])):(v(),m("div",aa,"未选择"))])]),d[11]||(d[11]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",oa,[d[9]||(d[9]=s("div",{class:"card-title"},"当前下载器",-1)),s("div",ia,[s("div",ra,u(W.value?.name||"未知"),1)])]),d[12]||(d[12]=s("div",{class:"flow-divider"},[s("span",null,"→")],-1)),s("div",da,[d[10]||(d[10]=s("div",{class:"card-title"},"目标下载器",-1)),s("div",ua,[s("div",{class:ce(["downloader-info target",{selected:N.value}])},u(N.value?_e(D).getDownloaderName(N.value):"未选择"),3)])])])]),s("div",ca,[d[16]||(d[16]=s("div",{class:"progress-title"},"转种流程",-1)),s("div",va,[n(ne,{percentage:ve.value,status:G.value,"stroke-width":8,"show-text":!0},{default:l(({percentage:x})=>[s("span",fa,u(x)+"%",1)]),_:1},8,["percentage","status"]),s("div",pa,[s("div",{class:ce(["step-info",J(1)])},[...d[13]||(d[13]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"暂停种子"),s("div",{class:"step-desc"},"暂停下载器中选择的站点种子")],-1)])],2),s("div",{class:ce(["step-info",J(2)])},[...d[14]||(d[14]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"导出种子"),s("div",{class:"step-desc"},"导出种子文件并添加到目标下载器")],-1)])],2),s("div",{class:ce(["step-info",J(3)])},[...d[15]||(d[15]=[s("div",{class:"step-indicator"},null,-1),s("div",{class:"step-details"},[s("div",{class:"step-name"},"转移完成"),s("div",{class:"step-desc"},"种子已成功转移到目标下载器")],-1)])],2)]),L.value>0&&L.value<=3?(v(),m("div",ma,u(Se()),1)):b("",!0)])])])])])):b("",!0),s("div",_a,[n(C,{type:"success",onClick:ze,disabled:!E.value||!N.value||L.value>0},{default:l(()=>[...d[17]||(d[17]=[r(" 执行转种 ",-1)])]),_:1},8,["disabled"]),n(C,{type:"primary",onClick:se},{default:l(()=>[...d[18]||(d[18]=[r("关闭",-1)])]),_:1})])]),_:1})])):b("",!0)}}}),ha=gt(ga,[["__scopeId","data-v-6ee24ce4"]]),ya=U=>({page_size:U.page_size,sort_prop:U.sort_prop,sort_order:U.sort_order,name_search:U.name_search,active_filters:{paths:[...U.active_filters?.paths||[]],states:[...U.active_filters?.states||[]],existSiteNames:[...U.active_filters?.existSiteNames||[]],notExistSiteNames:[...U.active_filters?.notExistSiteNames||[]],downloaderIds:[...U.active_filters?.downloaderIds||[]]}}),wa=mt("torrentsViewState",()=>{const U=p(!1),P=p(null),A=p([]),D=p([]),te=p([]),f=p(!1),E=p(!1),N=p(!1),K=()=>{U.value=!0},se=F=>{P.value=ya(F),f.value=!0},H=async(F=!1)=>{if(!F&&f.value&&P.value)return P.value;try{const T=await q.get("/api/ui_settings");return P.value=T.data,f.value=!0,P.value}catch(T){return console.error("加载UI设置时出错:",T),f.value=!0,P.value||{}}},X=async(F=!1)=>{if(!F&&E.value)return{downloadersList:A.value,allDownloadersList:D.value};try{const V=(await q.get("/api/all_downloaders")).data;return A.value=V.filter(g=>g.enabled),D.value=V,E.value=!0,{downloadersList:A.value,allDownloadersList:D.value}}catch(T){return console.error("获取下载器列表时出错:",T),E.value=!0,{downloadersList:A.value,allDownloadersList:D.value}}},ge=async(F=!1)=>{if(!F&&N.value)return te.value;try{const V=(await q.get("/api/sites/status")).data;return te.value=V.filter(g=>g.is_source),N.value=!0,te.value}catch(T){return console.error("获取站点状态时出错:",T),N.value=!0,te.value}};return{hasInitializedOnce:U,cachedUiSettings:P,cachedDownloadersList:A,cachedAllDownloadersList:D,cachedAllSourceSitesStatus:te,isUiSettingsLoaded:f,isDownloadersLoaded:E,isSitesStatusLoaded:N,setInitialized:K,updateCachedUiSettings:se,fetchUiSettings:H,fetchDownloadersList:X,fetchSitesStatus:ge,refreshAllCachedData:async()=>{await Promise.all([H(!0),X(!0),ge(!0)])}}}),Sa={class:"torrents-view"},xa={class:"expand-content"},ka=["onClick"],ba=["href"],Ca=["onClick"],$a={class:"name-header-container"},Ia={key:0,class:"current-filters",style:{"margin-right":"15px",display:"flex","align-items":"center"}},Da={style:{"white-space":"normal"}},Na={style:{display:"inline-block",width:"100%","text-align":"center"}},za=["title"],Ua={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ta={key:0},Ea={style:{padding:"1px 0",width:"100%"}},Va={style:{"text-align":"center","font-size":"12px","margin-top":"5px","line-height":"1"}},La={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ra={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Ba={key:0},Ma={key:1},Pa={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Oa={key:3,class:"modal-overlay"},Aa={class:"modal-header"},Fa={key:0,class:"cross-seed-content"},ja={class:"filter-card-header"},Ya={class:"filter-card-body"},Wa={class:"site-filter-container"},Ja={style:{display:"flex","align-items":"center",gap:"15px","margin-bottom":"5px"}},qa={style:{display:"flex","align-items":"center",gap:"10px"}},Ka={key:0,style:{display:"flex","align-items":"center"}},Ha={key:1,style:{display:"flex","align-items":"center"}},Xa={class:"site-checkbox-container"},Ga={style:{"margin-bottom":"10px"}},Qa={key:0,style:{display:"flex","align-items":"center"}},Za={style:{"margin-bottom":"10px"}},el={key:0,style:{display:"flex","align-items":"center"}},tl={class:"path-tree-container"},sl={style:{"margin-bottom":"10px"}},al={key:0,style:{display:"flex","align-items":"center"}},ll={class:"filter-card-footer"},nl={class:"filter-card-header"},ol={class:"site-operation-body"},il={class:"torrent-name-container"},rl={class:"torrent-name"},dl={key:0,class:"site-operation-link"},ul={key:1,class:"site-operation-input"},cl={class:"site-operation-buttons"},vl={key:6,class:"filter-overlay"},fl={class:"filter-card-header"},pl={class:"source-site-selection-body"},ml={class:"source-site-tip"},_l={key:0,class:"cached-sites-section"},gl={class:"cached-sites-label"},hl={class:"site-list-box glass-site-box cached-sites-box"},yl={key:1,class:"uncached-sites-section"},wl={class:"site-list-box glass-site-box"},Sl={class:"filter-card-footer"},xl={class:"filter-card-header"},kl={class:"filter-card-body"},bl={style:{color:"#606266","margin-bottom":"10px"}},Cl={class:"filter-card-footer"},$l=220,Il=90,pt=30,Ne=200,Dl=2e3,Nl=_t({__name:"TorrentsView",emits:["ready"],setup(U,{emit:P}){const A=P,D=wa(),te=p(null),f=p(!0),E=p(!1),N=p([]),K=p(null),se=t=>{window.dispatchEvent(new CustomEvent("app-global-refresh-loading",{detail:{refreshing:t}}))},H=async()=>{if(!E.value){E.value=!0,f.value=!0,se(!0);try{await q.post("/api/refresh_data")}catch(t){console.warn("种子数据刷新失败:",t)}try{await Promise.all([tt(!0),st(!0)]),await Pe()}finally{f.value=!1,se(!1),E.value=!1}}},X=async()=>{f.value=!0,await Ve()},ge=p(!1),Ce=p(!1),F=p(!0),T=p(""),V=p({prop:"name",order:"ascending"}),g=ft({paths:[],states:[],existSiteNames:[],notExistSiteNames:[],downloaderIds:[]}),h=ft({...g}),W=p("exist"),L=M({get:()=>W.value==="exist"?h.existSiteNames:h.notExistSiteNames,set:t=>{W.value==="exist"?h.existSiteNames=t:h.notExistSiteNames=t}}),ve=p(!1),G=p(1),J=p(50),Se=p(0),Q=p([]),ze=p([]),Ue=p([]),c=p({}),d=p([]),C=p([]),B=p([]),$=p(null),he=p([]),ne=p(!1),oe=p([]),x=p(!1),ye=p(!1),Re=p(null),z=p(null),Te=p(null),Be=p(!1),fe=p([]),Xe=p(!1),Z=ws(),yt=ht(),wt=M(()=>!!Z.taskId),j=M(()=>Z.workingParams);M(()=>Z.sourceInfo?.name||"");const we=p(!1),xe=p(""),R=p(null),ie=p(""),Ee=p({}),Me=M(()=>{const t=new Intl.Collator("zh-CN",{numeric:!0});return[...Ue.value].sort(t.compare)}),ke=p(""),Ge=M(()=>{if(!ke.value)return Me.value;const t=ke.value.toLowerCase();return Me.value.filter(e=>e.toLowerCase().includes(t))}),St=t=>{let e=0;for(const o of t)e+=o.charCodeAt(0)>255?14:8;return e},xt=M(()=>{const t=N.value||[];let e=0;for(const i of t){const y=String(i?.save_path||""),w=dt(y,pt)||"";e=Math.max(e,St(w))}const o=e+40;return Math.min($l,Math.max(Il,Math.round(o)))}),kt=M(()=>{const t=g,e=[];return t.paths&&t.paths.length>0&&e.push(`路径: ${t.paths.length}`),t.states&&t.states.length>0&&e.push(`状态: ${t.states.length}`),t.existSiteNames&&t.existSiteNames.length>0&&e.push(`存在于: ${t.existSiteNames.length}`),t.notExistSiteNames&&t.notExistSiteNames.length>0&&e.push(`不存在于: ${t.notExistSiteNames.length}`),t.downloaderIds&&t.downloaderIds.length>0&&e.push(`下载器: ${t.downloaderIds.length}`),e.join(", ")}),bt=M(()=>{const t=g;return t.paths&&t.paths.length>0||t.states&&t.states.length>0||t.existSiteNames&&t.existSiteNames.length>0||t.notExistSiteNames&&t.notExistSiteNames.length>0||t.downloaderIds&&t.downloaderIds.length>0});M(()=>{const t=Ge.value;return W.value==="exist"?t.filter(e=>!h.notExistSiteNames.includes(e)):t.filter(e=>!h.existSiteNames.includes(e))});const Qe=t=>W.value==="exist"?!h.notExistSiteNames.includes(t):!h.existSiteNames.includes(t),Ct=[{color:"#f56c6c",percentage:80},{color:"#e6a23c",percentage:99},{color:"#67c23a",percentage:100}],Ze=()=>({page_size:J.value,sort_prop:V.value.prop,sort_order:V.value.order,name_search:T.value,active_filters:{paths:[...g.paths],states:[...g.states],existSiteNames:[...g.existSiteNames],notExistSiteNames:[...g.notExistSiteNames],downloaderIds:[...g.downloaderIds]}}),pe=()=>{D.updateCachedUiSettings(Ze())},$e=async()=>{try{const t=Ze();pe(),await q.post("/api/ui_settings",t)}catch(t){console.error("无法保存UI设置:",t.message)}},et=async(t=!1)=>{try{const e=await D.fetchUiSettings(t);if(J.value=e.page_size??50,V.value={prop:e.sort_prop||"name",order:"sort_order"in e?e.sort_order:"ascending"},T.value=e.name_search??"",e.active_filters){Object.assign(g,e.active_filters),g.existSiteNames||(g.existSiteNames=[]),g.notExistSiteNames||(g.notExistSiteNames=[]);const o=g;o.siteExistence&&delete o.siteExistence,o.siteNames&&delete o.siteNames}pe()}catch(e){console.error("加载UI设置时出错:",e)}finally{ge.value=!0}},$t=t=>{const e=[],o=new Map;return t.sort().forEach(i=>{const y=i.replace(/^\/|\/$/g,"").split("/");let w="",_=e;y.forEach((me,ae)=>{if(w=ae===0?`/${me}`:`${w}/${me}`,!o.has(w)){const Y={path:ae===y.length-1?i:w,label:me,children:[]};o.set(w,Y),_.push(Y)}_=o.get(w).children})}),o.forEach(i=>{i.children&&i.children.length===0&&delete i.children}),e},tt=async(t=!1)=>{try{const e=await D.fetchDownloadersList(t);C.value=e.downloadersList,B.value=e.allDownloadersList}catch(e){K.value=e.message}},st=async(t=!1)=>{try{oe.value=await D.fetchSitesStatus(t)}catch(e){K.value=e.message}},Pe=async()=>{K.value=null;try{const t=new URLSearchParams({page:G.value.toString(),pageSize:J.value.toString(),nameSearch:T.value,sortProp:V.value.prop||"name",sortOrder:V.value.order||"ascending",existSiteNames:JSON.stringify(g.existSiteNames),notExistSiteNames:JSON.stringify(g.notExistSiteNames),path_filters:JSON.stringify(g.paths||[]),state_filters:JSON.stringify(g.states),downloader_filters:JSON.stringify(g.downloaderIds)}),o=(await q.get(`/api/data?${t.toString()}`)).data;if(o.error)throw new Error(o.error);N.value=o.data,Se.value=o.total,J.value!==o.pageSize&&(J.value=o.pageSize),Q.value=o.unique_paths,ze.value=o.unique_states,Ue.value=o.all_discovered_sites,c.value=o.site_link_rules,g.paths=o.active_path_filters,he.value=$t(o.unique_paths)}catch(t){K.value=t.message}},Ve=async()=>{f.value=!0;try{await Pe()}finally{f.value=!1}},It=async t=>{Z.reset();const e=Object.entries(t.sites).map(([o,i])=>({siteName:o,...i})).filter(o=>{if(!(o.migration===1||o.migration===3))return!1;const y=o.comment&&o.comment.includes("details.php?id="),w=o.comment&&/^\d+$/.test(o.comment.trim());return y||w});Z.setParams(t),await zt(t),e.length===0&&k.warning("该种子暂无可用的源站点，您可以使用 IYUU 查询来发现更多站点。"),ne.value=!0},Dt=t=>{yt.openDialog(t,B.value)},Nt=async()=>{console.log("触发种子数据刷新"),await H()},zt=async t=>{Xe.value=!0,fe.value=[];try{const o=(await q.get(`/api/cached_sites?name=${encodeURIComponent(t.name)}&size=${t.size}`)).data;o.success?(fe.value=o.cached_sites||[],console.log("缓存站点查询结果:",fe.value)):console.warn("查询缓存站点失败:",o.error)}catch(e){console.error("查询缓存站点时出错:",e)}finally{Xe.value=!1}},at=async t=>{const e=j.value;if(!e||!t){k.error("发生内部错误：未找到选中的种子或站点信息。");return}const o=e.sites[t.siteName],i=t.siteName;if(!o){k.error(`未找到站点 [${i}] 的数据。`);return}if(!Ie(o,i)){k.info(`站点 [${i}] 缺少详情链接，正在触发 IYUU 查询...`),Ee.value[i]=!0,await rt(),Ee.value[i]=!1;return}let y=null;const w=o?.comment?.match(/id=(\d+)/);if(w&&w[1])y=w[1];else if(o?.comment&&/^\d+$/.test(o.comment.trim()))y=o.comment.trim();else{k.error(`无法从源站点 ${i} 的详情页链接中提取种子ID。请尝试使用IYUU查询更新链接。`);return}o&&(o.torrentId=y);const _=oe.value.find(ae=>ae.name===i)?.site||i.toLowerCase();k.success(`准备从站点 [${i}] 开始迁移种子...`);const me={name:i,site:_,torrentId:y};Z.setSourceInfo(me),Z.setTaskId(e.name+"_"+Date.now()),ne.value=!1},be=t=>{if(!!!(j.value&&j.value.sites[t]))return!1;const o=oe.value.find(i=>i.name===t);return!o||!o.has_cookie&&t!=="肉丝"?!1:t==="杜比"||t==="HDtime"||t==="肉丝"?!!o.has_passkey:!0},lt=()=>{Z.reset()},nt=(t,e)=>{xe.value=t,R.value=e,ie.value="",we.value=!0},ot=async()=>{if(!xe.value||!R.value){k.error("缺少必要的参数");return}if(!ie.value||ie.value.trim()===""){k.error("请输入详情页链接或ID");return}try{const e=(await q.post("/api/sites/update_comment",{torrent_name:xe.value,site_name:R.value.name,comment:ie.value.trim()})).data;e.success?(k.success("详情页链接已成功添加"),we.value=!1,ie.value="",await Ve()):k.error(e.error||"添加详情页链接失败")}catch(t){console.error("添加详情页链接时出错:",t),k.error("添加详情页链接时发生网络错误")}},Ut=async()=>{if(!xe.value||!R.value){k.error("缺少必要的参数");return}try{const t=await q.post("/api/sites/set_not_exist",{torrent_name:xe.value,site_name:R.value.name});k.success("站点状态已成功设置为不存在"),we.value=!1,Ve()}catch(t){console.error("设置站点状态时出错:",t),k.error(t.response?.data?.error||"设置站点状态时发生错误")}},Tt=async()=>{k.success("转种操作已完成！"),Z.reset(),await H()},Et=async()=>{k.success("转种操作已完成！"),Z.reset(),await H()},it=t=>{if(!j.value)return null;const e=j.value.sites[t];return e?{siteName:t,...e}:null},Le=()=>{Te.value&&(clearInterval(Te.value),Te.value=null)},Oe=async()=>{if(Re.value)try{const t=await q.get(`/api/iyuu_query_batch_progress?task_id=${encodeURIComponent(Re.value)}`);if(t.data?.success){if(z.value=t.data.task,z.value&&!z.value.isRunning&&(Le(),!Be.value))if(Be.value=!0,z.value.success){k.success(z.value.message||"IYUU批量查询已完成"),await Ve();const e=j.value;if(e){const o=N.value.find(i=>i.name===e.name&&i.size===e.size);o&&Z.setParams(o)}}else k.error(z.value.message||"IYUU批量查询失败")}else k.error(t.data?.message||"获取IYUU批量查询进度失败")}catch(t){k.error(t.response?.data?.message||"获取IYUU批量查询进度时发生网络错误")}},Vt=()=>{Le(),Oe(),Te.value=setInterval(async()=>{await Oe()},Dl)},Ae=()=>{ye.value=!1,Le()},rt=async()=>{const t=j.value,e=Se.value||0;if(e<=0){k.warning("当前筛选条件下无可查询的种子");return}const o=Math.min(e,Ne);try{await gs.confirm(`将对当前筛选结果的前 ${o} 个种子组执行 IYUU 查询（当前筛选共 ${e} 个）。继续？`,"IYUU 批量查询",{confirmButtonText:"开始查询",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1})}catch{return}x.value=!0;try{const i=new URLSearchParams({page:"1",pageSize:o.toString(),nameSearch:T.value,sortProp:V.value.prop||"name",sortOrder:V.value.order||"ascending",existSiteNames:JSON.stringify(g.existSiteNames),notExistSiteNames:JSON.stringify(g.notExistSiteNames),path_filters:JSON.stringify(g.paths||[]),state_filters:JSON.stringify(g.states),downloader_filters:JSON.stringify(g.downloaderIds)}),w=(await q.get(`/api/data?${i.toString()}`)).data;if(w.error)throw new Error(w.error);const _=(w.data||[]).slice(0,Ne).map(le=>({name:le.name,size:le.size,save_path:le.save_path})).filter(le=>le.name&&le.size);if(t&&t.name&&t.size&&!_.some(Y=>Y.name===t.name&&Y.size===t.size)){const Y={name:t.name,size:t.size,save_path:t.save_path};_.length>=Ne&&_.pop(),_.unshift(Y)}if(_.length===0){k.warning("当前筛选结果中未找到可查询的种子组");return}(w.total||0)>Ne&&k.info(`筛选结果共 ${w.total} 个，本次仅查询前 ${_.length} 个`);const ae=(await q.post("/api/iyuu_query_batch",{torrents:_,max_groups:Ne,force_query:!0})).data;if(!ae?.success){k.error(ae?.message||"启动批量IYUU查询失败");return}Re.value=ae.task_id,z.value=null,Be.value=!1,ye.value=!0,Vt()}catch(i){console.error("触发筛选结果 IYUU 批量查询时出错:",i),k.error(i.response?.data?.message||i.message||"触发IYUU批量查询失败")}finally{x.value=!1}};vs(()=>{Le(),se(!1)});const Lt=t=>{J.value=t,G.value=1,pe(),X(),$e()},Rt=t=>{G.value=t,pe(),X()},Bt=t=>{V.value=t,G.value=1,pe(),X(),$e()},Mt=()=>{Object.assign(h,g),ve.value=!0,hs(()=>{$.value&&$.value.setCheckedKeys(g.paths,!1)})},Pt=async()=>{if($.value){const t=$.value.getCheckedKeys(!1);h.paths=t}Object.assign(g,h),ve.value=!1,G.value=1,pe(),await X(),$e()},Ot=()=>{h.paths=[],h.states=[],h.existSiteNames=[],h.notExistSiteNames=[],h.downloaderIds=[],W.value="exist",ke.value="",$.value&&$.value.setCheckedKeys([],!1)},At=()=>{if(h.existSiteNames=[],W.value==="exist"&&$.value){const t=$.value.getCheckedKeys(!0);h.paths=t}},Ft=()=>{if(h.notExistSiteNames=[],W.value==="not-exist"&&$.value){const t=$.value.getCheckedKeys(!0);h.paths=t}},jt=()=>{h.paths=[],$.value&&$.value.setCheckedKeys([],!1)},Yt=()=>{h.states=[]},Wt=()=>{h.downloaderIds=[]},Jt=async()=>{g.paths=[],g.states=[],g.existSiteNames=[],g.notExistSiteNames=[],g.downloaderIds=[],T.value="",W.value="exist",ke.value="",$.value&&$.value.setCheckedKeys([],!1),G.value=1,pe(),await X(),$e()},Fe=t=>{if(t==null||t<=0)return"0 B";const e=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(t)/Math.log(1024));return`${(t/Math.pow(1024,o)).toFixed(2)} ${e[o]}`},Ie=(t,e)=>{const{comment:o}=t;return!!(o&&(o.startsWith("http")||/^\d+$/.test(o)&&c.value[e]))},je=(t,e)=>{const{comment:o}=t;if(o.startsWith("http"))return o;const i=c.value[e];return i&&/^\d+$/.test(o)?`${(i.base_url.startsWith("http")?i.base_url:`https://${i.base_url}`).replace(/\/$/,"")}/details.php?id=${o}`:null},Ye=t=>t.state==="未做种"?"danger":t.state==="不存在"?"info":t.comment?"success":t.state==="做种中"?"primary":"info",We=t=>{if(!t)return"未知下载器";const e=B.value.find(o=>o.id===t);return e?e.name:"未知下载器"},qt=t=>{if(!t||!B.value.find(y=>y.id===t))return"info";let o=0;for(let y=0;y<t.length;y++)o=t.charCodeAt(y)+((o<<5)-o);const i=["primary","success","warning","danger","info"];return i[Math.abs(o)%i.length]},Kt=t=>[...t].sort((o,i)=>{const y=We(o),w=We(i);return y.localeCompare(w,"zh-CN")}),dt=(t,e=50)=>{if(!t||t.length<=e)return t;const o=Math.floor((e-3)/2);let i=t.substring(0,o),y=t.substring(t.length-o);const w=i.lastIndexOf("/"),_=y.indexOf("/");return w>0&&_>=0&&(i=i.substring(0,w),y=y.substring(_+1)),`${i}...${y}`},ut=(t,e)=>{if(!!!(j.value&&j.value.sites[t.name]))return"info";const i=j.value.sites[t.name];return!t.has_cookie||(t.name==="杜比"||t.name==="肉丝")&&!t.has_passkey?"error":t.has_cookie&&i.comment?"success":"primary"},Ht=t=>t.state==="做种中"&&t.progress<100?"部分做种":t.state,Xt=(t,e)=>e&&e.state==="做种中"&&e.progress<100?"warning":t.includes("下载")?"primary":t.includes("做种")?"success":t.includes("暂停")?"warning":t.includes("错误")||t.includes("丢失")?"danger":"info",Gt=t=>te.value?.toggleRowExpansion(t),Qt=(t,e)=>{d.value=e.map(o=>o.unique_id)},Zt=({row:t})=>d.value.includes(t.unique_id)?"expanded-row":"";fs(async()=>{F.value=!0,f.value=!0,se(!0),D.hasInitializedOnce?(await et(!1),await Promise.all([tt(!1),st(!1)]),await Pe(),f.value=!1,se(!1)):(await et(!0),await H(),D.setInitialized()),A("ready",H),es(),F.value=!1});const es=()=>{Ce.value=!1};return ps(T,()=>{F.value||(G.value=1,pe(),X(),$e())}),(t,e)=>{const o=I("el-alert"),i=I("el-tag"),y=I("el-table-column"),w=I("el-input"),_=I("el-button"),me=I("el-progress"),ae=I("el-table"),le=I("el-pagination"),Y=I("el-card"),De=I("el-divider"),ct=I("el-radio-button"),ts=I("el-radio-group"),Je=I("el-checkbox"),qe=I("el-checkbox-group"),ss=I("el-tree"),as=I("el-link"),re=I("el-descriptions-item"),vt=I("el-descriptions"),Ke=ms("loading");return v(),m("div",Sa,[K.value?(v(),O(o,{key:0,title:K.value,type:"error","show-icon":"",closable:!1,center:"",style:{"margin-bottom":"15px"}},null,8,["title"])):b("",!0),ge.value?He((v(),O(ae,{key:1,data:N.value,"element-loading-text":"正在刷新种子数据...",border:"",height:"100%",ref_key:"tableRef",ref:te,"row-key":"unique_id","row-class-name":Zt,onRowClick:Gt,onExpandChange:Qt,onSortChange:Bt,"default-sort":V.value,"empty-text":"无数据或当前筛选条件下无结果",class:"glass-table"},{default:l(()=>[n(y,{type:"expand",width:"1"},{default:l(a=>[s("div",xa,[(v(!0),m(ee,null,ue(Me.value,S=>(v(),m(ee,{key:S},[a.row.sites[S]?(v(),m(ee,{key:0},[a.row.sites[S].state==="未做种"?(v(),m("div",{key:0,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:de(ls=>nt(a.row.name,{name:S,data:a.row.sites[S]}),["stop"])},[n(i,{effect:"dark",type:Ye(a.row.sites[S]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(u(S)+" ",1),s("div",null,"("+u(Fe(a.row.sites[S].uploaded))+")",1)]),_:2},1032,["type"])],8,ka)):a.row.sites[S]&&Ie(a.row.sites[S],S)?(v(),m("a",{key:1,href:je(a.row.sites[S],S),target:"_blank",style:{"text-decoration":"none"}},[n(i,{effect:"dark",type:Ye(a.row.sites[S]),style:{"text-align":"center"}},{default:l(()=>[r(u(S)+" ",1),s("div",null,"("+u(Fe(a.row.sites[S].uploaded))+")",1)]),_:2},1032,["type"])],8,ba)):(v(),m("div",{key:2,style:{cursor:"pointer",display:"inline-block",width:"100%","text-align":"center"},onClick:de(ls=>nt(a.row.name,{name:S,data:a.row.sites[S]}),["stop"])},[n(i,{effect:"dark",type:Ye(a.row.sites[S]),style:{"text-align":"center",width:"100%"}},{default:l(()=>[r(u(S)+" ",1),s("div",null,"("+u(Fe(a.row.sites[S].uploaded))+")",1)]),_:2},1032,["type"])],8,Ca))],64)):(v(),O(i,{key:1,type:"info",effect:"plain"},{default:l(()=>[r(u(S),1)]),_:2},1024))],64))),128))])]),_:1}),n(y,{prop:"name","min-width":"450",sortable:"custom"},{header:l(()=>[s("div",$a,[e[22]||(e[22]=s("div",null,"种子",-1)),n(w,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=a=>T.value=a),placeholder:"搜索名称...",clearable:"",class:"search-input",onClick:e[1]||(e[1]=de(()=>{},["stop"]))},null,8,["modelValue"]),s("span",{onClick:e[2]||(e[2]=de(()=>{},["stop"])),style:{display:"flex","align-items":"center"}},[bt.value?(v(),m("div",Ia,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r(u(kt.value),1)]),_:1}),n(_,{type:"danger",link:"",style:{padding:"0","margin-left":"8px"},onClick:Jt},{default:l(()=>[...e[20]||(e[20]=[r("清除",-1)])]),_:1})])):b("",!0),n(_,{type:"primary",onClick:Mt,plain:""},{default:l(()=>[...e[21]||(e[21]=[r("筛选",-1)])]),_:1})])])]),default:l(a=>[s("span",Da,u(a.row.name),1)]),_:1}),n(y,{prop:"site_count",label:"做种数",sortable:"custom",width:"95",align:"center","header-align":"center"},{default:l(a=>[s("span",Na,u(a.row.site_count)+" / "+u(a.row.total_site_count),1)]),_:1}),n(y,{prop:"save_path",label:"保存路径",width:xt.value,"header-align":"center"},{default:l(a=>[s("div",{title:a.row.save_path,style:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},u(dt(a.row.save_path,pt)),9,za)]),_:1},8,["width"]),n(y,{label:"下载器",width:"130",align:"center","header-align":"center"},{default:l(a=>[s("div",Ua,[a.row.downloaderIds&&a.row.downloaderIds.length>0?(v(),m("div",Ta,[(v(!0),m(ee,null,ue(Kt(a.row.downloaderIds),S=>(v(),O(i,{key:S,size:"small",type:qt(S),style:{margin:"2px"}},{default:l(()=>[r(u(We(S)),1)]),_:2},1032,["type"]))),128))])):(v(),O(i,{key:1,type:"info",size:"small"},{default:l(()=>[...e[23]||(e[23]=[r(" 未知下载器 ",-1)])]),_:1}))])]),_:1}),n(y,{label:"大小",prop:"size_formatted",width:"100",align:"center",sortable:"custom"}),n(y,{label:"总上传量",prop:"total_uploaded_formatted",width:"110",align:"center",sortable:"custom"}),n(y,{label:"进度",prop:"progress",width:"90",align:"center",sortable:"custom"},{default:l(a=>[s("div",Ea,[n(me,{percentage:a.row.progress,"stroke-width":10,color:Ct,"show-text":!1,style:{width:"100%"}},null,8,["percentage"]),s("div",Va,u(a.row.progress)+"% ",1)])]),_:1}),n(y,{label:"状态",prop:"state",width:"120",align:"center","header-align":"center"},{default:l(a=>[s("div",La,[n(i,{type:Xt(a.row.state,a.row),size:"large"},{default:l(()=>[r(u(Ht(a.row)),1)]),_:2},1032,["type"])])]),_:1}),n(y,{label:"可转种",width:"100",align:"center","header-align":"center",prop:"target_sites_count",sortable:"custom"},{default:l(a=>[s("div",Ra,[a.row.target_sites_count!==void 0?(v(),m("span",Ba,u(a.row.target_sites_count),1)):(v(),m("span",Ma,"-"))])]),_:1}),n(y,{label:"操作",width:"100",align:"center","header-align":"center"},{default:l(a=>[s("div",Pa,[n(_,{type:"primary",size:"small",onClick:de(S=>It(a.row),["stop"]),disabled:!Ce.value&&a.row.progress<100},{default:l(()=>[...e[24]||(e[24]=[r(" 转种 ",-1)])]),_:1},8,["onClick","disabled"])])]),_:1})]),_:1},8,["data","default-sort"])),[[Ke,f.value]]):b("",!0),Se.value>0?(v(),O(le,{key:2,class:"glass-pagination",style:{"justify-content":"flex-end"},"current-page":G.value,"onUpdate:currentPage":e[3]||(e[3]=a=>G.value=a),"page-size":J.value,"onUpdate:pageSize":e[4]||(e[4]=a=>J.value=a),"page-sizes":[20,50,100],total:Se.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Lt,onCurrentChange:Rt,background:""},null,8,["current-page","page-size","total"])):b("",!0),wt.value?(v(),m("div",Oa,[n(Y,{class:"cross-seed-card",shadow:"always"},{header:l(()=>[s("div",Aa,[s("span",null,"转种 - "+u(j.value?.name),1),n(_,{type:"danger",circle:"",onClick:lt,plain:""},{default:l(()=>[...e[25]||(e[25]=[r("X",-1)])]),_:1})])]),default:l(()=>[j.value?(v(),m("div",Fa,[n(Ss,{onComplete:Tt,onCancel:lt,onCloseWithRefresh:Et})])):b("",!0)]),_:1})])):b("",!0),ve.value?(v(),m("div",{key:4,class:"filter-overlay",onClick:e[12]||(e[12]=de(a=>ve.value=!1,["self"]))},[n(Y,{class:"filter-card"},{header:l(()=>[s("div",ja,[e[27]||(e[27]=s("span",null,"筛选选项",-1)),n(_,{type:"danger",circle:"",onClick:e[5]||(e[5]=a=>ve.value=!1),plain:""},{default:l(()=>[...e[26]||(e[26]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",Ya,[n(De,{"content-position":"left"},{default:l(()=>[...e[28]||(e[28]=[r("站点筛选",-1)])]),_:1}),s("div",Wa,[s("div",Ja,[n(ts,{modelValue:W.value,"onUpdate:modelValue":e[6]||(e[6]=a=>W.value=a),size:"default"},{default:l(()=>[n(ct,{label:"exist",class:"compact-radio-button"},{default:l(()=>[...e[29]||(e[29]=[r("存在于",-1)])]),_:1}),n(ct,{label:"not-exist",class:"compact-radio-button"},{default:l(()=>[...e[30]||(e[30]=[r("不存在于",-1)])]),_:1})]),_:1},8,["modelValue"]),n(w,{modelValue:ke.value,"onUpdate:modelValue":e[7]||(e[7]=a=>ke.value=a),placeholder:"搜索站点",clearable:"",style:{width:"280px","font-size":"14px"},size:"default"},null,8,["modelValue"]),s("div",qa,[h.existSiteNames.length>0?(v(),m("div",Ka,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("存在于: "+u(h.existSiteNames.length),1)]),_:1}),n(_,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:At},{default:l(()=>[...e[31]||(e[31]=[r("清除",-1)])]),_:1})])):b("",!0),h.notExistSiteNames.length>0?(v(),m("div",Ha,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("不存在于: "+u(h.notExistSiteNames.length),1)]),_:1}),n(_,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Ft},{default:l(()=>[...e[32]||(e[32]=[r("清除",-1)])]),_:1})])):b("",!0)])]),s("div",Xa,[n(qe,{modelValue:L.value,"onUpdate:modelValue":e[8]||(e[8]=a=>L.value=a)},{default:l(()=>[(v(!0),m(ee,null,ue(Ge.value,a=>(v(),O(Je,{key:a,label:a,disabled:!Qe(a),class:ce({"disabled-site":!Qe(a)})},{default:l(()=>[r(u(a),1)]),_:2},1032,["label","disabled","class"]))),128))]),_:1},8,["modelValue"])])]),n(De,{"content-position":"left"},{default:l(()=>[...e[33]||(e[33]=[r("下载器",-1)])]),_:1}),s("div",Ga,[h.downloaderIds.length>0?(v(),m("div",Qa,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("下载器: "+u(h.downloaderIds.length),1)]),_:1}),n(_,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Wt},{default:l(()=>[...e[34]||(e[34]=[r("清除",-1)])]),_:1})])):b("",!0)]),n(qe,{modelValue:h.downloaderIds,"onUpdate:modelValue":e[9]||(e[9]=a=>h.downloaderIds=a)},{default:l(()=>[(v(!0),m(ee,null,ue(C.value,a=>(v(),O(Je,{key:a.id,label:a.id},{default:l(()=>[r(u(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),n(De,{"content-position":"left"},{default:l(()=>[...e[35]||(e[35]=[r("保存路径",-1)])]),_:1}),s("div",Za,[h.paths.length>0?(v(),m("div",el,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("路径: "+u(h.paths.length),1)]),_:1}),n(_,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:jt},{default:l(()=>[...e[36]||(e[36]=[r("清除",-1)])]),_:1})])):b("",!0)]),s("div",tl,[n(ss,{ref_key:"pathTreeRef",ref:$,data:he.value,"show-checkbox":"","node-key":"path","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":"","check-strictly":!0,props:{class:"path-tree-node"}},null,8,["data"])]),n(De,{"content-position":"left"},{default:l(()=>[...e[37]||(e[37]=[r("状态",-1)])]),_:1}),s("div",sl,[h.states.length>0?(v(),m("div",al,[n(i,{type:"info",size:"default",effect:"plain"},{default:l(()=>[r("状态: "+u(h.states.length),1)]),_:1}),n(_,{type:"danger",link:"",style:{padding:"0","margin-left":"5px"},onClick:Yt},{default:l(()=>[...e[38]||(e[38]=[r("清除",-1)])]),_:1})])):b("",!0)]),n(qe,{modelValue:h.states,"onUpdate:modelValue":e[10]||(e[10]=a=>h.states=a)},{default:l(()=>[(v(!0),m(ee,null,ue(ze.value,a=>(v(),O(Je,{key:a,label:a},{default:l(()=>[r(u(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),s("div",ll,[n(_,{onClick:Ot},{default:l(()=>[...e[39]||(e[39]=[r("清除筛选",-1)])]),_:1}),n(_,{onClick:e[11]||(e[11]=a=>ve.value=!1)},{default:l(()=>[...e[40]||(e[40]=[r("取消",-1)])]),_:1}),n(_,{type:"primary",onClick:Pt},{default:l(()=>[...e[41]||(e[41]=[r("确认",-1)])]),_:1})])]),_:1})])):b("",!0),we.value?(v(),m("div",{key:5,class:"filter-overlay",onClick:e[16]||(e[16]=de(a=>we.value=!1,["self"]))},[n(Y,{class:"filter-card",style:{"max-width":"500px"}},{header:l(()=>[s("div",nl,[e[43]||(e[43]=s("span",null,"站点操作",-1)),n(_,{type:"danger",circle:"",onClick:e[13]||(e[13]=a=>we.value=!1),plain:""},{default:l(()=>[...e[42]||(e[42]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",ol,[s("div",il,[e[44]||(e[44]=s("p",{class:"label"},"种子名称:",-1)),s("p",rl,u(xe.value),1)]),s("p",null,"站点名称: "+u(R.value?.name),1),s("p",null,"当前状态: "+u(R.value?.data.state),1),R.value&&R.value.data&&Ie(R.value.data,R.value.name)?(v(),m("div",dl,[e[45]||(e[45]=s("p",{class:"label"},"详情页链接:",-1)),n(as,{href:je(R.value.data,R.value.name),target:"_blank",type:"primary",underline:!1},{default:l(()=>[r(u(je(R.value.data,R.value.name)),1)]),_:1},8,["href"])])):(v(),m("div",ul,[e[46]||(e[46]=s("p",{class:"label"},"添加详情页链接或种子ID:",-1)),n(w,{modelValue:ie.value,"onUpdate:modelValue":e[14]||(e[14]=a=>ie.value=a),placeholder:"请输入完整的详情页链接或种子ID",clearable:"",onKeyup:_s(ot,["enter"])},null,8,["modelValue"]),e[47]||(e[47]=s("p",{class:"input-hint"}," 支持输入完整链接（如：https://example.com/details.php?id=123）或仅输入数字ID（如：9999999996） ",-1))])),s("div",cl,[n(_,{onClick:e[15]||(e[15]=a=>we.value=!1)},{default:l(()=>[...e[48]||(e[48]=[r("取消",-1)])]),_:1}),Ie(R.value?.data,R.value?.name)?b("",!0):(v(),O(_,{key:0,type:"success",onClick:ot,disabled:!ie.value||ie.value.trim()===""},{default:l(()=>[...e[49]||(e[49]=[r(" 添加链接 ",-1)])]),_:1},8,["disabled"])),Ie(R.value?.data,R.value?.name)?(v(),O(_,{key:1,type:"primary",onClick:Ut},{default:l(()=>[...e[50]||(e[50]=[r(" 设为不存在 ",-1)])]),_:1})):b("",!0)])])]),_:1})])):b("",!0),ne.value?(v(),m("div",vl,[n(Y,{class:"filter-card",style:{"max-width":"600px"}},{header:l(()=>[s("div",fl,[e[52]||(e[52]=s("span",null,"请选择转种的源站点",-1)),n(_,{type:"danger",circle:"",onClick:e[17]||(e[17]=a=>ne.value=!1),plain:""},{default:l(()=>[...e[51]||(e[51]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",pl,[s("p",ml,[n(i,{type:"success",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[53]||(e[53]=[r("可获取数据",-1)])]),_:1}),n(i,{type:"primary",size:"large",style:{"margin-right":"5px"}},{default:l(()=>[...e[54]||(e[54]=[r("点击尝试使用iyuu获取链接",-1)])]),_:1}),n(i,{type:"error",size:"large",style:{"margin-right":"5px",opacity:"0.5"}},{default:l(()=>[...e[55]||(e[55]=[r("缺少配置参数",-1)])]),_:1})]),fe.value.length>0?(v(),m("div",_l,[s("p",gl,"已缓存的站点 ("+u(fe.value.length)+")",1),s("div",hl,[(v(!0),m(ee,null,ue(oe.value.filter(a=>fe.value.includes(a.name)),a=>He((v(),O(i,{key:a.name,type:ut(a,be(a.name)),class:ce([{"is-selectable":be(a.name),"cached-site-tag":!0},"site-tag"]),onClick:S=>be(a.name)&&at(it(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(u(a.name)+" ✓ ",1)]),_:2},1032,["type","class","onClick"])),[[Ke,Ee.value[a.name]]])),128))])])):b("",!0),oe.value.some(a=>!fe.value.includes(a.name))?(v(),m("div",yl,[e[56]||(e[56]=s("p",{class:"uncached-sites-label"},"未缓存的站点",-1)),s("div",wl,[(v(!0),m(ee,null,ue(oe.value.filter(a=>!fe.value.includes(a.name)),a=>He((v(),O(i,{key:a.name,type:ut(a,be(a.name)),class:ce([{"is-selectable":be(a.name)},"site-tag"]),style:ys(!a.has_cookie&&a.name!=="肉丝"||(a.name==="杜比"||a.name==="HDtime"||a.name==="肉丝")&&!a.has_passkey?"opacity: 0.5":""),size:"large",onClick:S=>be(a.name)&&at(it(a.name)),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},{default:l(()=>[r(u(a.name),1)]),_:2},1032,["type","class","style","onClick"])),[[Ke,Ee.value[a.name]]])),128))])])):b("",!0)]),s("div",Sl,[n(_,{type:"warning",onClick:rt,loading:x.value,plain:""},{default:l(()=>[...e[57]||(e[57]=[r(" IYUU查询 ",-1)])]),_:1},8,["loading"]),n(_,{type:"success",onClick:e[18]||(e[18]=a=>Dt(j.value)),plain:""},{default:l(()=>[...e[58]||(e[58]=[r("上盒",-1)])]),_:1}),n(_,{onClick:e[19]||(e[19]=a=>ne.value=!1)},{default:l(()=>[...e[59]||(e[59]=[r("取消",-1)])]),_:1})])]),_:1})])):b("",!0),n(ha,{onRefresh:Nt}),ye.value?(v(),m("div",{key:7,class:"filter-overlay",onClick:de(Ae,["self"])},[n(Y,{class:"filter-card",style:{"max-width":"720px"}},{header:l(()=>[s("div",xl,[e[61]||(e[61]=s("span",null,"IYUU 批量查询进度",-1)),n(_,{type:"danger",circle:"",onClick:Ae,plain:""},{default:l(()=>[...e[60]||(e[60]=[r("X",-1)])]),_:1})])]),default:l(()=>[s("div",kl,[n(vt,{column:2,border:"",size:"small"},{default:l(()=>[n(re,{label:"任务ID"},{default:l(()=>[r(u(z.value?.task_id||"-"),1)]),_:1}),n(re,{label:"状态"},{default:l(()=>[n(i,{type:z.value?.isRunning?"warning":z.value?.success?"success":"danger",size:"small"},{default:l(()=>[r(u(z.value?.isRunning?"进行中":z.value?.success?"已完成":"失败"),1)]),_:1},8,["type"])]),_:1}),n(re,{label:"总数"},{default:l(()=>[r(u(z.value?.total??0),1)]),_:1}),n(re,{label:"已处理"},{default:l(()=>[r(u(z.value?.processed??0),1)]),_:1}),n(re,{label:"开始时间"},{default:l(()=>[r(u(z.value?.created_at||"-"),1)]),_:1}),n(re,{label:"完成时间"},{default:l(()=>[r(u(z.value?.finished_at||"-"),1)]),_:1})]),_:1}),n(De,{"content-position":"left"},{default:l(()=>[...e[62]||(e[62]=[r("结果",-1)])]),_:1}),s("div",bl,u(z.value?.message||"等待任务更新..."),1),z.value?.stats?(v(),O(vt,{key:0,column:3,border:"",size:"small"},{default:l(()=>[n(re,{label:"找到"},{default:l(()=>[r(u(z.value.stats.total_found??0),1)]),_:1}),n(re,{label:"新增"},{default:l(()=>[r(u(z.value.stats.new_records??0),1)]),_:1}),n(re,{label:"更新"},{default:l(()=>[r(u(z.value.stats.updated_records??0),1)]),_:1})]),_:1})):b("",!0)]),s("div",Cl,[n(_,{type:"primary",onClick:Oe,plain:""},{default:l(()=>[...e[63]||(e[63]=[r("刷新",-1)])]),_:1}),n(_,{onClick:Ae},{default:l(()=>[...e[64]||(e[64]=[r("关闭",-1)])]),_:1})])]),_:1})])):b("",!0)])}}}),Tl=gt(Nl,[["__scopeId","data-v-b23e10d3"]]);export{Tl as default};
