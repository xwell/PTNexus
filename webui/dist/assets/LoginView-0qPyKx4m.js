import{d as x,r as c,c as y,b as s,w as o,e as n,h as _,P as k,i as b,f as T,z as r,q as f,ak as C,a5 as N,g as P,m as h}from"./index-BiuajaRa.js";const B={class:"login-page"},R=x({__name:"LoginView",setup(q){const w=N(),u=C(),i=c(!1),t=c({username:"",password:""}),p=async()=>{if(!i.value){i.value=!0;try{const a=await T.post("/api/auth/login",t.value);if(a.data?.success&&a.data?.token)if(localStorage.setItem("token",a.data.token),a.data.is_temp_password||a.data.must_change_password)r.warning({message:"您正在使用临时密码，为了账户安全，请立即修改密码！",duration:5e3,showClose:!0}),await f(),await u.replace("/settings"),setTimeout(()=>{r.warning({message:'请在"账户"标签页中修改您的用户名和密码',duration:8e3,showClose:!0})},500);else{r.success("登录成功");const l=w.query.redirect||"/";console.log("登录成功，准备跳转到:",l),await f(),await u.replace(l),setTimeout(()=>{u.currentRoute.value.path==="/login"&&(console.warn("仍在登录页，强制跳转到首页"),u.replace("/"))},100)}else r.error(a.data?.message||"登录失败")}catch(a){const e=a?.response?.data?.message||"登录失败";r.error(e)}finally{i.value=!1}}};return(a,e)=>{const l=n("el-input"),d=n("el-form-item"),g=n("el-button"),v=n("el-form"),V=n("el-card");return P(),y("div",B,[s(V,{class:"login-card"},{default:o(()=>[e[3]||(e[3]=_("h2",{class:"title"},"登录 PT Nexus",-1)),s(v,{model:t.value,onKeyup:k(p,["enter"]),"label-width":"80px"},{default:o(()=>[s(d,{label:"用户名"},{default:o(()=>[s(l,{modelValue:t.value.username,"onUpdate:modelValue":e[0]||(e[0]=m=>t.value.username=m),autocomplete:"username"},null,8,["modelValue"])]),_:1}),s(d,{label:"密码"},{default:o(()=>[s(l,{modelValue:t.value.password,"onUpdate:modelValue":e[1]||(e[1]=m=>t.value.password=m),type:"password",autocomplete:"current-password"},null,8,["modelValue"])]),_:1}),s(d,null,{default:o(()=>[s(g,{type:"primary",loading:i.value,onClick:p},{default:o(()=>[...e[2]||(e[2]=[b("登录",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),e[4]||(e[4]=_("p",{class:"tip"},"如未开启认证，可直接访问页面。",-1))]),_:1})])}}}),I=h(R,[["__scopeId","data-v-e252648f"]]);export{I as default};
