import{m as Z,r as _,o as ee,f as k,z as c,c as x,h as s,u as te,b as l,w as o,i as r,x as v,ag as N,e as p,ah as le,v as ae,F as T,k as A,g as y,l as ne,t as oe,M as se,af as ie,ai as q,Q as pe}from"./index-BiuajaRa.js";const re={class:"top-actions glass-pagination"},ue={class:"realtime-switch-container"},ce={class:"settings-view"},de={class:"downloader-grid"},me={class:"card-header"},_e={class:"header-controls"},fe={class:"name-and-client-row"},ve={class:"proxy-settings-row"},ge={class:"input-append-wrapper"},ye={class:"ratio-limiter-label"},Ve={class:"path-mapping-container"},he={class:"mapping-list"},$="/api",be={__name:"DownloaderSettings",setup(xe){const u=_({downloaders:[],realtime_speed_enabled:!0}),D=_(!0),V=_(!1),I=_(null),d=_({}),h=_(!1),M=_(null),b=_([]);ee(()=>{B()});const B=async()=>{D.value=!0;try{const a=await k.get(`${$}/settings`);a.data&&(a.data.downloaders||(a.data.downloaders=[]),typeof a.data.realtime_speed_enabled!="boolean"&&(a.data.realtime_speed_enabled=!0),a.data.downloaders.forEach(e=>{e.id||(e.id=`client_${Date.now()}_${Math.random()}`),typeof e.use_proxy!="boolean"&&(e.use_proxy=!1),e.proxy_port||(e.proxy_port=9090),(!e.path_mappings||!Array.isArray(e.path_mappings))&&(e.path_mappings=[]),typeof e.enable_ratio_limiter!="boolean"&&(e.enable_ratio_limiter=!1)}),u.value=a.data)}catch(a){c.error("加载设置失败！"),console.error(a)}finally{D.value=!1}},E=async()=>{V.value=!0;try{await k.post(`${$}/settings`,u.value),c.success("设置已成功保存并应用！"),B()}catch(a){c.error("保存设置失败！"),console.error(a)}finally{V.value=!1}},z=()=>{u.value.downloaders.push({id:`new_${Date.now()}`,enabled:!0,name:"新下载器",type:"qbittorrent",host:"",username:"",password:"",use_proxy:!1,proxy_port:9090,path_mappings:[],enable_ratio_limiter:!1})},L=a=>{pe.confirm("您确定要删除这个下载器配置吗？此操作不可撤销。","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{R(a),c({type:"success",message:"下载器已删除（尚未保存）。"})}).catch(()=>{})},R=a=>{u.value.downloaders=u.value.downloaders.filter(e=>e.id!==a)},m=a=>{d.value[a]&&delete d.value[a]},w=async a=>{m(a.id),I.value=a.id;try{const i=(await k.post(`${$}/test_connection`,a)).data;i.success?(c.success(i.message),d.value[a.id]="success"):(c.error(i.message),d.value[a.id]="error")}catch(e){c.error("测试连接请求失败，请检查网络或后端服务。"),console.error("Test connection error:",e),d.value[a.id]="error"}finally{I.value=null}},F=a=>{M.value=a,(!a.path_mappings||!Array.isArray(a.path_mappings))&&(a.path_mappings=[]),b.value=JSON.parse(JSON.stringify(a.path_mappings)),h.value=!0},J=()=>{b.value.push({remote:"",local:""})},O=a=>{b.value.splice(a,1)},G=async()=>{const a=b.value.filter(e=>e.remote.trim()!==""&&e.local.trim()!=="");M.value.path_mappings=a,V.value=!0;try{await k.post(`${$}/settings`,u.value),h.value=!1,c.success("路径映射已保存！"),B()}catch(e){c.error("保存路径映射失败！"),console.error(e)}finally{V.value=!1}};return(a,e)=>{const i=p("el-button"),Q=p("el-icon"),U=p("el-switch"),g=p("el-form-item"),S=p("el-tooltip"),f=p("el-input"),P=p("el-option"),j=p("el-select"),H=p("el-form"),K=p("el-card"),W=p("el-alert"),X=p("el-dialog"),Y=ae("loading");return y(),x(T,null,[s("div",re,[l(i,{type:"primary",size:"large",onClick:z,icon:v(N)},{default:o(()=>[...e[3]||(e[3]=[r(" 添加下载器 ",-1)])]),_:1},8,["icon"]),l(i,{type:"success",size:"large",onClick:E,loading:V.value},{default:o(()=>[l(Q,null,{default:o(()=>[l(v(le))]),_:1}),e[4]||(e[4]=r(" 保存所有设置 ",-1))]),_:1},8,["loading"]),s("div",ue,[l(S,{content:"开启后，图表页将每秒获取一次数据以显示“近1分钟”实时速率。关闭后将每分钟获取一次，以降低系统负载。",placement:"bottom","hide-after":0},{default:o(()=>[l(g,{label:"开启实时速率",class:"switch-form-item"},{default:o(()=>[l(U,{modelValue:u.value.realtime_speed_enabled,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.realtime_speed_enabled=t),size:"large","inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})]),_:1})])]),te((y(),x("div",ce,[s("div",de,[(y(!0),x(T,null,A(u.value.downloaders,t=>(y(),ne(K,{key:t.id,class:"downloader-card glass-card glass-rounded glass-transparent-header glass-transparent-body"},{header:o(()=>[s("div",me,[s("span",null,oe(t.name||"新下载器"),1),s("div",_e,[l(i,{type:d.value[t.id]==="success"?"success":d.value[t.id]==="error"?"danger":"info",plain:!d.value[t.id],style:{width:"90px"},onClick:n=>w(t),loading:I.value===t.id,icon:v(se)},{default:o(()=>[...e[5]||(e[5]=[r(" 测试连接 ",-1)])]),_:1},8,["type","plain","onClick","loading","icon"]),l(i,{type:"warning",icon:v(ie),style:{width:"90px"},onClick:n=>F(t)},{default:o(()=>[...e[6]||(e[6]=[r(" 路径映射 ",-1)])]),_:1},8,["icon","onClick"]),l(U,{modelValue:t.enabled,"onUpdate:modelValue":n=>t.enabled=n,style:{margin:"0 10px"}},null,8,["modelValue","onUpdate:modelValue"]),l(i,{type:"danger",icon:v(q),circle:"",onClick:n=>L(t.id)},null,8,["icon","onClick"])])])]),default:o(()=>[l(H,{model:t,"label-position":"left","label-width":"auto"},{default:o(()=>[l(g,{label:"名称"},{default:o(()=>[s("div",fe,[l(f,{modelValue:t.name,"onUpdate:modelValue":n=>t.name=n,placeholder:"例如：家庭服务器 qB",class:"name-input",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onInput"]),l(j,{modelValue:t.type,"onUpdate:modelValue":n=>t.type=n,placeholder:"请选择类型",class:"client-type-select",onChange:n=>m(t.id)},{default:o(()=>[l(P,{label:"qBittorrent",value:"qbittorrent"}),l(P,{label:"Transmission",value:"transmission"})]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(g,{label:"盒子端口"},{default:o(()=>[s("div",ve,[l(S,{content:t.type==="transmission"?"通过代理获取截图、MediaInfo等媒体信息。注意：TR代理不包括统计数据获取。":"通过Go语言编写的专用代理连接，可解决网络延迟、获取数据不准等问题。",placement:"top","hide-after":0},{default:o(()=>[l(f,{modelValue:t.proxy_port,"onUpdate:modelValue":n=>t.proxy_port=n,type:"number",placeholder:"9090",class:"proxy-port-input",min:1,max:65535,onInput:n=>m(t.id)},{append:o(()=>[s("div",ge,[l(U,{modelValue:t.use_proxy,"onUpdate:modelValue":n=>t.use_proxy=n,"inline-prompt":"","active-text":"远程","inactive-text":"本地",onChange:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["content"]),l(S,{content:"开启后，此下载器将参与基于站点分享率阈值的出种限速",placement:"top","hide-after":0},{default:o(()=>[s("span",ye,[e[7]||(e[7]=s("span",{class:"ratio-limiter-text"},"出种限速",-1)),l(U,{modelValue:t.enable_ratio_limiter,"onUpdate:modelValue":n=>t.enable_ratio_limiter=n,"inline-prompt":"","active-text":"开","inactive-text":"关"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)])]),_:2},1024),l(g,{label:"主机地址"},{default:o(()=>[l(f,{modelValue:t.host,"onUpdate:modelValue":n=>t.host=n,placeholder:t.type==="transmission"?"例如：192.168.1.10:9091 或 http://192.168.1.10:9091":"例如：192.168.1.10:8080",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"])]),_:2},1024),l(g,{label:"用户名"},{default:o(()=>[l(f,{modelValue:t.username,"onUpdate:modelValue":n=>t.username=n,placeholder:"登录用户名",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(g,{label:"密码"},{default:o(()=>[l(f,{modelValue:t.password,"onUpdate:modelValue":n=>t.password=n,type:"password","show-password":"",placeholder:"登录密码（未修改则留空）",onInput:n=>m(t.id)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024)]),_:2},1032,["model"])]),_:2},1024))),128))])])),[[Y,D.value]]),l(X,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),title:`路径映射配置 - ${M.value?.name||""}`,width:"700px","close-on-click-modal":!1},{footer:o(()=>[l(i,{onClick:e[1]||(e[1]=t=>h.value=!1)},{default:o(()=>[...e[12]||(e[12]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:G},{default:o(()=>[...e[13]||(e[13]=[r("确定",-1)])]),_:1})]),default:o(()=>[s("div",Ve,[l(W,{title:"路径映射说明",type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:o(()=>[...e[8]||(e[8]=[s("p",null,"配置下载器路径到 PT Nexus 容器内路径的映射关系。",-1),s("p",null,[s("strong",null,"下载器路径："),r("下载器中显示的种子保存路径")],-1),s("p",null,[s("strong",null,"视频文件路径："),r("挂载到 PT Nexus 容器内的路径或者盒子本地路径的路径")],-1)])]),_:1}),s("div",he,[(y(!0),x(T,null,A(b.value,(t,n)=>(y(),x("div",{key:n,class:"mapping-item"},[l(f,{modelValue:t.remote,"onUpdate:modelValue":C=>t.remote=C,placeholder:"例如：/downloads",class:"mapping-input"},{prepend:o(()=>[...e[9]||(e[9]=[r("下载器路径",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"]),l(f,{modelValue:t.local,"onUpdate:modelValue":C=>t.local=C,placeholder:"例如：/app/data/qb1",class:"mapping-input"},{prepend:o(()=>[...e[10]||(e[10]=[r("视频文件路径",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"]),l(i,{type:"danger",icon:v(q),circle:"",onClick:C=>O(n)},null,8,["icon","onClick"])]))),128))]),l(i,{type:"primary",icon:v(N),style:{width:"100%","margin-top":"16px"},onClick:J},{default:o(()=>[...e[11]||(e[11]=[r(" 添加映射规则 ",-1)])]),_:1},8,["icon"])])]),_:1},8,["modelValue","title"])],64)}}},Ce=Z(be,[["__scopeId","data-v-6d40a3fc"]]);export{Ce as default};
